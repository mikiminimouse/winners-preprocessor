# –ü–æ–ª–Ω—ã–π –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ preprocessing - –§–∞–∑–∞ 2

## üìã –†–µ–∑—é–º–µ

–£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–ø –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ `preprocessing` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª `router/main.py` (1598 —Å—Ç—Ä–æ–∫) –±—ã–ª —Ä–∞–∑–±–∏—Ç –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏, —É–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã, –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤–æ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º—ã—Ö —Ñ–∞–π–ª–∞—Ö.

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### –≠—Ç–∞–ø 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ router/main.py (1598 —Å—Ç—Ä–æ–∫)

–°–æ–∑–¥–∞–Ω–æ 7 –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π:

1. **router/config.py** (~70 —Å—Ç—Ä–æ–∫)
   - –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MongoDB
   - HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏

2. **router/mongo.py** (~180 —Å—Ç—Ä–æ–∫)
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
   - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞–º–∏
   - –ü–æ–∏—Å–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –ø–æ –¥–∞—Ç–µ

3. **router/archive.py** (~360 —Å—Ç—Ä–æ–∫)
   - –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ ZIP –∞—Ä—Ö–∏–≤–æ–≤
   - –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ RAR –∞—Ä—Ö–∏–≤–æ–≤
   - –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ 7z –∞—Ä—Ö–∏–≤–æ–≤
   - –ó–∞—â–∏—Ç–∞ –æ—Ç zip bomb

4. **router/manifest.py** (~60 —Å—Ç—Ä–æ–∫)
   - –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

5. **router/utils.py** (~50 —Å—Ç—Ä–æ–∫)
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ SHA256 —Ö–µ—à–∞
   - –û—á–∏—Å—Ç–∫–∞ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤

6. **router/processing.py** (~30 —Å—Ç—Ä–æ–∫)
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞

7. **router/__init__.py**
   - –≠–∫—Å–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –≠—Ç–∞–ø 2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ CLI

- –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ `cli/main.py`
- –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç `preprocessing/cli.py` (1406 —Å—Ç—Ä–æ–∫)

### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ scheduler

- –°–æ–∑–¥–∞–Ω `scheduler/config.py`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ `scheduler/main.py`

### –≠—Ç–∞–ø 4: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

- –£–¥–∞–ª–µ–Ω `preprocessing/cli.py` (1406 —Å—Ç—Ä–æ–∫)
- –£–¥–∞–ª–µ–Ω `router/cli.py` (1405 —Å—Ç—Ä–æ–∫)
- –£–¥–∞–ª–µ–Ω `router/protocol_sync.py` (518 —Å—Ç—Ä–æ–∫)
- **–í—Å–µ–≥–æ —É–¥–∞–ª–µ–Ω–æ**: 3329 —Å—Ç—Ä–æ–∫

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|---------|------|-------|
| router/main.py | 1598 —Å—Ç—Ä–æ–∫ | ~400 (api.py) |
| –§–∞–π–ª—ã –≤ router | 12 | 10 |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | –í—ã—Å–æ–∫–æ–µ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤ | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –º–æ–¥—É–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è:

```
‚úÖ router.config
‚úÖ router.mongo
‚úÖ router.archive
‚úÖ router.manifest
‚úÖ router.utils
‚úÖ downloader.service
‚úÖ sync_db.service
‚úÖ cli.main
```

## üéØ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
preprocessing/
‚îú‚îÄ‚îÄ downloader/          ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ sync_db/             ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
‚îú‚îÄ‚îÄ router/              ‚úÖ API (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)
‚îÇ   ‚îú‚îÄ‚îÄ api.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ mongo.py
‚îÇ   ‚îú‚îÄ‚îÄ archive.py
‚îÇ   ‚îú‚îÄ‚îÄ manifest.py
‚îÇ   ‚îú‚îÄ‚îÄ utils.py
‚îÇ   ‚îú‚îÄ‚îÄ processing.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ cli/                 ‚úÖ CLI (–æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã)
‚îú‚îÄ‚îÄ scheduler/           ‚úÖ Scheduler (–æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã)
‚îî‚îÄ‚îÄ run_cli.py           ‚úÖ –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úì –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª —Ä–∞–∑–±–∏—Ç –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏
‚úì –õ–µ–≥—á–µ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–¥
‚úì –ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
‚úì –õ—É—á—à–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–¥
‚úì –ü–æ–Ω—è—Ç–Ω–µ–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
‚úì –ü—Ä–æ—â–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å
‚úì –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å downloader –∏ sync_db

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û
