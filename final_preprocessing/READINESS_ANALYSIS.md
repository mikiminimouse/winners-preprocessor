# –ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã Preprocessing –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏: **~60%**

### ‚úÖ –ì–æ—Ç–æ–≤–æ (Core –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)

#### 1. Core –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (95% –≥–æ—Ç–æ–≤–æ)
- ‚úÖ **State Machine** (`docprep/core/state_machine.py`) - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ **Manifest v2** (`docprep/core/manifest.py`) - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ **Audit Log** (`docprep/core/audit.py`) - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ **Config** (`docprep/core/config.py`) - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≥–æ—Ç–æ–≤–∞
- ‚úÖ **Exceptions** (`docprep/core/exceptions.py`) - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

#### 2. Engine –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (70% –≥–æ—Ç–æ–≤–æ)

**‚úÖ Classifier** (`docprep/engine/classifier.py`):
- ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (direct, convert, extract, normalize, special)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ audit log
- ‚ö†Ô∏è **–ù–ï —Å–æ–∑–¥–∞–µ—Ç manifest –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏**
- ‚ö†Ô∏è **–ù–ï –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç UNIT –≤ —Ü–µ–ª–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é**
- ‚ö†Ô∏è **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç state machine**

**‚úÖ Converter** (`docprep/engine/converter.py`):
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ LibreOffice
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ manifest
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ audit
- ‚ö†Ô∏è **–ù–ï –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç UNIT –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏**

**‚úÖ Extractor** (`docprep/engine/extractor.py`):
- ‚úÖ –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ ZIP/RAR/7Z
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç zip bomb
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ manifest
- ‚ö†Ô∏è **–ù–ï –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç UNIT –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è**

**‚úÖ Normalizers**:
- ‚úÖ `NameNormalizer` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω
- ‚úÖ `ExtensionNormalizer` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚ö†Ô∏è **–ù–ï –ø–µ—Ä–µ–º–µ—â–∞—é—Ç UNIT –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏**

**‚úÖ Merger** (`docprep/engine/merger.py`):
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ UNIT –∏–∑ Merge_N
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º
- ‚ö†Ô∏è **–ù–µ–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ PDF (scan/text)**

**‚ö†Ô∏è Validator** (`docprep/engine/validator.py`):
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- ‚ùå **TODO: –ü—Ä–æ–≤–µ—Ä–∫–∞ checksum**

#### 3. Utils (80% –≥–æ—Ç–æ–≤–æ)
- ‚úÖ `file_ops.py` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `paths.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ø—É—Ç–µ–π
- ‚ö†Ô∏è **detect_file_type —É–ø—Ä–æ—â–µ–Ω –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–º** (–Ω–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ fake_doc, —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)

### ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

#### 1. CLI –∫–æ–º–∞–Ω–¥—ã (40% –≥–æ—Ç–æ–≤–æ)
**–í—Å–µ CLI –∫–æ–º–∞–Ω–¥—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ TODO:**
- ‚ùå `pipeline.py` - –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ùå `cycle.py` - –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ùå `stage.py` - –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ùå `substage.py` - –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ùå `classifier.py` - –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ùå `inspect.py` - –Ω–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ùå `utils.py` - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

#### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (0% –≥–æ—Ç–æ–≤–æ)
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ engine –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–∏–º UNIT, –Ω–æ –Ω–µ—Ç –ª–æ–≥–∏–∫–∏:
- ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö UNIT –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- ‚ùå –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ UNIT –º–µ–∂–¥—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏ —Å —É—á–µ—Ç–æ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ manifest –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ state machine –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö
- ‚ùå –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —É—á–µ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤

#### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (30% –≥–æ—Ç–æ–≤–æ)
- ‚ùå –ù–µ—Ç —Å–≤—è–∑–∏ Classifier ‚Üí –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ UNIT ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ manifest
- ‚ùå –ù–µ—Ç —Å–≤—è–∑–∏ Converter/Extractor/Normalizer ‚Üí –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ UNIT ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ state
- ‚ùå –ù–µ—Ç —Å–≤—è–∑–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ Pending ‚Üí –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ Merge
- ‚ùå –ù–µ—Ç —Å–≤—è–∑–∏ Merge ‚Üí Ready2Docling

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

#### 1. detect_file_type —É–ø—Ä–æ—â–µ–Ω
**–ü—Ä–æ—Ç–æ—Ç–∏–ø** (`preprocessing/router/file_detection.py`):
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è fake_doc (–∞—Ä—Ö–∏–≤—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .doc)
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è is_signature_file
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è is_unsupported
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è has_complex_extension
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ PDF (—Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ZIP (–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ testzip)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Excel (xls/xlsx)

**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è** (`docprep/utils/file_ops.py`):
- ‚ö†Ô∏è –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è
- ‚ö†Ô∏è –ù–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ fake_doc
- ‚ö†Ô∏è –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ PDF (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- ‚ö†Ô∏è –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞—Ä—Ö–∏–≤–æ–≤

#### 2. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º
- ‚ö†Ô∏è Classifier –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ü–µ–ª–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- ‚ö†Ô∏è Merger –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É PDF (scan/text)
- ‚ö†Ô∏è –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é

#### 3. State Machine –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚ö†Ô∏è Classifier –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç state machine
- ‚ö†Ô∏è Converter/Extractor/Normalizer –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç state machine
- ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

## üîç –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞–º–∏

### –ü—Ä–æ—Ç–æ—Ç–∏–ø (`preprocessing/router/`)

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞:**
1. ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (`file_detection.py`)
2. ‚úÖ –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤ (`file_classifier.py`)
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (`unit_distribution_new.py`)
4. ‚úÖ State manager (`state_manager.py`)
5. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ mixed units (`mixed_unit_handler.py`)

**–ß—Ç–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:**
1. –õ–æ–≥–∏–∫—É –¥–µ—Ç–µ–∫—Ü–∏–∏ fake_doc –∏ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
2. –õ–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Ü–µ–ª–∏–∫–æ–º
3. –õ–æ–≥–∏–∫—É –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è UNIT —Å —É—á–µ—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (`final_preprocessing/docprep/`)

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
1. ‚úÖ –ß–µ—Ç–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (core/engine/cli —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ)
2. ‚úÖ State Machine —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω
3. ‚úÖ Manifest v2 —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω
4. ‚úÖ Audit log —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
5. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç PRD

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å:**
1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è engine —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
3. –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —Ñ–∞–π–ª–æ–≤

## üìã –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

#### 1.1 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
**–§–∞–π–ª—ã:**
- `docprep/utils/paths.py` - –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ UNIT
- `docprep/core/unit_processor.py` - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ UNIT

**–§—É–Ω–∫—Ü–∏–∏:**
```python
def process_directory_units(source_dir: Path, processor_func, **kwargs) -> Dict
def move_unit_to_target(unit_path: Path, target_dir: Path, extension: str) -> Path
def get_extension_subdirectory(base_dir: Path, extension: str) -> Path
```

#### 1.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Classifier —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
**–§–∞–π–ª:** `docprep/engine/classifier.py`

**–î–æ–±–∞–≤–∏—Ç—å:**
- –°–æ–∑–¥–∞–Ω–∏–µ manifest –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ UNIT –≤ —Ü–µ–ª–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å —É—á–µ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ state machine
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–æ–≤

#### 1.3 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CLI –∫–æ–º–∞–Ω–¥
**–§–∞–π–ª—ã:**
- `docprep/cli/pipeline.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö UNIT
- `docprep/cli/stage.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç—Ç–∞–ø–æ–≤
- `docprep/cli/substage.py` - –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `docprep/cli/cycle.py` - —Ü–∏–∫–ª—ã

**–õ–æ–≥–∏–∫–∞:**
- –ù–∞–π—Ç–∏ –≤—Å–µ UNIT –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å engine –º–µ—Ç–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É UNIT
- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å UNIT –≤ —Ü–µ–ª–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- –û–±–Ω–æ–≤–∏—Ç—å manifest –∏ state

#### 1.4 –£–ª—É—á—à–µ–Ω–∏–µ detect_file_type
**–§–∞–π–ª:** `docprep/utils/file_ops.py`

**–î–æ–±–∞–≤–∏—Ç—å –∏–∑ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞:**
- –î–µ—Ç–µ–∫—Ü–∏—è fake_doc
- –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ PDF
- –î–µ—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä—Ö–∏–≤–æ–≤
- –î–µ—Ç–µ–∫—Ü–∏—è Excel —Ñ–∞–π–ª–æ–≤

### –§–∞–∑–∞ 2: –í–∞–∂–Ω–æ (–¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞)

#### 2.1 State Machine –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ state –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

#### 2.2 –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ PDF (scan/text)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ PDF –≤ Merger
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤ pdf/scan/ –∏–ª–∏ pdf/text/

#### 2.3 Validator –¥–æ—Ä–∞–±–æ—Ç–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ checksum
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã UNIT

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏—è

#### 3.1 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Policy –æ—à–∏–±–æ–∫ (Retry, Skip, Quarantine)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ CLI

#### 3.2 –¢–µ—Å—Ç—ã
- –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
- Unit-—Ç–µ—Å—Ç—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≥–æ—Ç–æ–≤–∞
2. ‚úÖ Engine –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
3. ‚ùå **–ù–£–ñ–ù–û:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ CLI
4. ‚ùå **–ù–£–ñ–ù–û:** –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ UNIT –º–µ–∂–¥—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏
5. ‚ùå **–ù–£–ñ–ù–û:** –°–æ–∑–¥–∞–Ω–∏–µ manifest –ø—Ä–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
6. ‚ùå **–ù–£–ñ–ù–û:** –ë–∞–∑–æ–≤—ã–µ CLI –∫–æ–º–∞–Ω–¥—ã (—Ö–æ—Ç—è –±—ã stage classifier)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. –°–Ω–∞—á–∞–ª–∞: `stage classifier` - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö UNIT –∏–∑ Input
2. –ó–∞—Ç–µ–º: `substage convert/extract/normalize` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ Pending
3. –ó–∞—Ç–µ–º: `stage merge` - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ Merge
4. –ù–∞–∫–æ–Ω–µ—Ü: `pipeline run` - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª

## üìù –í—ã–≤–æ–¥—ã

**–ì–æ—Ç–æ–≤–æ:**
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ core –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚úÖ Engine –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)

**–ù–µ –≥–æ—Ç–æ–≤–æ (–±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ):**
- ‚ùå CLI –∫–æ–º–∞–Ω–¥—ã (—Ç–æ–ª—å–∫–æ TODO)
- ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- ‚ùå –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ UNIT
- ‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- –§–∞–∑–∞ 1 (–∫—Ä–∏—Ç–∏—á–Ω–æ): **4-6 —á–∞—Å–æ–≤**
- –§–∞–∑–∞ 2 (–≤–∞–∂–Ω–æ): **2-3 —á–∞—Å–∞**
- –§–∞–∑–∞ 3 (—É–ª—É—á—à–µ–Ω–∏—è): **–ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ –±–∞–∑–æ–≤—ã—Ö CLI –∫–æ–º–∞–Ω–¥ –¥–ª—è stage classifier, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

