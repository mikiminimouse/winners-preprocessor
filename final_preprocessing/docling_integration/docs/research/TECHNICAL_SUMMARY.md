# Техническое резюме системы Docling Integration

## Общая архитектура

Система Docling Integration представляет собой оркестрационный слой поверх библиотеки IBM Docling, обеспечивающий:
- Интеграцию с внутренней системой DocPrep через контрактную модель
- Конфигурируемую обработку различных форматов документов
- Экспорт результатов в различные форматы (JSON, Markdown, MongoDB)

## Ключевые компоненты

### 1. Bridge с DocPrep (`bridge_docprep.py`)
- Загружает UNIT из Ready2Docling используя только `docprep.contract.json`
- Валидирует готовность UNIT к обработке
- Определяет главный файл для обработки через AST nodes

### 2. Конфигурация (`config.py`)
- Использует YAML templates для конфигурации Docling pipelines
- Поддерживает fallback на legacy hardcoded конфигурацию
- Маппит route из контракта в соответствующие настройки Docling

### 3. Pipeline (`pipeline.py`)
- Основной класс оркестрации обработки
- Обеспечивает обработку отдельных UNIT и директорий
- Реализует механизм quarantine для проблемных документов
- Экспортирует результаты в различные форматы

## Контрактная модель

Центральной частью взаимодействия является `docprep.contract.json`, который:
- Содержит всю необходимую информацию для обработки документа
- Определяет маршрут обработки (route)
- Содержит метаданные о документе
- Является единственным источником информации для Docling Integration

## Конфигурация через YAML templates

Система использует YAML templates для гибкой настройки обработки различных типов документов:
- `pdf_text.yaml` - для PDF с текстовым слоем
- `pdf_scan.yaml` - для сканированных PDF (с OCR)
- `docx.yaml`, `xlsx.yaml` и др. - для нативных форматов

## Внешние зависимости

Основные зависимости:
- `docling>=1.0.0` - ядро системы обработки документов
- `pymongo>=4.0.0` - для экспорта в MongoDB
- Различные модели: `publaynet_detectron2`, `table-transformer`, `tesseract`

## Best Practices

1. **Docling как двигатель, наш код как водитель** - не дублируем логику парсинга
2. **Используем manifest из docprep** - не определяем тип файла заново
3. **Минимальная структура** - только orchestration, конфигурация, экспорт
4. **Контрактная строгость** - четкое разделение ответственности между системами

## Возможности для улучшения

1. Рефакторинг сложной логики импорта в `config.py`
2. Улучшение обработки ошибок и логирования
3. Оптимизация для работы с большими файлами
4. Расширение набора экспортёров
5. Добавление unit-тестов для критических компонентов