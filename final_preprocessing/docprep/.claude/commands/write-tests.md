---
name: write-tests
description: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è –ø–µ—Ä–µ–¥ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º (TDD –ø–æ–¥—Ö–æ–¥)
---

# TDD: –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è $ARGUMENTS

## –ü—Ä–∏–Ω—Ü–∏–ø

–ú—ã —Å–ª–µ–¥—É–µ–º Test-Driven Development. –°–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ–º —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å—ã–≤–∞—é—Ç –ñ–ï–õ–ê–ï–ú–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∑–∞—Ç–µ–º —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –æ–Ω–∏ –ø–∞–¥–∞—é—Ç (–∫–æ–¥ –µ—â—ë –Ω–µ –∏–∑–º–µ–Ω—ë–Ω), –∑–∞—Ç–µ–º –º–µ–Ω—è–µ–º –∫–æ–¥ —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏.

## –ü—Ä–æ—Ü–µ–¥—É—Ä–∞

### 1. –ê–Ω–∞–ª–∏–∑ –º–æ–¥—É–ª—è

–ò–∑—É—á–∏ —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥—É–ª—è `$ARGUMENTS`:
```bash
cat docprep/$ARGUMENTS
```

–û–ø—Ä–µ–¥–µ–ª–∏:
- –ö–∞–∫–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/–∫–ª–∞—Å—Å—ã –µ—Å—Ç—å?
- –ö–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è?
- –ö–∞–∫–æ–µ –Ω–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å?

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ù–∞–π–¥–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
find docprep/tests -name "*$ARGUMENTS*" -o -name "test_*.py" | xargs grep -l "$ARGUMENTS" 2>/dev/null
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞

–¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

```python
"""
–¢–µ—Å—Ç—ã –¥–ª—è –º–æ–¥—É–ª—è $ARGUMENTS.

–≠—Ç–∏ —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –≤ —Å—Ç–∏–ª–µ TDD ‚Äî –æ–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –∂–µ–ª–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
"""
import pytest
from pathlib import Path
import tempfile
import json

# –ò–º–ø–æ—Ä—Ç—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –º–æ–¥—É–ª—è
# from docprep.<module> import <what_to_test>


class Test–ù–∞–∑–≤–∞–Ω–∏–µ–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
    """–¢–µ—Å—Ç—ã –¥–ª—è <–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞>."""
    
    @pytest.fixture
    def setup_fixture(self):
        """–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
        # –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π/—Ñ–∞–π–ª–æ–≤
        pass
    
    def test_–æ—Å–Ω–æ–≤–Ω–æ–µ_–ø–æ–≤–µ–¥–µ–Ω–∏–µ(self):
        """–¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è ‚Äî –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞."""
        # Arrange (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
        # Act (–¥–µ–π—Å—Ç–≤–∏–µ)
        # Assert (–ø—Ä–æ–≤–µ—Ä–∫–∞)
        pass
    
    def test_–≥—Ä–∞–Ω–∏—á–Ω—ã–π_—Å–ª—É—á–∞–π(self):
        """–¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–ª—É—á–∞—è."""
        pass
    
    def test_–æ–±—Ä–∞–±–æ—Ç–∫–∞_–æ—à–∏–±–æ–∫(self):
        """–¢–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫."""
        pass
```

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞ (AAA Pattern)

–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç —Å–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É AAA:

```python
def test_something(self):
    """–û–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º."""
    # Arrange ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    input_data = {...}
    expected_result = {...}
    
    # Act ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    actual_result = function_under_test(input_data)
    
    # Assert ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    assert actual_result == expected_result
```

### 5. –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å

**–î–ª—è State Machine ($ARGUMENTS = "core/state_machine.py"):**
- `test_valid_transition` ‚Äî –≤–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- `test_invalid_transition_raises` ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- `test_transition_with_metadata` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- `test_state_trace_history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
- `test_is_terminal` ‚Äî —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- `test_save_to_manifest` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ manifest —Ä–∞–±–æ—Ç–∞–µ—Ç
- `test_load_from_manifest` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ manifest —Ä–∞–±–æ—Ç–∞–µ—Ç

**–î–ª—è Config ($ARGUMENTS = "core/config.py"):**
- `test_exception_subdirs_correct` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ (ErExtract, ErNormalize)
- `test_constants_defined` ‚Äî –≤—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- `test_init_directory_structure` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–î–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π:**
- –¢–µ—Å—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (regression tests)
- –¢–µ—Å—Ç—ã –Ω–æ–≤–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (feature tests)
- –¢–µ—Å—Ç—ã –æ—à–∏–±–æ–∫ (error handling tests)

### 6. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:

```bash
# –ó–∞–ø—É—Å—Ç–∏ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã ‚Äî –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –£–ü–ê–°–¢–¨ (red phase)
pytest docprep/tests/test_<–º–æ–¥—É–ª—å>.py -v

# –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–¥ –µ—â—ë –Ω–µ –∏–∑–º–µ–Ω—ë–Ω.
```

### 7. –û—Ç—á—ë—Ç

```
üß™ –¢–ï–°–¢–´ –ù–ê–ü–ò–°–ê–ù–´ –î–õ–Ø: $ARGUMENTS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–§–∞–π–ª —Ç–µ—Å—Ç–æ–≤: docprep/tests/test_<–º–æ–¥—É–ª—å>.py

–ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã:
- test_xxx: [–æ–ø–∏—Å–∞–Ω–∏–µ]
- test_yyy: [–æ–ø–∏—Å–∞–Ω–∏–µ]
- test_zzz: [–æ–ø–∏—Å–∞–Ω–∏–µ]

–°—Ç–∞—Ç—É—Å: üî¥ –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç (–æ–∂–∏–¥–∞–µ–º–æ ‚Äî –∫–æ–¥ –µ—â—ë –Ω–µ –∏–∑–º–µ–Ω—ë–Ω)

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π? (–¥–∞/–Ω–µ—Ç)
```
