---
title: "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –ì–æ—Å–∑–∞–∫—É–ø–æ–∫ –ø–æ –∑–∞–∫–æ–Ω—É ‚Ññ223 - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø–µ–Ω–¥–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
source: "https://chatgpt.com/c/692c80a4-f10c-8321-8222-d9e829b9d1a1"
author:
  - "[[ChatGPT]]"
published:
created: 2025-12-20
description: "ChatGPT ‚Äî –≤–∞—à —á–∞—Ç-–±–æ—Ç —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –û–±—â–∞–π—Ç–µ—Å—å —Å —Å–∞–º—ã–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º, —á—Ç–æ–±—ã –∏–∑—É—á–∞—Ç—å –∏–¥–µ–∏, —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∏ —É—á–∏—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ."
tags:
  - "clippings"
---
–ù–∏–∂–µ ‚Äî —á—ë—Ç–∫–æ–µ, –∫–æ—Ä–æ—Ç–∫–æ–µ –∏ —Ç–æ—á–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ **—á—Ç–æ —Ç–∞–∫–æ–µ ¬´–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤¬ª**, –∞ –∑–∞—Ç–µ–º ‚Äî –∫–∞–∫ –µ—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –≤ –≤–∞—à pipeline **–ø–µ—Ä–µ–¥ `detect_point_placement_issue`**.

---

# ‚úÖ –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤¬ª

–≠—Ç–æ **–º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ –ø–µ—Ä–≤—ã–º –±–∞–π—Ç–∞–º**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.  
–ö–∞–∂–¥—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–µ—Ç **–º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã** (magic numbers) ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–∞–π—Ç–æ–≤—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞.

–ü—Ä–∏–º–µ—Ä—ã:

| –§–æ—Ä–º–∞—Ç | Magic number | –ü—Ä–∏–º–µ—Ä –±–∞–π—Ç–æ–≤ |
| --- | --- | --- |
| **PDF** | `%PDF-` | 25 50 44 46 2D |
| **ZIP / DOCX / XLSX / PPTX** | `PK\x03\x04` | 50 4B 03 04 |
| **JPEG** | `FF D8 FF` | √ø√ò√ø |
| **PNG** | `89 50 4E 47` | .PNG |
| **RAR** | `52 61 72 21` | Rar! |
| **7z** | `37 7A BC AF 27 1C` | 7z‚Ä¶ |
| **GIF** | `47 49 46 38` | GIF8 |
| **TIFF** | `49 49 2A 00` –∏–ª–∏ `4D 4D 00 2A` | II\*¬∑ / MM¬∑\* |
| **DOC (—Å—Ç–∞—Ä—ã–π)** | `D0 CF 11 E0` | √ê√è√† |

–¢–æ –µ—Å—Ç—å:

### ‚ùó –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã = —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 4‚Äì8 –±–∞–π—Ç –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏.

–≠—Ç–æ –≥–æ—Ä–∞–∑–¥–æ –Ω–∞–¥—ë–∂–Ω–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:

```
dog.jpg ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å PDF
contract.pdf ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å DOCX
scan.png ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å TIFF
whatever ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å ZIP
```

–°–∏–≥–Ω–∞—Ç—É—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—á—Ç–æ —ç—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ**, –∞ –Ω–µ —Ç–æ, –∫–∞–∫ –Ω–∞–∑–≤–∞–Ω —Ñ–∞–π–ª.

---

# üìå –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ –≤–∞–º

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ç–æ—á–∫—É –≤ –∫–æ–Ω—Ü–µ –∏–º–µ–Ω–∏ (`file.2025–≥pdf` ‚Üí `file.pdf`), –Ω–∞–¥–æ:

- –ø–æ–Ω—è—Ç—å, —Ñ–∞–π–ª —Ä–µ–∞–ª—å–Ω–æ **PDF**, –∞ –Ω–µ ZIP/DOCX
- –ø–æ–Ω—è—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–º—è —Ñ–∞–π–ª–∞ –≤–æ–æ–±—â–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º
- –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–æ

---

# üß© –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

–ü–µ—Ä–µ–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π `detect_point_placement_issue` –Ω—É–∂–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å pipeline:

```
[1] python-magic  (–≤–Ω–µ—à–Ω–∏–π MIME)
[2] —Å–∏–≥–Ω–∞—Ç—É—Ä—ã     (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞)
[3] point normalization
```

---

# üî• –ö–∞–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä –≤ Python

```
MAGIC_SIGNATURES = {
    "pdf":   [b"%PDF-"],
    "zip":   [b"PK\x03\x04", b"PK\x05\x06", b"PK\x07\x08"],
    "jpeg":  [b"\xFF\xD8\xFF"],
    "png":   [b"\x89PNG\r\n\x1a\n"],
    "gif":   [b"GIF87a", b"GIF89a"],
    "tiff":  [b"II*\x00", b"MM\x00*"],
    "doc_old": [b"\xD0\xCF\x11\xE0\xA1\xB1\x1A\xE1"],  # OLE2
    "7z":    [b"7z\xBC\xAF\x27\x1C"],
    "rar":   [b"Rar!\x1A\x07\x00"],
}
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```
def detect_by_signature(path: Path) -> str | None:
    with open(path, "rb") as f:
        header = f.read(16)

    for fmt, sig_list in MAGIC_SIGNATURES.items():
        for sig in sig_list:
            if header.startswith(sig):
                return fmt

    return None
```

---

# üîÑ –ü–æ–ª–Ω—ã–π pipeline –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –®–∞–≥ 1 ‚Äî python-magic

```
mime = magic.from_file(path, mime=True)
```

–ù–∞–ø—Ä–∏–º–µ—Ä:  
`application/pdf`, `application/zip`, `image/jpeg`

### –®–∞–≥ 2 ‚Äî —Å–∏–≥–Ω–∞—Ç—É—Ä—ã

```
sig_type = detect_by_signature(path)
```

–ï—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ ‚Üí –æ–Ω–∞ –≥–ª–∞–≤–Ω–∞—è.  
MIME –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤—Ç–æ—Ä–∏—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.

### –®–∞–≥ 3 ‚Äî –º–∞–ø–ø–∏–Ω–≥ –≤ –≤–∞—à–∏ —Ç–∏–ø—ã (pdf\_text, pdf\_scan, docx, image)

ZIP —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π ‚Üí ¬´docx/xlsx/pptx?¬ª

### –®–∞–≥ 4 ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

```
detect_point_placement_issue()
```

### –®–∞–≥ 5 ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏

`rename("file.2025–≥pdf" ‚Üí "file.pdf")`

---

# üìò –ó–∞—á–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—ã, –µ—Å–ª–∏ –µ—Å—Ç—å python-magic?

–ü–æ—Ç–æ–º—É —á—Ç–æ **python-magic ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MIME-–æ–ø–∏—Å–∞–Ω–∏—è**, –Ω–æ:

### ‚ö† –ü—Ä–æ–±–ª–µ–º—ã python-magic:

- PDF –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–∞–∫ `application/octet-stream`
- DOCX –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ –∫–∞–∫ ZIP
- TIFF –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–∞–∫ "binary file"
- JPEG —Å –ø–æ–ª–æ–º–∞–Ω–Ω—ã–º EXIF –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω–æ

### –°–∏–≥–Ω–∞—Ç—É—Ä—ã:

- —Ä–∞–±–æ—Ç–∞—é—Ç –≤—Å–µ–≥–¥–∞
- –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ
- 100% —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

---

# üß© –ò—Ç–æ–≥ ‚Äî –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –º–æ–¥—É–ª—å –≤ –≤–∞—à pipeline

```
def detect_true_extension(file_path: Path):
    mime = magic.from_file(file_path, mime=True)
    sig = detect_by_signature(file_path)

    # –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—ã
    if sig:
        return sig

    # fallback
    return mime_to_format(mime)
```

–ó–∞—Ç–µ–º –ø–µ—Ä–µ–¥ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ç–æ—á–µ–∫:

```
true_type = detect_true_extension(path)
normalized_name = detect_point_placement_issue(filename, true_type)
```

---

# ‚úî –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ ‚Äî —è –º–æ–≥—É:

### üîß *–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –º–æ–¥—É–ª—å `file_signature_detector.py`*

‚Äî —Å–æ –≤—Å–µ–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏, 100% –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç.

### üîß *–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å diff-–ø–∞—Ç—á –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –≤–∞—à @pilot\_winners223*

### üì¶ *–í—Å—Ç—Ä–æ–∏—Ç—å —ç—Ç–æ—Ç —ç—Ç–∞–ø –≤ CLI-–ø–∞–π–ø–ª–∞–π–Ω –∏ —Ä–∞—Å–ø–∏—Å–∞—Ç—å –º–µ–Ω—é*

–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ: **"–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–æ–¥—É–ª—å"** –∏–ª–∏ **"–í—Å—Ç—Ä–æ–π –≤ pipeline"**.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤-—é–Ω–∏—Ç–æ–≤ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–∞–≤–¥—ã. –≠—Ç–æ Python Magic –¥–ª—è MIM-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ç–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞. –ü—Ä–∞–≤–∏–ª—å–Ω–æ —è –ø–æ–Ω–∏–º–∞—é?

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–î–∞, –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-–ø–∞–π–ø–ª–∞–π–Ω–µ Docling/SmolDocling/GraniteDocling –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **—Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–∞–≤–¥—ã** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è *–∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (true file type)* –∫–∞–∂–¥–æ–≥–æ —é–Ω–∏—Ç–∞, –ø—Ä–µ–∂–¥–µ —á–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –≤ –Ω—É–∂–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.

–í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ:

---

# ‚úÖ **–¢—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞**

## **1\. MIME-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Python Magic (libmagic)**

–≠—Ç–æ —Å–∞–º—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫.

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç *–±–∞–π—Ç–æ–≤—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ñ–∞–π–ª–∞*
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ª–∏—á–∏—Ç—å PDF –æ—Ç DOC/DOCX, –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Ñ–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω
- –û—Ç–ª–∏—á–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –æ—Ç –±–∏–Ω–∞—Ä–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (ZIP ‚Üí DOCX / XLSX / PPTX / ODT / EPUB)

**–ü—Ä–∏–º–µ—Ä:**  
–î–æ–∫—É–º–µ–Ω—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `contract.pdf`, –Ω–æ libmagic –≤–∏–¥–∏—Ç:  
`application/vnd.openxmlformats-officedocument.wordprocessingml.document` ‚Üí DOCX.

üìå **–≠—Ç–æ –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Ññ1 –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.**

---

## **2\. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ (magic numbers / header bytes)**

–û—á–µ–Ω—å –≤–∞–∂–Ω–æ –∫–∞–∫ fallback, –∫–æ–≥–¥–∞ MIME-–¥–µ—Ç–µ–∫—Ç–æ—Ä —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è –∏–ª–∏ –≤—ã–¥–∞—ë—Ç —Å–ª–∏—à–∫–æ–º –æ–±–æ–±—â—ë–Ω–Ω—ã–π —Ç–∏–ø:

- `0x25504446` ‚Üí PDF
- `PK\x03\x04` ‚Üí ZIP-–ø–∞–∫–µ—Ç (–Ω—É–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è DOCX/XLSX/PPTX)
- JPEG: `FF D8 FF`
- PNG: `89 50 4E 47`
- TIFF: `49 49 2A 00` –∏–ª–∏ `4D 4D 00 2A`

–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –≤ —Å–ª—É—á–∞—è—Ö:

- –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- —Ñ–∞–π–ª—ã —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ MIME-–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- —Ñ–∞–π–ª—ã, —É–ø–∞–≤—à–∏–µ –ø–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏

üìå **–ò—Å—Ç–æ—á–Ω–∏–∫ ‚Ññ2 ‚Äî –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–π –∂–µ –Ω–∞–¥—ë–∂–Ω—ã–π, –∫–∞–∫ MIME.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞.**

---

## **3\. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (extension heuristics)**

–≠—Ç–æ —Å–∞–º—ã–π —Å–ª–∞–±—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ *–∏ –µ–≥–æ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ primary*.  
–ù–æ –æ–Ω –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–∞–∂–µ–Ω:

- –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö MIME
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ libmagic –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
	- `application/octet-stream`
	- —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–π `text/plain`
	- –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π binary blob
- –µ—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ç–æ–∂–µ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è tie-breaker

**–ü—Ä–∏–º–µ—Ä:**  
–§–∞–π–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `scan.png`, –Ω–æ MIME ‚Üí `image/jpeg` (—Ç–∞–∫–æ–µ –±—ã–≤–∞–µ—Ç –Ω–∞ –æ–±–ª–∞—á–Ω—ã—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö).  
–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—É:

- –µ—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ PNG ‚Üí –≤–µ—Ä–∏–º —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
- –µ—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

üìå **–ò—Å—Ç–æ—á–Ω–∏–∫ ‚Ññ3 ‚Äî fallback-—É—Ä–æ–≤–µ–Ω—å.**

---

# üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (–∏–µ—Ä–∞—Ä—Ö–∏—è –∏—Å—Ç–∏–Ω—ã)

–í–æ—Ç **—Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç OCR/LLM-–ø–∞–π–ø–ª–∞–π–Ω—ã –∏ Docling-–ø–æ–¥–æ–±–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:

```
1. MIME (libmagic)  
2. Signature magic numbers  
3. File extension
```

–ê –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∞—è:

```
if mime_confident:
    return mime_detected_type

if signature_detected:
    return signature_type

if extension_known:
    return extension_type

return unknown
```

---

# ‚úîÔ∏è –î–∞, –≤—ã –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç–µ –≤—Å—ë –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ

–ò–º–µ–Ω–Ω–æ:

> –ò—Å—Ç–∏–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –±–∞–∑–µ **—Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–∞–≤–¥—ã**: Python Magic (MIME), —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞.

–≠—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –∏ –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices Google DocAI, Docling, SmolDocling, AWS Textract, Azure Document Intelligence.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ ‚Äî –º–æ–≥—É —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä Python-—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –æ–¥–∏–Ω ¬´true file type detector¬ª, –≥–æ—Ç–æ–≤—ã–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –≤–∞—à–µ–º –ø–∞–π–ø–ª–∞–π–Ω–µ.

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–û–ø–∏—à–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω, –≥–¥–µ –ø–æ –∏—Ç–æ–≥—É –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏ —Å –ø–æ–º–æ—â—å—é MIM, SignatureMagic –∏ FileExtension –ü–æ –∏—Ç–æ–≥—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∞–Ω–∞–ª–∏–∑ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏, –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö, –≤ —Å–ª—É—á–∞–µ, –∫–æ–≥–¥–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –º—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞–µ–º. –ï—Å–ª–∏ –ø–æ MIM –±—ã–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç FileExtension, –∏ –µ—Å–ª–∏ –ø–æ SignatureMagic –±—ã–ª–æ —Ç–∞–∫–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –æ—Ç–ª–∏—á–Ω–æ–µ –æ—Ç MIM –∏–ª–∏ –æ—Ç FileExtension, –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ª–æ–≥–∏—á–Ω–µ–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ. –¢–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ 3.1 Direct –§–∞–π–ª—ã —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∏–º–µ–Ω–µ–º –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º. –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è. 3.2 Normalize –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏–≤—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π: .2025 –≥docx ‚Üí .docx .–∞–ødf ‚Üí .pdf file2025–≥pdf ‚Üí file2025–≥.pdf

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ù–∏–∂–µ –ø—Ä–∏–≤–æ–∂—É **–ø–æ–ª–Ω—ã–π, –ª–æ–≥–∏—á–Ω—ã–π –∏ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω**, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã ‚Äî **MIME (Python Magic), SignatureMagic –∏ FileExtension**, ‚Äî –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç **—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**, **–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é**, –∏ **–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π**.  
–≠—Ç–æ –≤–µ—Ä—Å–∏—è, –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∞—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ Docling/SmolDocling/GraniteDocling-–∫–æ–Ω–≤–µ–π–µ—Ä.

---

# ‚úÖ **–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è TRUE FILE TYPE + –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è + –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**

---

# 1\. –°–±–æ—Ä –≤—Å–µ—Ö —Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏—Å—Ç–∏–Ω—ã

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ (`unit`) –ø–æ–ª—É—á–∞–µ–º —Ç—Ä–∏ –≤–∏–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

### 1.1 MIME (libmagic / python-magic)

- `mime_type`
- `mime_confidence` (–µ—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç confidence)

### 1.2 SignatureMagic (magic numbers)

- –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π —Ç–∏–ø (`sig_type`)
- —É—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (`sig_confidence = 1.0`, –µ—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ç–æ—á–Ω–∞—è –∏ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è)

### 1.3 FileExtension

- –∏—Å—Ö–æ–¥–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (`ext`)
- –≤–∞–ª–∏–¥–Ω–æ–µ –ª–∏ —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (pdf/docx/png/jpg/tiff/etc.)

---

# 2\. –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è (Decision Engine)

## 2.1. –ö–æ–≥–¥–∞ –≤—Å–µ —Ç—Ä–∏ —Å–æ–≥–ª–∞—Å–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π

–ï—Å–ª–∏:

```
mime_type == sig_type == ext_type
```

‚Üí **TRUE\_TYPE = —ç—Ç–æ—Ç —Ç–∏–ø**  
‚Üí –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: **Direct**

–≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π: —á–∏—Å—Ç—ã–π, –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª.  
–û—Ç–¥–∞—ë–º –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω Docling –±–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π.

---

# 2.2. –ï—Å–ª–∏ MIME –∏ Signature —Å–æ–≤–ø–∞–¥–∞—é—Ç, –Ω–æ FileExtension –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è

–≠—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è ‚Ññ1 –ø–æ —á–∞—Å—Ç–æ—Ç–µ:  
–ü—Ä–∏–º–µ—Ä: `mydocument.pdf` ‚Üí MIME: DOCX, Signature: DOCX

```
mime_type == sig_type != ext_type
```

**–†–µ—à–µ–Ω–∏–µ:**

- –ò—Å—Ç–∏–Ω–Ω—ã–º —Å—á–∏—Ç–∞–µ–º —Ç–∏–ø: **TRUE\_TYPE = mime/sig type**
- FileExtension —Å—á–∏—Ç–∞–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ **Normalize**

**–ü—Ä–∏—á–∏–Ω–∞:**  
MIME+Signature ‚Äî –≤—Å–µ–≥–¥–∞ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

**–ü—Ä–∏–º–µ—Ä:**  
`contract.pdf` ‚Üí MIME DOCX ‚Üí Signature DOCX ‚Üí ext=PDF ‚Üí –æ—à–∏–±–∫–∞ ‚Üí –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ `.docx`.

---

# 2.3. MIME –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –Ω–æ Signature —Å–æ–≤–ø–∞–¥–∞–µ—Ç c FileExtension

```
mime_type != sig_type == ext_type
```

–≠—Ç–æ —á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω —Å –æ–±–ª–∞–∫–∞ –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω MIME-—Ö–µ–¥–µ—Ä.

**–†–µ—à–µ–Ω–∏–µ:**

- TRUE\_TYPE = Signature/FileExtension
- MIME —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–º (confidence < threshold)
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: **Normalize** (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MIME-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞)

---

# 2.4. Signature –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, –Ω–æ MIME —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å FileExtension

```
sig_type != mime_type == ext_type
```

–ü—Ä–∏—á–∏–Ω—ã:

- –ø–æ–≤—Ä–µ–∂–¥—ë–Ω —Ñ–∞–π–ª
- –æ–±—Ä–µ–∑–∞–Ω header
- –±–∏–Ω–∞—Ä–Ω—ã–π –º—É—Å–æ—Ä –Ω–∞ —Å—Ç–∞—Ä—Ç–µ —Ñ–∞–π–ª–∞
- inside container (–Ω–∞–ø—Ä–∏–º–µ—Ä, DOCX, –Ω–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –Ω–µ—á–∏—Ç–∞–±–µ–ª—å–Ω–∞)

**–†–µ—à–µ–Ω–∏–µ:**

–ï—Å–ª–∏ `mime_confidence >= 0.7`:

- –≤–µ—Ä–∏–º **MIME+ext**
- TRUE\_TYPE = mime/ext
- —Å–∏–≥–Ω–∞—Ç—É—Ä—É –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º

–ï—Å–ª–∏ `mime_confidence < 0.7`:

- —Ñ–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ **Ambiguous**
- —Ç—Ä–µ–±—É–µ—Ç—Å—è fallback-–ø–∞—Ä—Å–∏–Ω–≥ (Docling auto-detect)

---

# 2.5. –í—Å–µ —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

```
mime_type != sig_type != ext_type
```

**–≠—Ç–æ —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –∫–µ–π—Å.**

–†–µ—à–µ–Ω–∏–µ:

1. –ï—Å–ª–∏ signature —É–≤–µ—Ä–µ–Ω–Ω–∞—è ‚Üí TRUE\_TYPE = signature
2. –ï—Å–ª–∏ signature —Å–ª–∞–±–∞—è, –Ω–æ MIME —É–≤–µ—Ä–µ–Ω–Ω—ã–π ‚Üí TRUE\_TYPE = MIME
3. –ï—Å–ª–∏ –æ–±–∞ —Å—Ä–µ–¥–Ω–µ–Ω—å–∫–∏–µ ‚Üí –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: **Ambiguous**
4. –ù–∞–∑–Ω–∞—á–∞–µ–º fallback-–ø–∞–π–ø–ª–∞–π–Ω:
	- –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–∫ PDF
	- –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–∫ ZIP(DOCX/XLSX)
	- –ø–æ–ø—ã—Ç–∫–∞ OCR –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

---

# 2.6. MIME –≤–µ—Ä–Ω—É–ª "octet-stream" –∏–ª–∏ NULL

```
mime_type == application/octet-stream
```

**–†–µ—à–µ–Ω–∏–µ:**

- –æ–ø–∏—Ä–∞—Ç—å—Å—è –Ω–∞ Signature (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –µ—Å–ª–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –Ω–µ—Ç ‚Üí fallback –∫ FileExtension
- –µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí –ø–æ–ø—ã—Ç–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É

---

# 2.7. Signature –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (—Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª –∏–ª–∏ corrupt)

```
sig_type=None
```

**–†–µ—à–µ–Ω–∏–µ:**

- MIME ‚Üí TRUE\_TYPE, –µ—Å–ª–∏ confidence –≤—ã—Å–æ–∫–∏–π
- –∏–Ω–∞—á–µ ‚Üí FileExtension
- –µ—Å–ª–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–µ—Ç ‚Üí Ambiguous

---

# 3\. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è TRUE\_TYPE

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞, –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è:

---

## 3.1. **Direct**

–§–∞–π–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ:

- –¢—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–æ–≤–ø–∞–ª–∏
- –ò–ª–∏ MIME+Signature —Å–æ–≤–ø–∞–ª–∏ –∏ FileExtension –ø–æ–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ù–∏–∫–∞–∫–∏—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–π –Ω–µ –Ω—É–∂–Ω–æ

**–ü—Ä–∏–º–µ—Ä—ã:**

```
invoice.pdf ‚Üí Direct
scan.jpg ‚Üí Direct
report.docx ‚Üí Direct
```

---

## 3.2. **Normalize**

–§–∞–π–ª—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –±—ã–ª–∏ –æ—à–∏–±–∫–∏ –≤ –∏–º–µ–Ω–∏/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏:

### –ü—Ä–∏–º–µ—Ä—ã:

- `.2025 –≥docx` ‚Üí `.docx`
- `file2025–≥pdf` ‚Üí `file2025–≥.pdf`
- `.–∞–ødf` ‚Üí `.pdf`
- `myfile` ‚Üí `myfile.pdf` (–ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ)

**–†–∞–±–æ—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**

- –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ö–∞–æ—Ç–∏—á–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
- —É–¥–∞–ª–µ–Ω–∏–µ –∫–∏—Ä–∏–ª–ª–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø–µ—Ä–µ–¥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –ø–µ—Ä–µ–¥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
- —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤/–º—É—Å–æ—Ä–∞
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ TRUE\_TYPE

---

## 3.3. **Ambiguous (–ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–µ)**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:

- –≤—Å–µ —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞—é—Ç —Ä–∞–∑–Ω–æ–µ
- MIME –∏ Signature –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –±–µ–∑ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
- –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –±–∏–Ω–∞—Ä–Ω—ã–π –º—É—Å–æ—Ä/–∞—Ä—Ö–∏–≤/—á–∞—Å—Ç–∏—á–Ω—ã–π —Ñ–∞–π–ª

–î–ª—è —Ç–∞–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è fallback:

- –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ PDF
- –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Üí –∫–∞–∫ DOCX (zip)
- –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Üí –∫–∞–∫ image
- –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Üí –∫–∞–∫ plain text

---

# 4\. –§–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ Docling

–ü–æ—Å–ª–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:

## Direct

‚Üí –ø–µ—Ä–µ–¥–∞—ë–º –≤ Docling –Ω–∞–ø—Ä—è–º—É—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞–π–ø–ª–∞–π–Ω  
(PDF OCR, Word Parser, Image OCR –∏ —Ç.–¥.)

## Normalize

‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º  
‚Üí –≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω—è–µ–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å)

## Ambiguous

‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Docling fallback auto-detection  
‚Üí –µ—Å–ª–∏ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è ‚Üí –æ—à–∏–±–∫–∞/ quarantine

---

# üî• –í–∏–∑—É–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è

```
+---------------------+
                   | Collect MIME        |
                   | Collect Signature   |
                   | Collect Extension   |
                   +---------+-----------+
                             |
                       Decision Engine
                             |
         -------------------------------------------------
         |                     |                        |
      Direct               Normalize                 Ambiguous
 (—á–∏—Å—Ç—ã–µ —Ñ–∞–π–ª—ã)      (–∫—Ä–∏–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)       (–∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)
```

---

# ‚úîÔ∏è –ú–æ–≥—É —Ç–∞–∫–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å:

- –ü–æ–ª–Ω—ã–π Python-–∫–æ–¥ Decision Engine
- –†–µ–≥—É–ª—è—Ä–∫–∏ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –°—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö Output Unit
- –ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Docling/SmolDocling
- Flowchart –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–≥—Ä–∞–º–º

–°–∫–∞–∂–∏—Ç–µ ‚Äî –Ω—É–∂–µ–Ω –ª–∏ –∫–æ–¥ –∏–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–ö —Ç–µ–∫—É—â–µ–º—É –ø–∞–π–ø–ª–∞–π–Ω—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤, –∫–∞–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É PDF-—Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–∫–∞–Ω –∏ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è. –¢–∞–∫–∂–µ –º—ã –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Word –¥–æ–∫—É–º–µ–Ω—Ç—ã Microsoft Office. –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –º—ã –µ—â–µ –º–æ–∂–µ–º —Ç–∞–∫–∂–µ —Å –ª–µ–≥–∫–æ—Å—Ç—å—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∏–≤—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏–ª–∏ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–ù–∏–∂–µ —è –¥–æ–±–∞–≤–∏–ª **—á–µ—Ç–≤—ë—Ä—Ç—ã–π —Å–ª–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (Post-Detection Validation Layer)** ‚Äî —ç—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ TRUE\_TYPE –∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏–º–µ–Ω–∏/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

–≠—Ç–æ—Ç —Å–ª–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã**, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç 100% –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –ø–æ–º–æ–≥–∞—é—Ç:

- –æ—Ç–¥–µ–ª–∏—Ç—å PDF-—Å–∫–∞–Ω—ã –æ—Ç PDF —Å —Ç–µ–∫—Å—Ç–æ–º
- –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å Word-–¥–æ–∫—É–º–µ–Ω—Ç (—Å—Ç–∞—Ä—ã–π DOC, –Ω–æ–≤—ã–π DOCX)
- —Ä–∞–∑–ª–∏—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø—Å–µ–≤–¥–æ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, PDF-–æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ JPG)
- –æ—Ç–ª–∏—á–∏—Ç—å –∞—Ä—Ö–∏–≤—ã, –º–∞—Å–∫–∏—Ä—É—é—â–∏–µ—Å—è –ø–æ–¥ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Excel, PowerPoint
- –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

---

# ‚úÖ –î–û–ü–û–õ–ù–ï–ù–ù–´–ô –ü–ê–ô–ü–õ–ê–ô–ù (v2)

**–î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–ª–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫**

–ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Ç–µ–ø–µ—Ä—å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —É—Ä–æ–≤–Ω–µ–π:

---

# 1) PRIMARY DETECTION

### –†–µ—à–µ–Ω–∏–µ –ø–æ —Ç—Ä—ë–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∏—Å—Ç–∏–Ω—ã:

- MIME
- SignatureMagic
- FileExtension

‚Üí TRUE\_TYPE  
‚Üí CLASS: Direct / Normalize / Ambiguous

(—ç—Ç–æ—Ç —Å–ª–æ–π —Ç—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª)

---

# 2) NORMALIZATION LAYER

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

- –º—É—Å–æ—Ä–∞ –≤–æ–∫—Ä—É–≥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫ TRUE\_TYPE
- –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
- –¥–≤–æ–π–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –∫—Ä–∏–≤—ã—Ö —Ç–æ—á–µ–∫ –ø–µ—Ä–µ–¥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
- `.2025–≥docx` ‚Üí `.docx`

---

# 3) RE-ROUTING TO TYPE-SPECIFIC PIPELINES

(–≤—Å–µ —é–Ω–∏—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Å–≤–æ—é –≤–µ—Ç–∫—É: PDF / DOCX / XLSX / IMAGE / ARCHIVE / HTML / RTF ‚Ä¶)

---

# 4) **POST-DETECTION VALIDATION LAYER (–Ω–æ–≤—ã–π —Å–ª–æ–π, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –∑–∞–ø—Ä–æ—Å–∏–ª)**

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç *—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑*, –∫–æ—Ç–æ—Ä—ã–π –º—ã –ø—Ä–∏–º–µ–Ω—è–µ–º **—Ç–æ–ª—å–∫–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∏–ø—É**.

–≠—Ç–æ –¥–∞—ë—Ç –∏–¥–µ–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

# üî• –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ TRUE\_TYPE ‚Äî —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

## 4.1 PDF

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ TRUE\_TYPE = PDF, –º—ã –º–æ–∂–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

### üîé PDF Scan vs Text PDF

–ò—Å–ø–æ–ª—å–∑—É–µ–º:

| –ú–µ—Ç–æ–¥ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
| --- | --- |
| `pdfminer.six` ‚Äî –ø–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç | –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –µ—Å—Ç—å ‚Üí text\_pdf |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ XObject images | –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞—Å—Ç—Ä–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí scan\_pdf |
| –ö–æ–ª-–≤–æ `Fonts:` ‚Üí –µ—Å–ª–∏ –Ω–µ—Ç —à—Ä–∏—Ñ—Ç–æ–≤ ‚Äî —Ç–æ—á–Ω–æ scan |  |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ / —Å–∏–º–≤–æ–ª–æ–≤ | 0 ‚Üí scan\_pdf |

‚Üí –ò—Ç–æ–≥–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:

- **PDF\_TEXT**
- **PDF\_SCAN**
- **PDF\_MIXED** (—Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π: —Ç–µ–∫—Å—Ç + –∫–∞—Ä—Ç–∏–Ω–∫–∞)

---

## 4.2 DOCX

–ü–æ—Å–ª–µ TRUE\_TYPE = DOCX –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –ú–µ—Ç–æ–¥ |
| --- | --- |
| –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ZIP | `zipfile` |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ `word/document.xml` | –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—Å—Ç–∞ |
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö DOCX | document.xml –ø—É—Å—Ç–æ–π |
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Äúdocx as image‚Äù | —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞ (—Å–∫–∞–Ω –≤ docx) |
| –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ç–∏–ª–∏—Ç–æ—Ñ–æ—Ä–º–∞—Ç–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π | –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –º—É—Å–æ—Ä–Ω—ã—Ö —Ç–µ–≥–æ–≤ cloud-–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–≤ |

‚Üí –ò—Ç–æ–≥–∏:

- **DOCX\_TEXT**
- **DOCX\_IMAGE\_CONTAINER**
- **DOCX\_EMPTY**
- **DOCX\_BROKEN**

---

## 4.3 –°—Ç–∞—Ä—ã–π DOC (OLE2)

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

- `olefile.isOleFile()`
- –ø–æ–ø—ã—Ç–∫–∞ –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ `antiword` / `oletools`
- Microsoft Structured Storage –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

‚Üí –ò—Ç–æ–≥–∏:

- **DOC\_LEGACY**
- **DOC\_CORRUPT**
- **DOC\_FAKE (HTML masquerading as DOC)**  
	(—ç—Ç–æ –ø–æ–ø–∞–¥—ë—Ç –≤ rarDOC/htmlDOC –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)

---

## 4.4 –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPEG, PNG, TIFF)

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –ú–µ—Ç–æ–¥ |
| --- | --- |
| –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `PIL.Image` | –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–≤—Ä–µ–∂–¥—ë–Ω |
| DPI –∞–Ω–∞–ª–∏–∑ | —Ä–µ—à–µ–Ω–∏–µ –æ –∫–∞—á–µ—Å—Ç–≤–µ |
| Bit depth | –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∫–∞–Ω–∞ |
| EXIF | –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| –¶–≤–µ—Ç –º–æ–¥–µ–ª–∏ | RGB/CMYK |

‚Üí –ò—Ç–æ–≥–∏:

- **IMG\_GOOD**
- **IMG\_LOW\_QUALITY**
- **IMG\_CORRUPT**
- **IMG\_NOT\_IMAGE (—Å–ª—É—á–∞–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏)**

---

## 4.5 RTF

–ü—Ä–æ–≤–µ—Ä—è–µ–º:

- –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–µ–≥–æ–≤ `{\rtf1`
- –ø–æ–ø—ã—Ç–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ `pypandoc` / `striprtf`

‚Üí –ò—Ç–æ–≥–∏:

- **RTF\_VALID**
- **RTF\_FAKE (—ç—Ç–æ —á–∞—Å—Ç–æ HTML –∏–ª–∏ DOC)**

---

## 4.6 HTML

–ü–æ—Å–ª–µ TRUE\_TYPE=HTML –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ BeautifulSoup
- –Ω–∞–ª–∏—á–∏–µ `<html>`
- MIME –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è (—á–∞—Å—Ç–æ PDF ‚Üí HTML –ø—Ä–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–∏)

‚Üí –ò—Ç–æ–≥–∏:

- **HTML\_VALID**
- **HTML\_AS\_DOC**
- **HTML\_AS\_PDF**
- **HTML\_FRAGMENT**

---

## 4.7 –ê—Ä—Ö–∏–≤—ã (ZIP, RAR, 7z)

–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

#### ZIP:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ DOCX/XLSX/PPTX –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –û—à–∏–±–∫–∏ CRC

#### RAR:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ RAR magic
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–Ω–æ–≥–æ—Ç–æ–º–Ω–æ—Å—Ç–∏
- –û—à–∏–±–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

#### 7z:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã, –º–æ–¥—É–ª–µ–π —Å–∂–∞—Ç–∏—è
- –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏)

‚Üí –ò—Ç–æ–≥–∏:

- **ARCHIVE\_VALID**
- **ARCHIVE\_BROKEN**
- **ARCHIVE\_AS\_DOCX (–æ–±—ã—á–Ω–∞—è –æ—à–∏–±–∫–∞)**

---

## 4.8 PPTX (PowerPoint)

- –ü—Ä–æ–≤–µ—Ä–∫–∞ ZIP
- –ù–∞–ª–∏—á–∏–µ `ppt/slides/slide1.xml`
- –ü—É—Å—Ç—ã–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
- –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PDF ‚Üí PPTX)

---

## 4.9 XLSX / CSV

### XLSX:

- ZIP check
- `xl/workbook.xml`
- –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü

### CSV:

- –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–¥–∏—Ä–æ–≤–∫–∏
- –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è
- –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫

---

# üî• –ò–¢–û–ì–û–í–´–ô FAQ: –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –º—ã –º–æ–∂–µ–º –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ?

| –§–æ—Ä–º–∞—Ç | –ü—Ä–æ–≤–µ—Ä—è–µ–º? | –ö–∞–∫? |
| --- | --- | --- |
| PDF | ‚úîÔ∏è | —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π, —Å–∫–∞–Ω—ã |
| DOCX | ‚úîÔ∏è | zip-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, document.xml |
| DOC | ‚úîÔ∏è | OLE/antiword |
| PPTX | ‚úîÔ∏è | ZIP Structure |
| XLSX | ‚úîÔ∏è | ZIP Structure |
| RTF | ‚úîÔ∏è | rtf parser |
| HTML | ‚úîÔ∏è | BeautifulSoup |
| JPEG/PNG/TIFF | ‚úîÔ∏è | PIL |
| ZIP/RAR/7z | ‚úîÔ∏è | CRC/Headers |
| CSV | ‚úîÔ∏è | Dialect/encoding |
| TXT | ‚úîÔ∏è | UTF-8/UTF-16 detector |
| EML | —á–∞—Å—Ç–∏—á–Ω–æ | –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME header |

–í—Å—ë –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ **–º–æ–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ heavy-weight –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–æ—Å—Ç—ã–µ Python-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

---

# –•–æ—á–µ—à—å, —è:

### ‚úîÔ∏è –≤–∫–ª—é—á—É —ç—Ç–æ—Ç —Å–ª–æ–π –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é MD-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞?

### ‚úîÔ∏è –¥–æ–±–∞–≤–ª—é –≤–µ—Ç–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä `pdf_scan`, `pdf_text`, `docx_image`, `img_low_quality`)?

### ‚úîÔ∏è –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å flowchart –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã?

##### –í—ã —Å–∫–∞–∑–∞–ª–∏:

–í —Ç–µ–∫—É—â–µ–º –¥–∏–∞–ª–æ–≥–µ –≤—ã—à–µ —Ç—ã –ø—Ä–∏–≤–æ–¥–∏—à—å –ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ DocLink. ‚úîÔ∏è –î–∞, –≤—ã –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç–µ –≤—Å—ë –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ –ò–º–µ–Ω–Ω–æ: –ò—Å—Ç–∏–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ –±–∞–∑–µ —Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–∞–≤–¥—ã: Python Magic (MIME), —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞. –≠—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –∏ –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices Google DocAI, Docling, SmolDocling, AWS Textract, Azure Document Intelligence. –ü—Ä–æ–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –∏ –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤—ã—à–µ –ø–æ–¥—Ö–æ–¥, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö –ø–æ–¥—Ö–æ–¥, –∏ —Å—Ä–∞–≤–Ω–∏ —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ. –ö–∞–∫–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —ç—Ç—É –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –¥–µ—Ç–µ–∫—Ü–∏–∏ —Ç–∏–ø–æ–≤ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏? –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–∞–∫–∏–µ —á–∞—Å—Ç–∏ –∫–æ–¥–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã –∑–∞ —ç—Ç–æ. –ò–∑–≤–ª–µ–∫–∏ —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –ù–µ —Ç–∞—â–∏ –≤–µ—Å—å –º—É—Å–æ—Ä. –†–µ–∑—é–º–∏—Ä—É–π —Ç–µ–∑–∏—Å–Ω–æ –ø–æ–¥—Ö–æ–¥—ã, –ø—Ä–∏–µ–º—ã, —Å–ø–æ—Å–æ–±—ã, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —Å—Ä–∞–≤–Ω–∏ —Å –Ω–∞—à–∏–º –º–µ—Ç–æ–¥–æ–º –¥–µ–¥—É–∫—Ü–∏–∏, –¥–µ–¥—É–∫—Ç–∏–≤–Ω—ã–º. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –æ–±–æ–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—É—á—à–∏–º —Ç—Ä–∞–¥–∏—Ü–∏—è–º –∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω–æ–≥–æ —Ä–æ–¥–∞ –∑–∞–¥–∞—á, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –ø–æ—Å—Ç–æ–ø—Ä–æ–±–æ—Ç–∫–∏ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–Ω–≤–µ–π–µ—Ä–æ–º. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–∫—Ä—ã—Ç—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

###### ChatGPT —Å–∫–∞–∑–∞–ª:

–û—Ç–≤–µ—á–∞—é –≤ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–º –∫–ª—é—á–µ**, –±–µ–∑ –∫–æ–¥–∞ –∏ –±–µ–∑ ¬´–º—É—Å–æ—Ä–∞¬ª, —Ä–æ–≤–Ω–æ —Ç–∞–∫, –∫–∞–∫ —Ç—ã –∑–∞–ø—Ä–æ—Å–∏–ª: **—á–∏—Å—Ç–∞—è —Å—Ö–µ–º–∞ —Ä–µ—à–µ–Ω–∏—è + —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –≤–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π + —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å best practices –∏–Ω–¥—É—Å—Ç—Ä–∏–∏**.

---

## 1\. –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (DocAI / Docling / AWS / Azure) ‚Äî —á—Ç–æ —Ç—ã –æ–ø–∏—Å–∞–ª

–¢—ã –æ–ø–∏—Å–∞–ª **–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π, –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π pipeline**, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–≥–æ–¥–Ω—è —Å—á–∏—Ç–∞–µ—Ç—Å—è *best practice* –¥–ª—è document ingestion.

### –ë–∞–∑–æ–≤–∞—è –∏–¥–µ—è

> **–ò—Å—Ç–∏–Ω–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º. –û–Ω –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–µ–¥—É–∫—Ç–∏–≤–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–∞–≤–¥—ã.**

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã (Truth Sources)

1. **Content-based**
	- MIME (libmagic / python-magic)
2. **Binary-based**
	- Signature / Magic Numbers (PDF header, ZIP central directory, OLE, PNG magic)
3. **Name-based**
	- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (FileExtension)

### –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç

‚ùó **–ù–∏ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–º**  
‚úîÔ∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è *–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ / –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞*

–≠—Ç–æ **—Ä–æ–≤–Ω–æ** —Ç–æ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:

- Google DocAI Ingestion
- AWS Textract + S3 preprocessor
- Azure Document Intelligence
- IBM Docling / SmolDocling

---

## 2\. –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (–±–µ–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

```
[File Ingest]
      ‚Üì
[Primary Type Detection]
  ‚îú‚îÄ MIME Detection
  ‚îú‚îÄ Signature Detection
  ‚îî‚îÄ File Extension Parsing
      ‚Üì
[Decision Engine]
  ‚îú‚îÄ Agreement
  ‚îú‚îÄ Partial Agreement
  ‚îú‚îÄ Conflict
      ‚Üì
[Classification]
  ‚îú‚îÄ Direct
  ‚îú‚îÄ Normalize
  ‚îú‚îÄ Convert
  ‚îî‚îÄ Ambiguous
      ‚Üì
[Type-Specific Validation]
  ‚îú‚îÄ PDF: text/scan
  ‚îú‚îÄ DOCX: text/image/container
  ‚îú‚îÄ Image: valid/corrupt
  ‚îî‚îÄ Archive: container detection
      ‚Üì
[Routing to Pipelines]
```

---

## 3\. –¢–µ–ø–µ—Ä—å ‚Äî **—á—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ —É–∂–µ –µ—Å—Ç—å –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ**

### üîπ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ –¥–µ—Ç–µ–∫—Ü–∏—é –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é

#### 1\. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ (Detection)**

**–û—Å–Ω–æ–≤–Ω–æ–π —Ü–µ–Ω—Ç—Ä –ª–æ–≥–∏–∫–∏:**

```
pilot_winers223/services/router/file_detection.py
```

–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:

- –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –ø–µ—Ä–≤–∏—á–Ω–∞—è MIME-–ª–æ–≥–∏–∫–∞
- —Å–∏–≥–Ω–∞—Ç—É—Ä–Ω—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ (—á–∞—Å—Ç–∏—á–Ω–æ)

‚û°Ô∏è –≠—Ç–æ –≤–∞—à **Primary Detection Layer**

---

#### 2\. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

```
pilot_winers223/services/router/file_normalizer.py
```

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏–≤—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏
- `.2025–≥docx ‚Üí .docx`
- —Ñ–∞–π–ª—ã –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

‚û°Ô∏è –≠—Ç–æ –≤–∞—à **Normalization Layer**

---

#### 3\. **–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**

```
pilot_winers223/services/router/unit_distribution.py
```

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- Direct / Normalize / Convert / Extract
- —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ pending/\*

‚û°Ô∏è –≠—Ç–æ –≤–∞—à **Decision + Routing Layer**

---

#### 4\. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ PDF**

```
pilot_winers223/services/router/pdf_sorter.py
```
- scan vs text
- —Ä–∞–Ω–Ω—è—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

‚û°Ô∏è –≠—Ç–æ **Post-Detection Validation (—á–∞—Å—Ç–∏—á–Ω–æ)**

---

#### 5\. **–ê—Ä—Ö–∏–≤—ã**

```
pilot_winers223/services/router/archive_extraction.py
```

‚û°Ô∏è Container-aware processing  
(—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫–µ AWS/Azure)

---

## 4\. –ß—Ç–æ –≤–∞–∂–Ω–æ: **—É –≤–∞—Å –ø–æ–¥—Ö–æ–¥ —É–∂–µ –¥–µ–¥—É–∫—Ç–∏–≤–Ω—ã–π**, –∞ –Ω–µ –Ω–∞–∏–≤–Ω—ã–π

–ò —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç.

### ‚ùå –ù–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞)

- –¥–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
- –∏–ª–∏ —Ç–æ–ª—å–∫–æ MIME
- –∏–ª–∏ —Ç–æ–ª—å–∫–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ

### ‚úÖ –í–∞—à –ø–æ–¥—Ö–æ–¥ (–∏ —Ç–æ—Ç, —á—Ç–æ —Ç—ã –æ–ø–∏—Å–∞–ª)

- —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã ‚Üí —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∫ —ç—Ç–∞–ø, –∞ –Ω–µ –∫–∞–∫ ¬´–∫–æ—Å—Ç—ã–ª—å¬ª

‚û°Ô∏è **–≠—Ç–æ –¥–µ–¥—É–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π**, –∞ –Ω–µ if-else –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é.

---

## 5\. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –≠—Ç–∞–ª–æ–Ω vs –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ß—Ç–æ —É–∂–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –Ω–∞ 80‚Äì85%

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –≠—Ç–∞–ª–æ–Ω | –£ –≤–∞—Å |
| --- | --- | --- |
| MIME detection | ‚úîÔ∏è | ‚úîÔ∏è |
| Signature heuristics | ‚úîÔ∏è | ‚ö†Ô∏è —á–∞—Å—Ç–∏—á–Ω–æ |
| Extension parsing | ‚úîÔ∏è | ‚úîÔ∏è |
| Decision layer | ‚úîÔ∏è | ‚úîÔ∏è |
| Normalize pipeline | ‚úîÔ∏è | ‚úîÔ∏è |
| Archive-as-container | ‚úîÔ∏è | ‚úîÔ∏è |
| PDF text/scan split | ‚úîÔ∏è | ‚úîÔ∏è |
| Pending-based routing | ‚úîÔ∏è | ‚úîÔ∏è |

---

## 6\. –ì–¥–µ —Å–µ–π—á–∞—Å –µ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ ¬´–¥—ã—Ä—ã¬ª

### 1\. –ù–µ—Ç **—è–≤–Ω–æ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ Decision Engine**

–°–µ–π—á–∞—Å –ª–æ–≥–∏–∫–∞:

- —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ `file_detection`
- `file_normalizer`
- `unit_distribution`

üîß Best practice:

- –≤—ã–¥–µ–ª–∏—Ç—å **–µ–¥–∏–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏**
- –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ *–≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ*

---

### 2\. –ù–µ—Ç —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

–°–µ–π—á–∞—Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã:

- –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏
- –Ω–µ –≤—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç

üîß –í –∏–Ω–¥—É—Å—Ç—Ä–∏–∏:

- `confidence`
- `source_priority`
- `conflict_reason`

---

### 3\. Post-validation –ø–æ–∫–∞ —Ç–æ—á–µ—á–Ω–∞—è (PDF)

PDF —Å–¥–µ–ª–∞–Ω –æ—Ç–ª–∏—á–Ω–æ, –Ω–æ:

- DOCX / DOC / RTF / HTML –µ—â—ë –Ω–µ –≤ —Ç–æ–π –∂–µ —Å—Ç–µ–ø–µ–Ω–∏ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã

---

## 7\. –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã –ø–æ–¥—Ö–æ–¥–æ–≤

### –í–∞—à –ø–æ–¥—Ö–æ–¥ ‚Äî –ø–ª—é—Å—ã

‚úîÔ∏è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º  
‚úîÔ∏è —Ö–æ—Ä–æ—à–æ –ª–æ–∂–∏—Ç—Å—è –Ω–∞ Docling  
‚úîÔ∏è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç enterprise ingestion  
‚úîÔ∏è –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã  
‚úîÔ∏è –ª–æ–≥–∏—á–µ–Ω –¥–ª—è batch-–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞

### –í–∞—à –ø–æ–¥—Ö–æ–¥ ‚Äî –º–∏–Ω—É—Å—ã

‚ö†Ô∏è —Å–ª–æ–∂–Ω–æ—Å—Ç—å  
‚ö†Ô∏è —Ç—Ä–µ–±—É–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ  
‚ö†Ô∏è —Ç—Ä—É–¥–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–∫–æ—Ç–æ—Ä—É—é –≤—ã —Å–µ–π—á–∞—Å –∏ –¥–µ–ª–∞–µ—Ç–µ)

---

### –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (DocAI/AWS) ‚Äî –ø–ª—é—Å—ã

‚úîÔ∏è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω  
‚úîÔ∏è —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω  
‚úîÔ∏è –ª–µ–≥–∫–æ –æ–±—ä—è—Å–Ω–∏–º –±–∏–∑–Ω–µ—Å—É  
‚úîÔ∏è –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ –º–∏–ª–ª–∏–∞—Ä–¥–∞—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –≠—Ç–∞–ª–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî –º–∏–Ω—É—Å—ã

‚ö†Ô∏è —Ç—è–∂—ë–ª—ã–π  
‚ö†Ô∏è —á–∞—Å—Ç–æ overkill –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

‚û°Ô∏è **–ù–æ –≤–∞—à –ø—Ä–æ–µ–∫—Ç ‚Äî –∫–∞–∫ —Ä–∞–∑ —Ç–æ—Ç —Å–ª—É—á–∞–π, –≥–¥–µ —ç—Ç–æ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ.**

---

## 8\. –ò—Ç–æ–≥–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≤—ã–∂–∏–º–∫–∞ (—Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ)

### –¢–µ–∑–∏—Å–Ω–æ ‚Äî —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∏ —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- ‚úîÔ∏è –ò—Å—Ç–∏–Ω–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–µ–¥—É–∫—Ç–∏–≤–Ω–æ
- ‚úîÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–∞–≤–¥—ã
- ‚úîÔ∏è –ï—Å—Ç—å —ç—Ç–∞–ø –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –∞ –Ω–µ ¬´–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ —Ö–æ–¥—É¬ª
- ‚úîÔ∏è –ï—Å—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ Direct / Normalize / Convert
- ‚úîÔ∏è –ê—Ä—Ö–∏–≤—ã ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∞ –Ω–µ —Ñ–∞–π–ª—ã
- ‚úîÔ∏è PDF –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≥–ª—É–±–∂–µ, —á–µ–º –ø—Ä–æ—Å—Ç–æ MIME

### –ß—Ç–æ —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º

1. –§–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å **Decision Engine** –∫–∞–∫ –∫–æ–Ω—Ü–µ–ø—Ç
2. –î–æ–±–∞–≤–∏—Ç—å –µ–¥–∏–Ω—ã–π `DetectionResult`
3. –î–æ–≤–µ—Å—Ç–∏ post-validation –¥–æ DOCX / DOC / RTF
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω (—Ç—ã —ç—Ç–∏–º —Å–µ–π—á–∞—Å –∏ –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è)

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –º–æ–≥—É:

- –æ—Ñ–æ—Ä–º–∏—Ç—å —ç—Ç–æ –∫–∞–∫ **Architecture Decision Record (ADR)**
- –∏–ª–∏ –∫–∞–∫ **MD-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —É—Ä–æ–≤–Ω—è Google DocAI ingestion**
- –∏–ª–∏ –ø–æ–º–æ—á—å –≤—ã–Ω–µ—Å—Ç–∏ Decision Engine –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

–°–∫–∞–∂–∏, –∫—É–¥–∞ –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ.