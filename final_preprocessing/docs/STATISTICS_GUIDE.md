# Руководство по статистике и метрикам

## Обзор

Система DocPrep предоставляет детальную статистику и метрики по обработке UNIT. Статистика собирается на всех этапах обработки и позволяет анализировать эффективность классификации и обработки.

## CLI команды статистики

### Показать статистику

```bash
# Базовая статистика
docprep stats show 2025-12-20

# Детальная статистика
docprep stats show 2025-12-20 --detailed

# Сохранить в файл
docprep stats show 2025-12-20 --output report.txt
```

### Сравнить циклы

```bash
# Сравнить циклы 1 и 2
docprep stats compare 2025-12-20 --cycle1 1 --cycle2 2
```

### Экспорт статистики

```bash
# Экспорт в Markdown
docprep stats export 2025-12-20 --format markdown --output report.md

# Экспорт в JSON
docprep stats export 2025-12-20 --format json --output report.json
```

## Формат отчета

### Общая статистика

```
ОБЩАЯ СТАТИСТИКА
--------------------------------------------------------------------------------
Всего UNIT: 2585
Пустых UNIT: 780 (30%)
UNIT с файлами: 1805 (69%)
Классифицировано: 2585
```

### Распределение по категориям

```
РАСПРЕДЕЛЕНИЕ ПО КАТЕГОРИЯМ (БЕЗ ПУСТЫХ UNIT)
--------------------------------------------------------------------------------
direct            1378 UNIT ( 76.3%)
extract            144 UNIT (  8.0%)
convert            133 UNIT (  7.4%)
mixed              128 UNIT (  7.1%)
normalize           22 UNIT (  1.2%)
unknown              0 UNIT (  0.0%)
```

### Статистика по расширениям

```
СТАТИСТИКА ПО РАСШИРЕНИЯМ (БЕЗ ПУСТЫХ UNIT)
--------------------------------------------------------------------------------
Расширение      Файлов     UNIT       % файлов     % UNIT    
--------------------------------------------------------------------------------
.pdf            1153       1144             59.1%     63.4%
.docx           435        429              22.3%     23.8%
.doc            172        172               8.8%      9.5%
.zip            94         94                4.8%      5.2%
.rar            36         36                1.8%      2.0%
...
```

### Детальная статистика PDF

```
ДЕТАЛЬНАЯ СТАТИСТИКА PDF (БЕЗ ПУСТЫХ UNIT)
--------------------------------------------------------------------------------
Всего PDF: 1153 файлов (1144 UNIT)
Процент от всех файлов: 59.1%
Процент от всех UNIT: 63.4%

Процент PDF от всех UNIT (без пустых): 63.4%

Распределение PDF UNIT по route:
--------------------------------------------------------------------------------
  pdf_scan                620 UNIT ( 34.3%)
  pdf_text                392 UNIT ( 21.7%)
  mixed                   132 UNIT (  7.3%)

  Формула: PDF_total (1144 UNIT, 63.4%) = 
    PDF_text (392 UNIT, 21.7%) + 
    PDF_scan (620 UNIT, 34.3%)
```

### Распределение по route

```
РАСПРЕДЕЛЕНИЕ ПО ROUTE
--------------------------------------------------------------------------------
pdf_scan               1262 ( 38.2%)
pdf_text                784 ( 23.8%)
docx                    678 ( 20.5%)
mixed                   572 ( 17.3%)
image_ocr                 4 (  0.1%)
```

## Метрики

### Процентные метрики

Система автоматически вычисляет процентные метрики:

1. **Процент файлов по расширениям**: Процент файлов каждого расширения от общего количества файлов
2. **Процент UNIT по расширениям**: Процент UNIT с каждым расширением от общего количества UNIT (без пустых)
3. **Процент по категориям**: Процент UNIT каждой категории от общего количества UNIT (с учетом и без пустых)
4. **Процент PDF по route**: Процент PDF UNIT каждого route от общего количества UNIT (без пустых)

### Формула для PDF

Для PDF файлов показывается формула разбивки:

```
PDF_total (X UNIT, Y%) = PDF_text (A UNIT, B%) + PDF_scan (C UNIT, D%)
```

Где:
- `PDF_total` - общее количество PDF UNIT
- `PDF_text` - PDF UNIT с текстовым содержимым
- `PDF_scan` - PDF UNIT со сканированным содержимым

## Анализ статистики

### Интерпретация результатов

1. **Высокий процент direct UNIT** (76.3%) - хороший знак, означает, что большинство файлов готовы к обработке без преобразований

2. **Низкий процент unknown UNIT** (0% для UNIT с файлами) - отличный результат, означает, что все файлы успешно классифицированы

3. **Распределение PDF по route** - показывает соотношение текстовых и сканированных PDF, что важно для планирования OCR обработки

4. **Процент по расширениям** - показывает распределение форматов файлов, что помогает понять структуру данных

### Рекомендации

1. **Всегда исключайте пустые UNIT** при анализе точности классификации
2. **Используйте процентные метрики** для сравнения разных дат
3. **Анализируйте route для PDF** для понимания распределения scan/text
4. **Сравнивайте циклы** для оценки эффективности обработки
5. **Экспортируйте статистику** для долгосрочного анализа

## Примеры использования

### Анализ эффективности классификации

```bash
# Получить статистику
docprep stats show 2025-12-20 --output stats.md

# Проанализировать unknown UNIT
grep -A 10 "UNKNOWN" stats.md
```

### Сравнение циклов обработки

```bash
# Сравнить циклы 1 и 2
docprep stats compare 2025-12-20 --cycle1 1 --cycle2 2
```

### Экспорт для анализа

```bash
# Экспорт в JSON для программного анализа
docprep stats export 2025-12-20 --format json --output stats.json

# Экспорт в Markdown для документации
docprep stats export 2025-12-20 --format markdown --output stats.md
```

## Технические детали

### Сбор статистики

Статистика собирается из:
- Manifest файлов UNIT
- Структуры директорий
- Информации о route из processing

### Хранение статистики

Статистика не сохраняется в базе данных, а собирается динамически при запросе. Это означает:
- Всегда актуальные данные
- Нет необходимости в синхронизации
- Возможность анализа исторических данных через manifest

### Производительность

Сбор статистики для 2585 UNIT занимает:
- ~5-10 секунд для базовой статистики
- ~10-20 секунд для детальной статистики
- ~20-30 секунд для экспорта в JSON

## Заключение

Система статистики предоставляет детальные метрики для анализа эффективности обработки. Используйте эти метрики для:
- Мониторинга качества классификации
- Планирования ресурсов для обработки
- Выявления проблем и узких мест
- Оптимизации процесса обработки

