# –û–±—ä—è—Å–Ω–µ–Ω–∏–µ Gateway Timeout vs Liveness/Readiness

## ‚ö†Ô∏è Gateway Timeout - —ç—Ç–æ –ù–ï Liveness/Readiness!

### Gateway Timeout (Ingress/Gateway)

**–ß—Ç–æ —ç—Ç–æ:**
- –¢–∞–π–º–∞—É—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ **Ingress Controller** –∏–ª–∏ **Gateway/Proxy**
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã–º
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è ‚Üí **502 Gateway Timeout**

**–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è:**
- –í Cloud.ru ML Inference —ç—Ç–æ –æ–±—ã—á–Ω–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö **Ingress** –∏–ª–∏ **Gateway**
- –ù–ï –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (Liveness/Readiness)

**–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 60-120 —Å–µ–∫—É–Ω–¥
- –î–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π: **300-600 —Å–µ–∫—É–Ω–¥**

**–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å:**
1. –í Cloud.ru Console ‚Üí ML Inference ‚Üí –í–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
2. –ò—Å–∫–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ **Ingress**, **Gateway**, –∏–ª–∏ **Proxy**
3. –£–≤–µ–ª–∏—á–∏—Ç—å **timeout** –∏–ª–∏ **proxy_read_timeout** –¥–æ 300-600 —Å–µ–∫—É–Ω–¥

---

### Liveness Probe (–ü—Ä–æ–±–∞ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)

**–ß—Ç–æ —ç—Ç–æ:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, **–∂–∏–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (–Ω–µ –∑–∞–≤–∏—Å –ª–∏)
- –ï—Å–ª–∏ –ø—Ä–æ–±–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Üí –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `/health` endpoint

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞):**
```
Liveness-–ø—Ä–æ–±–∞:
- –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 180 —Å–µ–∫
- –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—É—Å–∫–∞: 30 —Å–µ–∫
- –¢–∞–π–º–∞—É—Ç –ø—Ä–æ–±—ã: 10 —Å–µ–∫
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–±: 3
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–±: 3
- –ü—É—Ç—å: /health
```

**–≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ù–ï –≤–ª–∏—è—é—Ç –Ω–∞ Gateway Timeout!**

---

### Readiness Probe (–ü—Ä–æ–±–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏)

**–ß—Ç–æ —ç—Ç–æ:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, **–≥–æ—Ç–æ–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫**
- –ï—Å–ª–∏ –ø—Ä–æ–±–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Üí —Ç—Ä–∞—Ñ–∏–∫ –ù–ï –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –¢–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/health` endpoint

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞):**
```
Readiness-–ø—Ä–æ–±–∞:
- –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 180 —Å–µ–∫
- –ß–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—É—Å–∫–∞: 15 —Å–µ–∫
- –¢–∞–π–º–∞—É—Ç –ø—Ä–æ–±—ã: 10 —Å–µ–∫
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–±: 1
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–±: 3
- –ü—É—Ç—å: /health
```

**–≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–∂–µ –ù–ï –≤–ª–∏—è—é—Ç –Ω–∞ Gateway Timeout!**

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Gateway Timeout | Liveness Probe | Readiness Probe |
|----------|----------------|----------------|-----------------|
| **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–∞ | –ñ–∏–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | –ì–æ—Ç–æ–≤ –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| **–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** | –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞ | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫) | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (–∫–∞–∂–¥—ã–µ 15 —Å–µ–∫) |
| **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç** | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502 | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é |
| **Endpoint** | –õ—é–±–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/ocr`) | `/health` | `/health` |
| **–¢–∞–π–º–∞—É—Ç** | 60-120 —Å–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | 10 —Å–µ–∫ | 10 —Å–µ–∫ |
| **–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è** | Ingress/Gateway –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | Kubernetes/Cloud.ru ML Inference | Kubernetes/Cloud.ru ML Inference |

---

## üîß –ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å Gateway Timeout –≤ Cloud.ru

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö ML Inference

1. –ó–∞–π–¥–∏—Ç–µ –≤ Cloud.ru Console
2. ML Inference ‚Üí –í–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (`container-msobm-pine`)
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
4. –ò—â–∏—Ç–µ —Ä–∞–∑–¥–µ–ª:
   - **"Ingress Settings"**
   - **"Gateway Settings"** 
   - **"Proxy Settings"**
   - **"Advanced Settings"**
5. –ù–∞–π–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä:
   - `proxy_read_timeout`
   - `timeout`
   - `request_timeout`
   - `ingress_timeout`
6. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ: **300-600 —Å–µ–∫—É–Ω–¥** (5-10 –º–∏–Ω—É—Ç)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä—è–º—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

–í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Cloud.ru –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è timeout –Ω–∞ —É—Ä–æ–≤–Ω–µ Ingress Controller.

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç: **130-250 —Å–µ–∫—É–Ω–¥** (~2-4 –º–∏–Ω—É—Ç—ã)
- Gateway Timeout: **60-120 —Å–µ–∫—É–Ω–¥** (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: **502 Gateway Timeout**

### –†–µ—à–µ–Ω–∏–µ:
1. **–£–≤–µ–ª–∏—á–∏—Ç—å Gateway Timeout –¥–æ 300-600 —Å–µ–∫—É–Ω–¥**
2. **Liveness/Readiness –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å** (–æ–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ)

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ–ª—å–∑—è —É–≤–µ–ª–∏—á–∏—Ç—å timeout):

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
   - POST `/ocr` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `task_id`
   - GET `/ocr/status/{task_id}` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   - GET `/ocr/result/{task_id}` ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

2. **Polling —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏:**
   - –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ñ–æ–Ω–µ
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Å—Ç–∞—Ç—É—Å–∞

3. **Webhook/S3 callback:**
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ñ–æ–Ω–µ
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ S3
   - Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Ingress/Gateway –≤ Cloud.ru Console
- [ ] –ù–∞–π–¥–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä timeout (proxy_read_timeout, request_timeout, etc.)
- [ ] –£–≤–µ–ª–∏—á–µ–Ω timeout –¥–æ 300-600 —Å–µ–∫—É–Ω–¥
- [ ] –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

**Liveness –∏ Readiness –ø—Ä–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - –æ–Ω–∏ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏. –ü—Ä–æ–±–ª–µ–º–∞ –≤ Gateway/Ingress timeout, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Cloud.ru ML Inference.

