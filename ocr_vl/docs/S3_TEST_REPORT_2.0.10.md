# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ S3 –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–î–∞—Ç–∞:** 2025-12-10  
**–í–µ—Ä—Å–∏—è –æ–±—Ä–∞–∑–∞:** 2.0.10  
**URL —Å–µ—Ä–≤–∏—Å–∞:** `https://08d022b0-2b04-4a35-adb0-10b35daafed5.modelrun.inference.cloud.ru`

---

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Health Check

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **–£—Å–ø–µ—à–Ω–æ**

```
Status: 200
Service: –¥–æ—Å—Ç—É–ø–µ–Ω
PaddleOCR: ready
```

**–í—ã–≤–æ–¥:** –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.

---

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ S3 Upload Endpoint

**Endpoint:** `POST /test/s3-upload`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå **Gateway Timeout**

- **–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è:** 120 —Å–µ–∫—É–Ω–¥
- **–°—Ç–∞—Ç—É—Å:** Timeout
- **–ü—Ä–∏—á–∏–Ω–∞:** Gateway timeout –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞

**–í—ã–≤–æ–¥:** 
- Endpoint –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞
- Gateway timeout –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö endpoints

**Endpoints:**
- `GET /files` - Timeout
- `GET /files/{file_type}/{filename}` - –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è (–∏–∑-–∑–∞ timeout –Ω–∞ /files)
- `POST /test/s3-upload` - Timeout

**–í—ã–≤–æ–¥:** –í—Å–µ –Ω–æ–≤—ã–µ endpoints –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç –∏–∑-–∑–∞ Gateway timeout.

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### Gateway Timeout

**–ü—Ä–∏—á–∏–Ω–∞:**
- Gateway/Ingress –≤ Cloud.ru ML Inference –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- –¢–µ–∫—É—â–∏–π timeout, –≤–µ—Ä–æ—è—Ç–Ω–æ, –º–µ–Ω—å—à–µ 120 —Å–µ–∫—É–Ω–¥
- S3 –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –æ—Ç–≤–µ—Ç –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∫–ª–∏–µ–Ω—Ç–∞

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **S3 –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ Gateway –æ–±—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**
   - –§–∞–π–ª –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ S3 —É—Å–ø–µ—à–Ω–æ
   - –ù–æ HTTP –æ—Ç–≤–µ—Ç –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∫–ª–∏–µ–Ω—Ç–∞
   - **–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å Gateway timeout

2. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –¥–æ –≤–µ—Ä—Å–∏–∏ 2.0.10**
   - –ù–æ–≤—ã–µ endpoints –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞–∑–∞ –≤ Cloud.ru Console

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∏ S3**
   - S3 –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–∞—Ç—å
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –£–≤–µ–ª–∏—á–∏—Ç—å Gateway Timeout

–í Cloud.ru ML Inference Console:
- –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ù–∞–π—Ç–∏ "Ingress Settings" –∏–ª–∏ "Gateway Settings"
- –£–≤–µ–ª–∏—á–∏—Ç—å `proxy_read_timeout` –∏–ª–∏ `timeout` –¥–æ **300-600 —Å–µ–∫—É–Ω–¥**

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–í Cloud.ru Console ‚Üí –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
- –ò—Å–∫–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞:
  - `"Test S3 upload"`
  - `"Uploading to s3://"`
  - `"File uploaded successfully"`
  - `"S3 upload failed"`

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞–∑–∞

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ—Ä—Å–∏—é `2.0.10`:
- Cloud.ru Console ‚Üí –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URI –æ–±—Ä–∞–∑–∞: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `...:2.0.10` –∏–ª–∏ `...:latest`

### 4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏ S3

–ï—Å–ª–∏ Gateway timeout –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API, –º–æ–∂–Ω–æ:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤ S3 bucket –Ω–∞–ø—Ä—è–º—É—é:**
   ```bash
   # –ò—Å–ø–æ–ª—å–∑—É—è boto3 –Ω–∞–ø—Ä—è–º—É—é (–ª–æ–∫–∞–ª—å–Ω–æ)
   python3 -c "
   import boto3
   s3 = boto3.client('s3',
       endpoint_url='https://s3.cloud.ru',
       aws_access_key_id='...',
       aws_secret_access_key='...'
   )
   objects = s3.list_objects_v2(Bucket='bucket-winners223', Prefix='test-uploads/')
   for obj in objects.get('Contents', [])[:10]:
       print(obj['Key'], obj['LastModified'])
   "
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Cloud.ru Console:**
   - Object Storage ‚Üí bucket-winners223
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ `test-uploads/`

---

## üìä –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Cloud.ru Console**
   - –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏ –æ S3 –∑–∞–≥—Ä—É–∑–∫–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

2. ‚ö†Ô∏è **–£–≤–µ–ª–∏—á–∏—Ç—å Gateway Timeout –¥–æ 300-600 —Å–µ–∫—É–Ω–¥**
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Cloud.ru ML Inference

3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞–∑–∞**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 2.0.10

4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å S3 bucket –Ω–∞–ø—Ä—è–º—É—é**
   - –ß–µ—Ä–µ–∑ Cloud.ru Console –∏–ª–∏ boto3
   - –ò—Å–∫–∞—Ç—å —Ñ–∞–π–ª—ã –≤ `test-uploads/`

### –ï—Å–ª–∏ S3 –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—É–¥—è –ø–æ –ª–æ–≥–∞–º):

- –§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ S3
- –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ Gateway timeout
- –ù—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å timeout –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

### –ï—Å–ª–∏ S3 –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è S3 –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å S3 –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials S3

---

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Gateway Timeout

–ü–æ—Å–ª–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è Gateway timeout:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/test/s3-upload`:**
   ```bash
   curl -X POST "https://<url>/test/s3-upload" \
     -H "x-api-key: <API_KEY>" \
     -F "file=@test.txt"
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤:**
   ```bash
   curl -X GET "https://<url>/files" \
     -H "x-api-key: <API_KEY>"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:**
   ```bash
   curl -X GET "https://<url>/files/md/page_0001" \
     -H "x-api-key: <API_KEY>"
   ```

---

## üìù –í—ã–≤–æ–¥—ã

1. ‚úÖ **–°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç** - Health check –ø—Ä–æ—Ö–æ–¥–∏—Ç
2. ‚úÖ **–ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã** - PaddleOCR ready
3. ‚ùå **Gateway timeout –±–ª–æ–∫–∏—Ä—É–µ—Ç** –Ω–æ–≤—ã–µ endpoints
4. ‚ö†Ô∏è **–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã S3

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ Cloud.ru Console –∏ —É–≤–µ–ª–∏—á–∏—Ç—å Gateway timeout.

