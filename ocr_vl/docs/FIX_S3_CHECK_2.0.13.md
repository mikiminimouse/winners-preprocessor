# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ S3 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è - –≤–µ—Ä—Å–∏—è 2.0.13

**–î–∞—Ç–∞:** 2025-12-10  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ S3 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Cloud.ru

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è–ª–æ—Å—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
‚ö†Ô∏è  S3 bucket access test failed (but client initialized, will try upload anyway): 
Could not connect to the endpoint URL: "https://s3.cloud.ru/bucket-winners223?list-type=2&max-keys=1&encoding-type=url"
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- Cloud.ru S3 –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (`head_bucket`, `list_objects_v2`)
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `list_objects_v2` boto3 —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è path-style addressing
- –†–µ–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `upload_file()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `skip_check` –≤ `_check_s3_connection()`

**–ë—ã–ª–æ:**
```python
def _check_s3_connection() -> tuple:
    # –í—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ—Ç—Å—è head_bucket –∏ list_objects_v2
```

**–°—Ç–∞–ª–æ:**
```python
def _check_s3_connection(skip_check: bool = False) -> tuple:
    # –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è bucket)
    if skip_check:
        return True, None  # –ö–ª–∏–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞
```

### 2. –£–±—Ä–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `list_objects_v2`

**–ë—ã–ª–æ:**
```python
try:
    s3_client.head_bucket(...)
except:
    s3_client.list_objects_v2(...)  # –ú–æ–∂–µ—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
```

**–°—Ç–∞–ª–æ:**
```python
try:
    s3_client.head_bucket(...)
except:
    # –ù–µ –ø—Ä–æ–±—É–µ–º list_objects_v2 –¥–ª—è Cloud.ru S3
    # –†–µ–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ upload_file
    return True, "Connection check unavailable (but client configured)"
```

### 3. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–ë—ã–ª–æ:**
```python
logger.warning("‚ö†Ô∏è  S3 bucket access test failed...")
```

**–°—Ç–∞–ª–æ:**
```python
logger.debug("‚ö†Ô∏è  S3 bucket access test skipped (Cloud.ru S3 may not support head_bucket)")
logger.info("‚úÖ S3 client configured (connection test skipped for Cloud.ru compatibility)")
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `skip_check=True` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤

–í —Ñ—É–Ω–∫—Ü–∏—è—Ö `upload_to_cloudru()` –∏ `test_s3_upload()`:
```python
is_accessible, error_msg = _check_s3_connection(skip_check=True)
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ù–µ—Ç –ª–æ–∂–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è Cloud.ru S3
   - –†–µ–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–ß–∏—â–µ –ª–æ–≥–∏**
   - DEBUG —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
   - INFO —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - WARNING —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å Cloud.ru S3
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ AWS S3

---

## üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –§—É–Ω–∫—Ü–∏—è `_check_s3_connection()`:
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `skip_check: bool = False`
- –£–±—Ä–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `list_objects_v2` –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ S3:
- –£–±—Ä–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ `list_objects_v2`
- –ò–∑–º–µ–Ω–µ–Ω —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (WARNING ‚Üí DEBUG/INFO)

### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `skip_check=True` –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ S3 –∫–ª–∏–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –†–µ–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ß–∏—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ –ª–æ–≥–∏

---

**–í–µ—Ä—Å–∏—è 2.0.13 –≥–æ—Ç–æ–≤–∞. Cloud.ru S3 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –ª–æ–∂–Ω—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.**


















