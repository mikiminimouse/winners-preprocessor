# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Health Check –Ω–∞ Cloud.ru ML Inference

**–î–∞—Ç–∞:** 05.12.2025  
**–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –≤–µ—Ä—Å–∏–∏:** 1.3.6+

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç SIGTERM –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (~35 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞), –ø–æ—Ç–æ–º—É —á—Ç–æ Health Check –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ.

## üìã –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### Startup Probe (–ö–†–ò–¢–ò–ß–ù–û!)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Cloud.ru ML Inference:**

```
–¢–∏–ø: HTTP GET
–ü—É—Ç—å: /health
–ü–æ—Ä—Ç: 8081
Initial Delay: 10 —Å–µ–∫—É–Ω–¥
Period: 10 —Å–µ–∫—É–Ω–¥
Timeout: 5 —Å–µ–∫—É–Ω–¥
Failure Threshold: 50 (–º–∏–Ω–∏–º—É–º!)
Success Threshold: 1
```

**–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- –î–æ 50 –Ω–µ—É–¥–∞—á = –¥–æ 500 —Å–µ–∫—É–Ω–¥ (8+ –º–∏–Ω—É—Ç) –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
- 1 —É—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ = –≥–æ—Ç–æ–≤

**–í–∞–∂–Ω–æ:** Startup probe –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP 200 OK —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "starting" –∫–∞–∫ –≤–∞–ª–∏–¥–Ω—ã–π –æ—Ç–≤–µ—Ç!

### Liveness Probe

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**

```
–¢–∏–ø: HTTP GET
–ü—É—Ç—å: /health
–ü–æ—Ä—Ç: 8081
Initial Delay: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç!)
Period: 30 —Å–µ–∫—É–Ω–¥
Timeout: 10 —Å–µ–∫—É–Ω–¥
Failure Threshold: 3
Success Threshold: 1
```

**–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç (–¥–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- 3 –Ω–µ—É–¥–∞—á–∏ = –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### Readiness Probe

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**

```
–¢–∏–ø: HTTP GET
–ü—É—Ç—å: /health
–ü–æ—Ä—Ç: 8081
Initial Delay: 180 —Å–µ–∫—É–Ω–¥ (3 –º–∏–Ω—É—Ç—ã)
Period: 15 —Å–µ–∫—É–Ω–¥
Timeout: 5 —Å–µ–∫—É–Ω–¥
Failure Threshold: 3
Success Threshold: 1
```

**–ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
- 3 –Ω–µ—É–¥–∞—á–∏ = —É–±—Ä–∞—Ç—å –∏–∑ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞

## üéØ –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞ Cloud.ru

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ ML Inference —Å–µ—Ä–≤–∏—Å–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Health Checks" –∏–ª–∏ "Probes"
3. –î–æ–±–∞–≤—å—Ç–µ/–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:

   **Startup Probe:**
   - –ü—É—Ç—å: `/health`
   - –ü–æ—Ä—Ç: `8081`
   - Initial Delay: `10`
   - Period: `10`
   - Timeout: `5`
   - Failure Threshold: `50`
   - Success Threshold: `1`

   **Liveness Probe:**
   - –ü—É—Ç—å: `/health`
   - –ü–æ—Ä—Ç: `8081`
   - Initial Delay: `300`
   - Period: `30`
   - Timeout: `10`
   - Failure Threshold: `3`

   **Readiness Probe:**
   - –ü—É—Ç—å: `/health`
   - –ü–æ—Ä—Ç: `8081`
   - Initial Delay: `180`
   - Period: `15`
   - Timeout: `5`
   - Failure Threshold: `3`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ YAML/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–ï—Å–ª–∏ Cloud.ru –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```yaml
containers:
- name: paddleocr-vl-service
  image: docling-granite-258m.cr.cloud.ru/paddleocr-vl-service:1.3.6
  ports:
  - containerPort: 8081
    protocol: TCP
  startupProbe:
    httpGet:
      path: /health
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 50
    successThreshold: 1
  livenessProbe:
    httpGet:
      path: /health
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 300
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
    successThreshold: 1
  readinessProbe:
    httpGet:
      path: /health
      port: 8081
      scheme: HTTP
    initialDelaySeconds: 180
    periodSeconds: 15
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
```

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

### 1. Startup Probe –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!

**–ë–µ–∑ startup probe:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è liveness probe
- Liveness probe —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è

### 2. Failure Threshold –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= 50

**–ü–æ—á–µ–º—É:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç 80-90 —Å–µ–∫—É–Ω–¥
- –ü–ª—é—Å –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–ª—é—Å –∑–∞–ø–∞—Å –Ω–∞ —Å–ª—É—á–∞–π –∑–∞–¥–µ—Ä–∂–µ–∫
- –ò—Ç–æ–≥–æ: –º–∏–Ω–∏–º—É–º 2-3 –º–∏–Ω—É—Ç—ã, –ª—É—á—à–µ 5-8 –º–∏–Ω—É—Ç

### 3. –°—Ç–∞—Ç—É—Å "starting" –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è

**–í–∞–∂–Ω–æ:**
- Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 200 OK
- –î–∞–∂–µ –∫–æ–≥–¥–∞ —Å—Ç–∞—Ç—É—Å = "starting"
- Startup probe –¥–æ–ª–∂–µ–Ω —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º
- –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å–ª–æ–≤–∏–µ, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "healthy"

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

1. **0-10 —Å–µ–∫—É–Ω–¥:**
   - –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
   - Health check –µ—â–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è (initialDelaySeconds=10)

2. **10-100 —Å–µ–∫—É–Ω–¥:**
   - –ò–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   - Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{"status": "starting", "paddleocr": "initializing"}`
   - HTTP 200 OK
   - Startup probe –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–æ –ù–ï —É–±–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

3. **–ü–æ—Å–ª–µ 100+ —Å–µ–∫—É–Ω–¥:**
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
   - Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{"status": "healthy", "paddleocr": "ready"}`
   - HTTP 200 OK
   - Startup probe —Å—á–∏—Ç–∞–µ—Ç —ç—Ç–æ —É—Å–ø–µ—Ö–æ–º

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
   - –ù–µ—Ç –ª–∏ SIGTERM —á–µ—Ä–µ–∑ 30-40 —Å–µ–∫—É–Ω–¥
   - –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check endpoint:
   ```bash
   curl https://your-service-url/health
   ```
   - –í–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: `{"status": "starting", ...}`
   - –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: `{"status": "healthy", ...}`

## üìù –†–µ–∑—é–º–µ

**–ö–†–ò–¢–ò–ß–ù–û –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞:**

1. ‚úÖ Startup Probe —Å `failureThreshold=50`
2. ‚úÖ Liveness Probe —Å `initialDelaySeconds=300`
3. ‚úÖ Readiness Probe —Å `initialDelaySeconds=180`
4. ‚úÖ –í—Å–µ probe –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP 200 OK

**–ë–µ–∑ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
- –°–µ—Ä–≤–∏—Å –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ Cloud.ru –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã


