# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Cloud.ru ML Inference

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ (`/app/start.sh`)
**–ü—Ä–æ–±–ª–µ–º–∞:** vLLM —Å–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–ª –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–µ–∑ GPU, —á—Ç–æ –º–æ–≥–ª–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ `paddlex_genai_server`
- –û—à–∏–±–∫–∞ vLLM –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ FastAPI
- –°–µ—Ä–≤–∏—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –µ—Å–ª–∏ vLLM –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

### 2. –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PaddleOCR
**–ü—Ä–æ–±–ª–µ–º–∞:** PaddleOCR-VL –ø—ã—Ç–∞–ª—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ startup, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –∑–∞–ø—É—Å–∫ –±–µ–∑ GPU.

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PaddleOCR —Ç–µ–ø–µ—Ä—å –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è
- –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ –¥–∞–∂–µ –±–µ–∑ GPU
- PaddleOCR –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ (–∫–æ–≥–¥–∞ GPU –¥–æ—Å—Ç—É–ø–µ–Ω)

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ GPU
- –°–µ—Ä–≤–∏—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π health status –¥–∞–∂–µ –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ OCR

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ—Ä—Ç 8081: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
```bash
curl http://localhost:8081/health
# –û—Ç–≤–µ—Ç: {"status":"healthy","paddleocr":"not_initialized",...}
```

### FastAPI: ‚úÖ –ó–ê–ü–£–©–ï–ù
- –ü—Ä–æ—Ü–µ—Å—Å: `uvicorn server:app --host 0.0.0.0 --port 8081`
- –ü–æ—Ä—Ç—ã: EXPOSE 8080, 8081
- –°–ª—É—à–∞–µ—Ç: 0.0.0.0:8081

### Health Endpoint: ‚úÖ –î–û–°–¢–£–ü–ï–ù
- Path: `/health`
- Port: `8081`
- –û—Ç–≤–µ—Ç: JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è Cloud.ru ML Inference

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **GPU –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!**
   - –ë–µ–∑ GPU PaddleOCR-VL –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
   - OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: NVIDIA A100 –∏–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç

2. **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - –ú–æ–¥–µ–ª–∏ PaddleOCR-VL —Ç—Ä–µ–±—É—é—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É (1-3 –º–∏–Ω—É—Ç—ã)
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å startup probe —Å –±–æ–ª—å—à–∏–º failureThreshold

3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç:**
   - **8081** - –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ä—Ç –¥–ª—è FastAPI (—ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
   - 8080 - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–ª—è vLLM

## üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Cloud.ru

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```
Docker Image: docling-granite-258m.cr.cloud.ru/paddleocr-vl-service:latest
Port: 8081
Protocol: HTTP
```

### Health Checks:

**Startup Probe (–í–ê–ñ–ù–û!):**
```yaml
startupProbe:
  httpGet:
    path: /health
    port: 8081
  initialDelaySeconds: 0
  periodSeconds: 15
  timeoutSeconds: 10
  failureThreshold: 40  # –î–æ 10 –º–∏–Ω—É—Ç –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π
  successThreshold: 1
```

**Liveness Probe:**
```yaml
livenessProbe:
  httpGet:
    path: /health
    port: 8081
  initialDelaySeconds: 180  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3
  successThreshold: 1
```

**Readiness Probe:**
```yaml
readinessProbe:
  httpGet:
    path: /health
    port: 8081
  initialDelaySeconds: 240  # –ï—â–µ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1
```

### –†–µ—Å—É—Ä—Å—ã:

```yaml
resources:
  requests:
    cpu: "4"
    memory: "16Gi"
    nvidia.com/gpu: "1"  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
  limits:
    cpu: "8"
    memory: "32Gi"
    nvidia.com/gpu: "1"
```

### Environment Variables (–¥–ª—è S3):

```bash
CLOUDRU_S3_ENDPOINT=https://s3.cloud.ru
CLOUDRU_S3_BUCKET=bucket-winners223
CLOUDRU_S3_ACCESS_KEY=502f76f0-9017-493d-bda4-9e1bb278da84:ce94860ccc8780b2bc5f00f31459d24e
CLOUDRU_S3_SECRET_KEY=759469c88d6e450b584e2487c5174770
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º –Ω–∞ Cloud.ru

### –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å –¥–æ–ª–≥–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   kubectl logs -f deployment/paddleocr-vl-service
   ```

2. **–ò—â–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - ‚úÖ "Starting FastAPI handler on port 8081..." - FastAPI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
   - ‚úÖ "Uvicorn running on http://0.0.0.0:8081" - —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚ö†Ô∏è "PaddleOCR-VL initialization deferred" - –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
   - ‚ùå "ImportError: torch" - –ø—Ä–æ–±–ª–µ–º–∞ —Å GPU/CUDA
   - ‚ùå "Failed to initialize PaddleOCR-VL" - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ GPU –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å GPU:**
   ```bash
   kubectl exec -it deployment/paddleocr-vl-service -- nvidia-smi
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:**
   ```bash
   curl https://your-endpoint.modelrun.inference.cloud.ru/health
   ```

### –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:

- **–ë–µ–∑ GPU:** 10-30 —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ FastAPI)
- **–° GPU:** 2-5 –º–∏–Ω—É—Ç (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π)
- **–ü–µ—Ä–≤—ã–π OCR –∑–∞–ø—Ä–æ—Å:** –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ 30-60 —Å–µ–∫—É–Ω–¥ (–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏)

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–∞ Cloud.ru

- [ ] –û–±—Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- [ ] –û–±—Ä–∞–∑ –∑–∞–ø—É—à–µ–Ω –≤ Artifact Registry
- [ ] –£–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç: **8081**
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω health check –Ω–∞ `/health` –ø–æ—Ä—Ç–∞ **8081**
- [ ] –£–∫–∞–∑–∞–Ω GPU –≤ —Ä–µ—Å—É—Ä—Å–∞—Ö (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
- [ ] –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è startup probe (failureThreshold: 40)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è S3 (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ startup probe** —Å failureThreshold: 40 –¥–ª—è –ø–µ—Ä–≤—ã—Ö 10 –º–∏–Ω—É—Ç
2. **–£–≤–µ–ª–∏—á—å—Ç–µ initialDelaySeconds** –¥–ª—è liveness/readiness –¥–æ 180-240 —Å–µ–∫—É–Ω–¥
3. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ GPU** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø–µ—Ä–≤—ã–µ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint** –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥
2. ‚è≥ **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑** (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
3. ‚è≥ **–ó–∞–ø—É—à–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—Ä–∞–∑** –≤ Artifact Registry
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ML Inference —Å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

