# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **vLLM —Å–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–ª –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ** (–±–µ–∑ GPU)
   - –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ torch/NCCL - `undefined symbol: ncclCommWindowRegister`
   - –†–µ—à–µ–Ω–∏–µ: –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –µ—Å–ª–∏ vLLM –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

2. **PaddleOCR –ø–∞–¥–∞–ª –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ startup**
   - –ü—Ä–æ–±–ª–µ–º–∞: –¢—Ä–µ–±—É–µ—Ç—Å—è GPU –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
   - –†–µ—à–µ–Ω–∏–µ: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ª–æ–∂–µ–Ω–∞, —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

3. **–ü–æ—Ä—Ç 8081 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: FastAPI –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8081
   - Health endpoint –¥–æ—Å—Ç—É–ø–µ–Ω
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ—Ä—Ç 8081:
- ‚úÖ FastAPI —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8081
- ‚úÖ Health endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: `GET /health`
- ‚úÖ Swagger docs –¥–æ—Å—Ç—É–ø–Ω—ã: `GET /docs`

### Health Check Response:
```json
{
  "status": "healthy",
  "paddleocr": "not_initialized",
  "s3_storage": "not_configured",
  "output_dir": "/app/output",
  "temp_dir": "/app/temp"
}
```

### –ü—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
- ‚úÖ `uvicorn server:app` - –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8081
- ‚ö†Ô∏è `paddlex_genai_server` - –Ω–µ –∑–∞–ø—É—â–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç—Å—è GPU)

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ª—É—á—à–µ–Ω —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ (`Dockerfile`):
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ `paddlex_genai_server`
- –û—à–∏–±–∫–∞ vLLM –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ FastAPI
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

### 2. –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PaddleOCR (`server.py`):
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∏–∑ `startup_event` (–±–ª–æ–∫–∏—Ä—É—é—â–∞—è)
- –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–∞–∂–µ –±–µ–∑ GPU
- PaddleOCR –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –¥–ª—è Cloud.ru

### –ß—Ç–æ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:
- ‚úÖ FastAPI —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8081
- ‚úÖ Health endpoint
- ‚úÖ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ API endpoints (–Ω–æ OCR –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ GPU)

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç GPU:
- ‚ö†Ô∏è PaddleOCR-VL –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç CUDA)
- ‚ö†Ô∏è vLLM —Å–µ—Ä–≤–µ—Ä (—Ç—Ä–µ–±—É–µ—Ç GPU)
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ OCR

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Cloud.ru ML Inference:

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å GPU** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö ML Inference
2. **–£–≤–µ–ª–∏—á–∏—Ç—å initialDelaySeconds** –¥–æ 180-240 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å startup probe** —Å –±–æ–ª—å—à–∏–º failureThreshold (30-40)
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç: ‚úÖ 8081
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8081/health
# –û—Ç–≤–µ—Ç: {"status":"healthy",...}
```

### –ü–æ—Ä—Ç—ã –≤ Dockerfile: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
- EXPOSE 8080 8081
- uvicorn —Å–ª—É—à–∞–µ—Ç –Ω–∞ 0.0.0.0:8081

### Health Check –ø—É—Ç—å: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
- Path: `/health`
- Port: `8081`

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Cloud.ru

```
Docker Image: docling-granite-258m.cr.cloud.ru/paddleocr-vl-service:latest
Port: 8081
Health Check: /health

Liveness Probe:
  - Path: /health
  - Port: 8081
  - Initial Delay: 120 —Å–µ–∫—É–Ω–¥
  - Period: 30 —Å–µ–∫—É–Ω–¥

Readiness Probe:
  - Path: /health
  - Port: 8081
  - Initial Delay: 180 —Å–µ–∫—É–Ω–¥ (–¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π)
  - Period: 15 —Å–µ–∫—É–Ω–¥

Startup Probe:
  - Path: /health
  - Port: 8081
  - Initial Delay: 0 —Å–µ–∫—É–Ω–¥
  - Period: 10 —Å–µ–∫—É–Ω–¥
  - Failure Threshold: 40 (–¥–æ 6-7 –º–∏–Ω—É—Ç –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é)

Resources:
  - CPU: 4-8 cores
  - Memory: 16-32 GB
  - GPU: 1x NVIDIA (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
```

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–û–±—Ä–∞–∑ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- ‚úÖ –ü–æ—Ä—Ç 8081 —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è GPU –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ OCR

