# –ü—Ä–æ–Ω–∞–ª–∏–∑–º—Ä—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
_Exported on 28/11/2025 at 21:52:19 GMT+7 from Cursor (2.1.39)_

---

**User**

@ChatGPT.md –ø—Ä–æ–Ω–∞–ª–∏–∑–º—Ä—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ —Ñ–∞–π–ª–µ –∏ –¥–∞–ª–µ–µ –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ –º–æ–¥–µ–ª–µ–π ml Inference!
@ChatGPT.md 

---

**Cursor**

–ò–∑—É—á–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≥–æ—Ç–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference.


–ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≥–æ—Ç–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference.


–°–æ–∑–¥–∞—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference. –ü–ª–∞–Ω:
1. –°–∫—Ä–∏–ø—Ç `test_inference.py` —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `.env.example` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è Cloud.RU
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü—Ä–∏—Å—Ç—É–ø–∞—é –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:


–°–æ–∑–¥–∞—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference:


```python
#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Cloud.RU ML Inference.

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
1. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π)
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai —Å IAM –∫–ª—é—á–∞–º–∏
3. –ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
4. –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏
"""

import os
import sys
import json
import time
from typing import Dict, Any, Optional
from pathlib import Path

import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ SDK (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
try:
    from evolution_openai import EvolutionOpenAI
    EVOLUTION_SDK_AVAILABLE = True
except ImportError:
    EVOLUTION_SDK_AVAILABLE = False
    print("‚ö†Ô∏è  evolution_openai SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")


class InferenceTester:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference."""
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        self.endpoint_url = os.getenv("CLOUD_RU_INFERENCE_URL", "").rstrip("/")
        self.key_id = os.getenv("CLOUD_RU_IAM_KEY_ID", "")
        self.secret = os.getenv("CLOUD_RU_IAM_SECRET", "")
        self.inference_name = os.getenv("CLOUD_RU_INFERENCE_NAME", "")
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–∏ —Å retry
        self.session = requests.Session()
        retry_strategy = Retry(
            total=3,
            backoff_factor=1,
            status_forcelist=[429, 500, 502, 503, 504],
        )
        adapter = HTTPAdapter(max_retries=retry_strategy)
        self.session.mount("http://", adapter)
        self.session.mount("https://", adapter)
        
        # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
        self.results = {
            "timestamp": time.strftime("%Y-%m-%d %H:%M:%S"),
            "tests": {}
        }
    
    def check_config(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤."""
        print("\n" + "="*60)
        print("üîç –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò")
        print("="*60)
        
        missing = []
        
        if not self.endpoint_url:
            missing.append("CLOUD_RU_INFERENCE_URL")
            print("‚ùå CLOUD_RU_INFERENCE_URL –Ω–µ –∑–∞–¥–∞–Ω")
        else:
            print(f"‚úÖ CLOUD_RU_INFERENCE_URL: {self.endpoint_url}")
        
        if not self.key_id:
            missing.append("CLOUD_RU_IAM_KEY_ID")
            print("‚ö†Ô∏è  CLOUD_RU_IAM_KEY_ID –Ω–µ –∑–∞–¥–∞–Ω (–±—É–¥–µ—Ç —Ç–µ—Å—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        else:
            masked_key = f"{self.key_id[:4]}...{self.key_id[-4:]}" if len(self.key_id) > 8 else "***"
            print(f"‚úÖ CLOUD_RU_IAM_KEY_ID: {masked_key}")
        
        if not self.secret:
            missing.append("CLOUD_RU_IAM_SECRET")
            if self.key_id:
                print("‚ùå CLOUD_RU_IAM_SECRET –Ω–µ –∑–∞–¥–∞–Ω (–Ω—É–∂–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        else:
            print(f"‚úÖ CLOUD_RU_IAM_SECRET: {'*' * 20}")
        
        if not self.inference_name:
            print("‚ö†Ô∏è  CLOUD_RU_INFERENCE_NAME –Ω–µ –∑–∞–¥–∞–Ω (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ URL)")
        else:
            print(f"‚úÖ CLOUD_RU_INFERENCE_NAME: {self.inference_name}")
        
        if missing and self.key_id:
            print(f"\n‚ö†Ô∏è  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {', '.join(missing)}")
            print("   –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã")
        
        return len(missing) == 0 or not self.key_id
    
    def test_endpoint_availability(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        print("="*60)
        
        result = {
            "test": "endpoint_availability",
            "success": False,
            "status_code": None,
            "response_time": None,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        try:
            # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π GET –∑–∞–ø—Ä–æ—Å –∫ –∫–æ—Ä–Ω—é –∏–ª–∏ /health
            test_urls = [
                f"{self.endpoint_url}/health",
                f"{self.endpoint_url}/",
                self.endpoint_url
            ]
            
            for url in test_urls:
                try:
                    start_time = time.time()
                    response = self.session.get(url, timeout=10)
                    response_time = time.time() - start_time
                    
                    result["status_code"] = response.status_code
                    result["response_time"] = round(response_time, 3)
                    result["details"]["url"] = url
                    result["details"]["headers"] = dict(response.headers)
                    
                    if response.status_code == 200:
                        result["success"] = True
                        print(f"‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: {url}")
                        print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                        print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                        try:
                            result["details"]["response"] = response.json()
                            print(f"   –û—Ç–≤–µ—Ç: {json.dumps(response.json(), indent=2, ensure_ascii=False)[:200]}...")
                        except:
                            result["details"]["response"] = response.text[:500]
                            print(f"   –û—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç): {response.text[:200]}...")
                        break
                    elif response.status_code == 401:
                        result["success"] = False
                        result["error"] = "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)"
                        print(f"‚ö†Ô∏è  Endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é: {url}")
                        print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                        break
                    elif response.status_code == 404:
                        continue  # –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π URL
                    else:
                        result["error"] = f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å: {response.status_code}"
                        print(f"‚ö†Ô∏è  –°—Ç–∞—Ç—É—Å {response.status_code}: {url}")
                        break
                        
                except requests.exceptions.RequestException as e:
                    if url == test_urls[-1]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–π URL
                        raise
                    continue
                    
        except Exception as e:
            result["error"] = str(e)
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        return result
    
    def test_sdk_connection(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai")
        print("="*60)
        
        result = {
            "test": "sdk_connection",
            "success": False,
            "error": None,
            "details": {}
        }
        
        if not EVOLUTION_SDK_AVAILABLE:
            result["error"] = "SDK evolution_openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")
            return result
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not self.key_id or not self.secret:
            result["error"] = "IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç IAM –∫–ª—é—á–µ–π –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")
            return result
        
        try:
            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
            client = EvolutionOpenAI(
                base_url=self.endpoint_url,
                api_key=self.key_id,
                api_secret=self.secret
            )
            
            # –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
            try:
                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                models = client.models.list()
                result["success"] = True
                result["details"]["models"] = [m.id for m in models.data] if hasattr(models, 'data') else []
                print("‚úÖ SDK –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ")
                print(f"   –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: {len(result['details']['models'])}")
                if result["details"]["models"]:
                    print(f"   –ú–æ–¥–µ–ª–∏: {', '.join(result['details']['models'][:5])}")
            except Exception as e:
                # –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π chat completion
                print(f"‚ö†Ô∏è  –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ü—Ä–æ–±—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å...")
                
                # –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                test_response = client.chat.completions.create(
                    model=self.inference_name or "default",
                    messages=[{"role": "user", "content": "–ü—Ä–∏–≤–µ—Ç"}],
                    max_tokens=10
                )
                
                result["success"] = True
                result["details"]["test_response"] = {
                    "model": test_response.model if hasattr(test_response, 'model') else None,
                    "content": test_response.choices[0].message.content if hasattr(test_response, 'choices') else None
                }
                print("‚úÖ SDK —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
                print(f"   –û—Ç–≤–µ—Ç: {result['details']['test_response']['content']}")
                
        except Exception as e:
            result["error"] = str(e)
            result["details"]["exception_type"] = type(e).__name__
            print(f"‚ùå –û—à–∏–±–∫–∞ SDK: {e}")
            import traceback
            result["details"]["traceback"] = traceback.format_exc()
        
        return result
    
    def test_direct_http_request(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)")
        print("="*60)
        
        result = {
            "test": "direct_http",
            "success": False,
            "status_code": None,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not self.key_id or not self.secret:
            result["error"] = "IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç IAM –∫–ª—é—á–µ–π")
            return result
        
        try:
            # –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ /v1/models –∏–ª–∏ /health
            test_url = f"{self.endpoint_url}/v1/models"
            
            # Cloud.RU –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ AK/SK
            # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–æ–±—É–µ–º —Å –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
            headers = {
                "Content-Type": "application/json",
                "Accept": "application/json"
            }
            
            # –ü–æ–ø—ã—Ç–∫–∞ —Å –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ Cloud.RU —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ SDK –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
            start_time = time.time()
            response = self.session.get(test_url, headers=headers, timeout=10)
            response_time = time.time() - start_time
            
            result["status_code"] = response.status_code
            result["response_time"] = round(response_time, 3)
            result["details"]["url"] = test_url
            
            if response.status_code == 200:
                result["success"] = True
                try:
                    result["details"]["response"] = response.json()
                    print("‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
                    print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                    print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                except:
                    result["details"]["response"] = response.text[:500]
                    print("‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç)")
            elif response.status_code == 401:
                result["error"] = "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)"
                print("‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è")
                print("   –î–ª—è –ø—Ä—è–º—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–∞ –ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ SDK")
            else:
                result["error"] = f"–°—Ç–∞—Ç—É—Å {response.status_code}"
                print(f"‚ö†Ô∏è  –°—Ç–∞—Ç—É—Å: {response.status_code}")
                print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}")
                
        except Exception as e:
            result["error"] = str(e)
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        return result
    
    def test_model_inference(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ (chat completion)."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏")
        print("="*60)
        
        result = {
            "test": "model_inference",
            "success": False,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not EVOLUTION_SDK_AVAILABLE or not self.key_id or not self.secret:
            result["error"] = "SDK –∏–ª–∏ –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: —Ç—Ä–µ–±—É–µ—Ç—Å—è SDK –∏ IAM –∫–ª—é—á–∏")
            return result
        
        try:
            client = EvolutionOpenAI(
                base_url=self.endpoint_url,
                api_key=self.key_id,
                api_secret=self.secret
            )
            
            model_name = self.inference_name or "default"
            test_message = "–°–∫–∞–∂–∏ '–ü—Ä–∏–≤–µ—Ç' –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º"
            
            print(f"   –ú–æ–¥–µ–ª—å: {model_name}")
            print(f"   –ó–∞–ø—Ä–æ—Å: {test_message}")
            
            start_time = time.time()
            response = client.chat.completions.create(
                model=model_name,
                messages=[{"role": "user", "content": test_message}],
                max_tokens=50,
                temperature=0.7
            )
            response_time = time.time() - start_time
            
            result["success"] = True
            result["response_time"] = round(response_time, 3)
            result["details"]["model"] = response.model if hasattr(response, 'model') else model_name
            result["details"]["request"] = test_message
            
            if hasattr(response, 'choices') and response.choices:
                content = response.choices[0].message.content
                result["details"]["response"] = content
                print("‚úÖ –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–µ–Ω")
                print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                print(f"   –û—Ç–≤–µ—Ç: {content}")
            else:
                result["error"] = "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏"
                print("‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç")
                
        except Exception as e:
            result["error"] = str(e)
            result["details"]["exception_type"] = type(e).__name__
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            result["details"]["traceback"] = traceback.format_exc()
        
        return result
    
    def run_all_tests(self) -> Dict[str, Any]:
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã."""
        print("\n" + "="*60)
        print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö CLOUD.RU ML INFERENCE")
        print("="*60)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        config_ok = self.check_config()
        
        if not config_ok and not self.endpoint_url:
            print("\n‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
            return self.results
        
        # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        self.results["tests"]["endpoint_availability"] = self.test_endpoint_availability()
        self.results["tests"]["sdk_connection"] = self.test_sdk_connection()
        self.results["tests"]["direct_http"] = self.test_direct_http_request()
        self.results["tests"]["model_inference"] = self.test_model_inference()
        
        # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        print("\n" + "="*60)
        print("üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê")
        print("="*60)
        
        total = len(self.results["tests"])
        passed = sum(1 for t in self.results["tests"].values() if t.get("success", False))
        failed = total - passed
        
        print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {total}")
        print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {passed}")
        print(f"‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {failed}")
        
        for test_name, test_result in self.results["tests"].items():
            status = "‚úÖ" if test_result.get("success") else "‚ùå"
            print(f"  {status} {test_name}: {test_result.get('error', 'OK')}")
        
        self.results["summary"] = {
            "total": total,
            "passed": passed,
            "failed": failed
        }
        
        return self.results
    
    def save_results(self, output_file: Optional[str] = None):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –≤ JSON —Ñ–∞–π–ª."""
        if not output_file:
            timestamp = time.strftime("%Y%m%d_%H%M%S")
            output_file = f"inference_test_results_{timestamp}.json"
        
        output_path = Path(output_file)
        with open(output_path, "w", encoding="utf-8") as f:
            json.dump(self.results, f, indent=2, ensure_ascii=False)
        
        print(f"\nüíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {output_path}")


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env (–µ—Å–ª–∏ –µ—Å—Ç—å)
    try:
        from dotenv import load_dotenv
        load_dotenv()
    except ImportError:
        pass  # python-dotenv –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
    
    tester = InferenceTester()
    results = tester.run_all_tests()
    tester.save_results()
    
    # –ö–æ–¥ –≤—ã—Ö–æ–¥–∞
    if results.get("summary", {}).get("failed", 0) > 0:
        sys.exit(1)
    else:
        sys.exit(0)


if __name__ == "__main__":
    main()

```

–û–±–Ω–æ–≤–ª—è—é `.env.example` –∏ —Å–æ–∑–¥–∞—é —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:


```shellscript
# Webhook —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
WEBHOOK_SECRET=change-me-secret

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ scheduler (cron format)
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
SCHEDULE_CRON=*/15 * * * *

# –ü–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL
POSTGRES_PASSWORD=change-me-password

# –õ–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ –∞—Ä—Ö–∏–≤–æ–≤
MAX_UNPACK_SIZE_MB=500
MAX_FILES_IN_ARCHIVE=1000

# ============================================
# MongoDB –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
# ============================================
# –ê–¥—Ä–µ—Å–∞ MongoDB —Ö–æ—Å—Ç–æ–≤ (–ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
MONGO_SERVER=mongodb:27017

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MongoDB —Å –ø—Ä–∞–≤–∞–º–∏ —á—Ç–µ–Ω–∏—è
MONGO_USER=readonly_user

# –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MongoDB (–°–ï–ö–†–ï–¢!)
MONGO_PASSWORD=password

# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–±–µ–∑ SSL)
MONGO_SSL_CERT=

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞–∫—É–ø–æ–∫
MONGO_PROTOCOLS_DB=protocols223

# –ö–æ–ª–ª–µ–∫—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞–∫—É–ø–æ–∫
MONGO_PROTOCOLS_COLLECTION=purchaseProtocol

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MongoDB —Å –ø—Ä–∞–≤–∞–º–∏ –∑–∞–ø–∏—Å–∏ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
MONGO_METADATA_USER=docling_user

# –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MongoDB –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–°–ï–ö–†–ï–¢!)
MONGO_METADATA_PASSWORD=password

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
MONGO_METADATA_DB=docling_metadata

# –ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è manifest –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
MONGO_METADATA_COLLECTION=manifests

# –õ–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
PROTOCOLS_COUNT_LIMIT=100

# ============================================
# Cloud.RU ML Inference –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
# ============================================
# –ü—É–±–ª–∏—á–Ω—ã–π URL endpoint –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
# –ü—Ä–∏–º–µ—Ä: https://5bf2f0a2-xxxx-xxxx-xxxx-xxxxxxxxxxxx.inference.cloud.ru
CLOUD_RU_INFERENCE_URL=

# IAM Access Key ID (–∏–∑ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Cloud.RU)
# –ü–æ–ª—É—á–∏—Ç—å: Cloud.RU ‚Üí IAM ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –ö–ª—é—á–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á (HMAC/AccessKey)
CLOUD_RU_IAM_KEY_ID=

# IAM Secret Key (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è!)
CLOUD_RU_IAM_SECRET=

# –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–∏)
# –ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ Cloud.RU ‚Üí ML Inference ‚Üí Model RUN
CLOUD_RU_INFERENCE_NAME=




```

```pip-requirements
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Cloud.RU ML Inference
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: pip install -r requirements_test.txt

# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
requests>=2.31.0
urllib3>=2.0.0

# SDK –¥–ª—è Cloud.RU ML Inference (Evolution OpenAI API)
evolution-openai>=1.0.0

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ .env —Ñ–∞–π–ª–æ–≤
python-dotenv>=1.0.0

```

–°–æ–∑–¥–∞—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç–∞:


```markdown
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Cloud.RU ML Inference

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–æ–¥–µ–ª—è–º ML Inference –≤ Cloud.RU.

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–í–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Cloud.RU:

1. **CLOUD_RU_INFERENCE_URL** - –ø—É–±–ª–∏—á–Ω—ã–π URL endpoint –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
   - –ù–∞–π—Ç–∏: Cloud.RU ‚Üí AI Factory ‚Üí ML Inference ‚Üí Model RUN
   - –ü—Ä–∏–º–µ—Ä: `https://5bf2f0a2-xxxx-xxxx-xxxx-xxxxxxxxxxxx.inference.cloud.ru`

2. **CLOUD_RU_IAM_KEY_ID** - Access Key ID –∏–∑ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
   - –ü–æ–ª—É—á–∏—Ç—å: Cloud.RU ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º (IAM) ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –ö–ª—é—á–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á (HMAC/AccessKey)
   - ‚ö†Ô∏è –≠—Ç–æ –ù–ï ID –º–æ–¥–µ–ª–∏ –∏ –ù–ï URL endpoint!

3. **CLOUD_RU_IAM_SECRET** - Secret Key (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è!)
   - –í—ã–¥–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å KEY_ID –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª—é—á–∞
   - ‚ö†Ô∏è –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ secret –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∂—É—Ç!

4. **CLOUD_RU_INFERENCE_NAME** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–∑–æ–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏
   - –ú–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ Cloud.RU ‚Üí ML Inference ‚Üí Model RUN

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
pip install -r requirements_test.txt

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä—É—á–Ω—É—é
pip install requests urllib3 evolution-openai python-dotenv
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ `.env.example`):

```bash
cp .env.example .env
```

2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:

```env
CLOUD_RU_INFERENCE_URL=https://your-endpoint.inference.cloud.ru
CLOUD_RU_IAM_KEY_ID=AKIA...
CLOUD_RU_IAM_SECRET=your-secret-key
CLOUD_RU_INFERENCE_NAME=your-inference-name
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
python test_inference.py
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export CLOUD_RU_INFERENCE_URL="https://your-endpoint.inference.cloud.ru"
export CLOUD_RU_IAM_KEY_ID="AKIA..."
export CLOUD_RU_IAM_SECRET="your-secret-key"
export CLOUD_RU_INFERENCE_NAME="your-inference-name"

python test_inference.py
```

### –°–ø–æ—Å–æ–± 3: –¢–µ—Å—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ endpoint –ø—É–±–ª–∏—á–Ω—ã–π)

–ï—Å–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –±—ã–ª–∞ –≤–∫–ª—é—á–µ–Ω–∞, –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint:

```bash
export CLOUD_RU_INFERENCE_URL="https://your-endpoint.inference.cloud.ru"
python test_inference.py
```

## üß™ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç 4 —Ç–µ—Å—Ç–∞:

1. **–¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint** (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ endpoint
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)
   - –ò–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

2. **–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ SDK**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `evolution_openai`
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ IAM –∫–ª—é—á–∏
   - –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å

3. **–¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–∞**
   - –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ SDK

4. **–¢–µ—Å—Ç –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–∏**
   - –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ SDK
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç
   - –ò–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç:

1. –í—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Å–æ–ª—å
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –≤ JSON —Ñ–∞–π–ª: `inference_test_results_YYYYMMDD_HHMMSS.json`

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö CLOUD.RU ML INFERENCE
============================================================
üîç –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
============================================================
‚úÖ CLOUD_RU_INFERENCE_URL: https://...
‚úÖ CLOUD_RU_IAM_KEY_ID: AKIA...1234
‚úÖ CLOUD_RU_IAM_SECRET: ********************
‚úÖ CLOUD_RU_INFERENCE_NAME: my-inference

üß™ –¢–ï–°–¢ 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
============================================================
‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: https://.../health
   –°—Ç–∞—Ç—É—Å: 200
   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 0.234s

üß™ –¢–ï–°–¢ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai
============================================================
‚úÖ SDK –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
   –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: 1
   –ú–æ–¥–µ–ª–∏: my-model

üß™ –¢–ï–°–¢ 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)
============================================================
‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   –î–ª—è –ø—Ä—è–º—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–∞ –ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ SDK

üß™ –¢–ï–°–¢ 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏
============================================================
‚úÖ –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–µ–Ω
   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 1.234s
   –û—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç

üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
============================================================
–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 4
‚úÖ –£—Å–ø–µ—à–Ω–æ: 3
‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: 1

üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: inference_test_results_20250117_120000.json
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "SDK evolution_openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

```bash
pip install evolution-openai
```

### –û—à–∏–±–∫–∞: "401 Unauthorized"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `CLOUD_RU_IAM_KEY_ID` –∏ `CLOUD_RU_IAM_SECRET`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–∑–æ–≤ Inference

### –û—à–∏–±–∫–∞: "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `CLOUD_RU_INFERENCE_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç URL (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://`)

### –û—à–∏–±–∫–∞: "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)" –ø—Ä–∏ —Ç–µ—Å—Ç–µ –±–µ–∑ –∫–ª—é—á–µ–π

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞. –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω—ã IAM –∫–ª—é—á–∏.

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (timeout, connection refused)

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∑–∞–ø—É—â–µ–Ω (—Å—Ç–∞—Ç—É—Å "–ó–∞–ø—É—â–µ–Ω" –≤ Cloud.RU)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint –∏–∑ –≤–∞—à–µ–π —Å–µ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å URL (–±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª—ç—à–µ–π –≤ –∫–æ–Ω—Ü–µ)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –≤ git!
2. **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø**: –ï—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞, endpoint –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ
3. **–†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏—Ö —Ä–æ—Ç–∏—Ä–æ–≤–∞—Ç—å
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ JSON –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Cloud.RU ML Inference](https://cloud.ru/docs/ml-inference)
- [Evolution OpenAI SDK](https://github.com/cloud-ru/evolution-openai)
- [Cloud.RU IAM –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://cloud.ru/docs/iam)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∑–∞–ø—É—â–µ–Ω –≤ Cloud.RU
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π JSON –æ—Ç—á–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏

```

–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –≥–æ—Ç–æ–≤–ª—é –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:


–°–æ–∑–¥–∞—é –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –±—ã—Å—Ç—Ä–æ–º—É —Å—Ç–∞—Ä—Ç—É:


```markdown
# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Cloud.RU ML Inference

## üöÄ –ó–∞ 3 —à–∞–≥–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements_test.txt
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cat > .env << EOF
CLOUD_RU_INFERENCE_URL=https://your-endpoint.inference.cloud.ru
CLOUD_RU_IAM_KEY_ID=AKIA...
CLOUD_RU_IAM_SECRET=your-secret-key
CLOUD_RU_INFERENCE_NAME=your-inference-name
EOF

# –í–∞—Ä–∏–∞–Ω—Ç 2: –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
export CLOUD_RU_INFERENCE_URL="https://your-endpoint.inference.cloud.ru"
export CLOUD_RU_IAM_KEY_ID="AKIA..."
export CLOUD_RU_IAM_SECRET="your-secret-key"
export CLOUD_RU_INFERENCE_NAME="your-inference-name"
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python test_inference.py
```

## üìç –ì–¥–µ –≤–∑—è—Ç—å –¥–∞–Ω–Ω—ã–µ?

### 1. CLOUD_RU_INFERENCE_URL
- Cloud.RU ‚Üí AI Factory ‚Üí ML Inference ‚Üí Model RUN
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞

### 2. CLOUD_RU_IAM_KEY_ID –∏ CLOUD_RU_IAM_SECRET
- Cloud.RU ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º (IAM) ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
- –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç ‚Üí –ö–ª—é—á–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á (HMAC/AccessKey)
- ‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ secret —Å—Ä–∞–∑—É - –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –µ–≥–æ –Ω–µ –ø–æ–∫–∞–∂—É—Ç!

### 3. CLOUD_RU_INFERENCE_NAME (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Cloud.RU ‚Üí ML Inference ‚Üí Model RUN
- –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞

## ‚úÖ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å—Å—è

```
‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ SDK –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
‚úÖ –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–µ–Ω
```

## ‚ùå –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å **–∑–∞–ø—É—â–µ–Ω** (—Å—Ç–∞—Ç—É—Å "–ó–∞–ø—É—â–µ–Ω" –≤ Cloud.RU)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π (–Ω–µ –ø—É—Ç–∞–π—Ç–µ —Å ID –º–æ–¥–µ–ª–∏!)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ Inference
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –≤ JSON —Ñ–∞–π–ª–µ

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: —Å–º. `INFERENCE_TEST_README.md`

```

–ü—Ä–æ–≤–µ—Ä—è—é —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å–∫—Ä–∏–ø—Ç–∞:


## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `test_inference.py`
–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç 4 —Ç–µ—Å—Ç–∞:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ endpoint –∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç `evolution_openai` —Å IAM –∫–ª—é—á–∞–º–∏
- –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- Retry –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –≤ JSON
- –†–∞–±–æ—Ç–∞–µ—Ç —Å/–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞)

### 2. –û–±–Ω–æ–≤–ª–µ–Ω `.env.example`
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Cloud.RU ML Inference:
- `CLOUD_RU_INFERENCE_URL` ‚Äî URL endpoint
- `CLOUD_RU_IAM_KEY_ID` ‚Äî Access Key ID
- `CLOUD_RU_IAM_SECRET` ‚Äî Secret Key
- `CLOUD_RU_INFERENCE_NAME` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 3. –°–æ–∑–¥–∞–Ω `requirements_test.txt`
–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `requests` ‚Äî HTTP –∑–∞–ø—Ä–æ—Å—ã
- `evolution-openai` ‚Äî SDK –¥–ª—è Cloud.RU
- `python-dotenv` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–æ–≤

### 4. –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `INFERENCE_TEST_README.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ troubleshooting
- `QUICK_START_INFERENCE.md` ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 3 —à–∞–≥–∞

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements_test.txt

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export CLOUD_RU_INFERENCE_URL="https://your-endpoint.inference.cloud.ru"
export CLOUD_RU_IAM_KEY_ID="AKIA..."
export CLOUD_RU_IAM_SECRET="your-secret-key"
export CLOUD_RU_INFERENCE_NAME="your-inference-name"

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python test_inference.py
```

### –ò–ª–∏ —á–µ—Ä–µ–∑ .env —Ñ–∞–π–ª:

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env
nano .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
python test_inference.py
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. CLOUD_RU_INFERENCE_URL ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π URL –∏–∑ Cloud.RU ‚Üí ML Inference ‚Üí Model RUN
2. CLOUD_RU_IAM_KEY_ID ‚Äî –∏–∑ IAM ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –ö–ª—é—á–∏
3. CLOUD_RU_IAM_SECRET ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞
4. CLOUD_RU_INFERENCE_NAME ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç:
- –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ (‚úÖ/‚ùå)
- –î–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ endpoint –∏ –º–æ–¥–µ–ª–∏
- –ò—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

–ò —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –≤ JSON —Ñ–∞–π–ª: `inference_test_results_YYYYMMDD_HHMMSS.json`

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. –ù–µ –ø—É—Ç–∞–π—Ç–µ IAM –∫–ª—é—á–∏ —Å ID –º–æ–¥–µ–ª–∏ –∏–ª–∏ URL endpoint ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏
2. Secret Key –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ —Å—Ä–∞–∑—É
3. –ï—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞, –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –∫–ª—é—á–µ–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∑–∞–ø—É—â–µ–Ω (—Å—Ç–∞—Ç—É—Å "–ó–∞–ø—É—â–µ–Ω") –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

```shellscript
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements_test.txt

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export CLOUD_RU_INFERENCE_URL="https://your-endpoint.inference.cloud.ru"
export CLOUD_RU_IAM_KEY_ID="AKIA..."
export CLOUD_RU_IAM_SECRET="your-secret-key"
export CLOUD_RU_INFERENCE_NAME="your-inference-name"

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python test_inference.py
```

```shellscript
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env
nano .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
python test_inference.py
```

---

**User**

@ChatGPT.md  –ø–æ–¥—Å—Ç–∞–≤—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –ø–æ–ª–∫–ª—é—á–µ–Ω–∏–µ –∫ ml inference - cloud.ru



–∫–∞–∫ –º–Ω–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–π –Ω–∞ cloud ru inferense –º–æ–¥–µ–ª—å: model-run-msguj-among –ü—É–±–ª–∏—á–Ω—ã–π URL: https://5bf2f0a2-cdc8-4831-be41-5b2f9d6a7b55.modelrun.inference.cloud.ru –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É Evolution OpenAI –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pip install evolution_openai –û—Å–Ω–æ–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ from evolution_openai import EvolutionOpenAI client = EvolutionOpenAI( key_id="<<YOUR_CLOUDRU_IAM_KEY>>", secret="<<YOUR_CLOUDRU_IAM_SECRET>>", base_url="https://5bf2f0a2-cdc8-4831-be41-5b2f9d6a7b55.modelrun.inference.cloud.ru/v1" ) response = client.chat.completions.create( model="model-run-msguj-among", messages=[ {"role": "system", "content": "–í—ã –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç."}, {"role": "user", "content": "–ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?"}, ], max_tokens=5000, temperature=0.5, presence_penalty=0, top_p=0.95, ) print(response.choices[0].message.content)

---

**Cursor**

–ü—Ä–æ–≤–µ—Ä—è—é –Ω–∞–ª–∏—á–∏–µ IAM –∫–ª—é—á–µ–π –≤ `.env` –∏ –æ–±–Ω–æ–≤–ª—è—é —Å–∫—Ä–∏–ø—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.


–û–±–Ω–æ–≤–ª—è—é `.env` —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∑–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –∑–∞—Ç–µ–º ‚Äî —Å –∫–ª—é—á–∞–º–∏ (–µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å).


```properties
# Webhook —Å–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
WEBHOOK_SECRET=change-me-secret

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ scheduler (cron format)
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
SCHEDULE_CRON=*/15 * * * *

# –ü–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL
POSTGRES_PASSWORD=change-me-password

# –õ–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ –∞—Ä—Ö–∏–≤–æ–≤
MAX_UNPACK_SIZE_MB=500
MAX_FILES_IN_ARCHIVE=1000

# ============================================
# MongoDB –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
# ============================================
# –ê–¥—Ä–µ—Å–∞ MongoDB —Ö–æ—Å—Ç–æ–≤ (—É–¥–∞–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä - –¢–†–ï–ë–£–ï–¢–°–Ø –£–ö–ê–ó–ê–¢–¨!)
# –§–æ—Ä–º–∞—Ç: host:port –∏–ª–∏ host1:port1,host2:port2,host3:port3
# –î–ª—è MCP —Å–µ—Ä–≤–µ—Ä–∞ (mcp_http_server.py) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ mcp_http_server.py
mongoServer=mongosber3.multitender.ru:8635,mongosber4.multitender.ru:8635
readAllUser=readProtocols223
readAllPassword=cei8saht8UCh3oka4geegheuwahzoph2
sslCertPath=/root/winners_preprocessor/certs/sber2.crt
protocolsCountLimit=500
# –î–ª—è router –∏ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ)
MONGO_SERVER=mongosber3.multitender.ru:8635,mongosber4.multitender.ru:8635

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MongoDB —Å –ø—Ä–∞–≤–∞–º–∏ —á—Ç–µ–Ω–∏—è (–¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
MONGO_USER=readProtocols223

# –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MongoDB (–°–ï–ö–†–ï–¢!)
MONGO_PASSWORD=cei8saht8UCh3oka4geegheuwahzoph2

# –ü—É—Ç—å –∫ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
MONGO_SSL_CERT=/root/winners_preprocessor/certs/sber2.crt

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞–∫—É–ø–æ–∫
MONGO_PROTOCOLS_DB=protocols223

# –ö–æ–ª–ª–µ–∫—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞–∫—É–ø–æ–∫
MONGO_PROTOCOLS_COLLECTION=purchaseProtocol

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MongoDB —Å –ø—Ä–∞–≤–∞–º–∏ –∑–∞–ø–∏—Å–∏ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º admin)
MONGO_METADATA_USER=admin

# –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MongoDB –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–°–ï–ö–†–ï–¢!)
MONGO_METADATA_PASSWORD=password

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
MONGO_METADATA_DB=docling_metadata

# –ö–æ–ª–ª–µ–∫—Ü–∏—è –¥–ª—è manifest –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
MONGO_METADATA_COLLECTION=manifests

# –õ–∏–º–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è 500 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
PROTOCOLS_COUNT_LIMIT=500

# ============================================
# Cloud.RU ML Inference –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
# ============================================
# –ü—É–±–ª–∏—á–Ω—ã–π URL endpoint –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
CLOUD_RU_INFERENCE_URL=https://5bf2f0a2-cdc8-4831-be41-5b2f9d6a7b55.modelrun.inference.cloud.ru

# IAM Access Key ID (–∏–∑ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Cloud.RU)
# –ü–æ–ª—É—á–∏—Ç—å: Cloud.RU ‚Üí IAM ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –ö–ª—é—á–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á (HMAC/AccessKey)
CLOUD_RU_IAM_KEY_ID=

# IAM Secret Key (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è!)
CLOUD_RU_IAM_SECRET=

# –ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (–º–æ–¥–µ–ª–∏)
CLOUD_RU_INFERENCE_NAME=model-run-msguj-among




```

–û–±–Ω–æ–≤–ª—è—é —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å URL (–¥–æ–±–∞–≤–ª—è—é `/v1` –¥–ª—è SDK) –∏ –∑–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:


```python
#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Cloud.RU ML Inference.

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
1. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π)
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai —Å IAM –∫–ª—é—á–∞–º–∏
3. –ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
4. –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏
"""

import os
import sys
import json
import time
from typing import Dict, Any, Optional
from pathlib import Path

import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ SDK (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
try:
    from evolution_openai import EvolutionOpenAI
    EVOLUTION_SDK_AVAILABLE = True
except ImportError:
    EVOLUTION_SDK_AVAILABLE = False
    print("‚ö†Ô∏è  evolution_openai SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")


class InferenceTester:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference."""
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        self.endpoint_url = os.getenv("CLOUD_RU_INFERENCE_URL", "").rstrip("/")
        self.key_id = os.getenv("CLOUD_RU_IAM_KEY_ID", "")
        self.secret = os.getenv("CLOUD_RU_IAM_SECRET", "")
        self.inference_name = os.getenv("CLOUD_RU_INFERENCE_NAME", "")
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–∏ —Å retry
        self.session = requests.Session()
        retry_strategy = Retry(
            total=3,
            backoff_factor=1,
            status_forcelist=[429, 500, 502, 503, 504],
        )
        adapter = HTTPAdapter(max_retries=retry_strategy)
        self.session.mount("http://", adapter)
        self.session.mount("https://", adapter)
        
        # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
        self.results = {
            "timestamp": time.strftime("%Y-%m-%d %H:%M:%S"),
            "tests": {}
        }
    
    def check_config(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤."""
        print("\n" + "="*60)
        print("üîç –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò")
        print("="*60)
        
        missing = []
        
        if not self.endpoint_url:
            missing.append("CLOUD_RU_INFERENCE_URL")
            print("‚ùå CLOUD_RU_INFERENCE_URL –Ω–µ –∑–∞–¥–∞–Ω")
        else:
            print(f"‚úÖ CLOUD_RU_INFERENCE_URL: {self.endpoint_url}")
        
        if not self.key_id:
            missing.append("CLOUD_RU_IAM_KEY_ID")
            print("‚ö†Ô∏è  CLOUD_RU_IAM_KEY_ID –Ω–µ –∑–∞–¥–∞–Ω (–±—É–¥–µ—Ç —Ç–µ—Å—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        else:
            masked_key = f"{self.key_id[:4]}...{self.key_id[-4:]}" if len(self.key_id) > 8 else "***"
            print(f"‚úÖ CLOUD_RU_IAM_KEY_ID: {masked_key}")
        
        if not self.secret:
            missing.append("CLOUD_RU_IAM_SECRET")
            if self.key_id:
                print("‚ùå CLOUD_RU_IAM_SECRET –Ω–µ –∑–∞–¥–∞–Ω (–Ω—É–∂–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        else:
            print(f"‚úÖ CLOUD_RU_IAM_SECRET: {'*' * 20}")
        
        if not self.inference_name:
            print("‚ö†Ô∏è  CLOUD_RU_INFERENCE_NAME –Ω–µ –∑–∞–¥–∞–Ω (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ URL)")
        else:
            print(f"‚úÖ CLOUD_RU_INFERENCE_NAME: {self.inference_name}")
        
        if missing and self.key_id:
            print(f"\n‚ö†Ô∏è  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {', '.join(missing)}")
            print("   –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã")
        
        return len(missing) == 0 or not self.key_id
    
    def test_endpoint_availability(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        print("="*60)
        
        result = {
            "test": "endpoint_availability",
            "success": False,
            "status_code": None,
            "response_time": None,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        try:
            # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π GET –∑–∞–ø—Ä–æ—Å –∫ –∫–æ—Ä–Ω—é –∏–ª–∏ /health
            test_urls = [
                f"{self.endpoint_url}/health",
                f"{self.endpoint_url}/",
                self.endpoint_url
            ]
            
            for url in test_urls:
                try:
                    start_time = time.time()
                    response = self.session.get(url, timeout=10)
                    response_time = time.time() - start_time
                    
                    result["status_code"] = response.status_code
                    result["response_time"] = round(response_time, 3)
                    result["details"]["url"] = url
                    result["details"]["headers"] = dict(response.headers)
                    
                    if response.status_code == 200:
                        result["success"] = True
                        print(f"‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: {url}")
                        print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                        print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                        try:
                            result["details"]["response"] = response.json()
                            print(f"   –û—Ç–≤–µ—Ç: {json.dumps(response.json(), indent=2, ensure_ascii=False)[:200]}...")
                        except:
                            result["details"]["response"] = response.text[:500]
                            print(f"   –û—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç): {response.text[:200]}...")
                        break
                    elif response.status_code == 401:
                        result["success"] = False
                        result["error"] = "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)"
                        print(f"‚ö†Ô∏è  Endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é: {url}")
                        print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                        break
                    elif response.status_code == 404:
                        continue  # –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π URL
                    else:
                        result["error"] = f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å: {response.status_code}"
                        print(f"‚ö†Ô∏è  –°—Ç–∞—Ç—É—Å {response.status_code}: {url}")
                        break
                        
                except requests.exceptions.RequestException as e:
                    if url == test_urls[-1]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–π URL
                        raise
                    continue
                    
        except Exception as e:
            result["error"] = str(e)
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        return result
    
    def test_sdk_connection(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai")
        print("="*60)
        
        result = {
            "test": "sdk_connection",
            "success": False,
            "error": None,
            "details": {}
        }
        
        if not EVOLUTION_SDK_AVAILABLE:
            result["error"] = "SDK evolution_openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")
            return result
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not self.key_id or not self.secret:
            result["error"] = "IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç IAM –∫–ª—é—á–µ–π –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")
            return result
        
        try:
            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
            # –î–ª—è SDK –Ω—É–∂–µ–Ω URL —Å /v1 –≤ –∫–æ–Ω—Ü–µ
            base_url = self.endpoint_url
            if not base_url.endswith("/v1"):
                base_url = f"{base_url}/v1"
            
            client = EvolutionOpenAI(
                base_url=base_url,
                api_key=self.key_id,
                api_secret=self.secret
            )
            
            # –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
            try:
                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                models = client.models.list()
                result["success"] = True
                result["details"]["models"] = [m.id for m in models.data] if hasattr(models, 'data') else []
                print("‚úÖ SDK –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ")
                print(f"   –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: {len(result['details']['models'])}")
                if result["details"]["models"]:
                    print(f"   –ú–æ–¥–µ–ª–∏: {', '.join(result['details']['models'][:5])}")
            except Exception as e:
                # –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π chat completion
                print(f"‚ö†Ô∏è  –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ü—Ä–æ–±—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å...")
                
                # –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                test_response = client.chat.completions.create(
                    model=self.inference_name or "default",
                    messages=[{"role": "user", "content": "–ü—Ä–∏–≤–µ—Ç"}],
                    max_tokens=10
                )
                
                result["success"] = True
                result["details"]["test_response"] = {
                    "model": test_response.model if hasattr(test_response, 'model') else None,
                    "content": test_response.choices[0].message.content if hasattr(test_response, 'choices') else None
                }
                print("‚úÖ SDK —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
                print(f"   –û—Ç–≤–µ—Ç: {result['details']['test_response']['content']}")
                
        except Exception as e:
            result["error"] = str(e)
            result["details"]["exception_type"] = type(e).__name__
            print(f"‚ùå –û—à–∏–±–∫–∞ SDK: {e}")
            import traceback
            result["details"]["traceback"] = traceback.format_exc()
        
        return result
    
    def test_direct_http_request(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)")
        print("="*60)
        
        result = {
            "test": "direct_http",
            "success": False,
            "status_code": None,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not self.key_id or not self.secret:
            result["error"] = "IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç IAM –∫–ª—é—á–µ–π")
            return result
        
        try:
            # –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ /v1/models –∏–ª–∏ /health
            test_url = f"{self.endpoint_url}/v1/models"
            
            # Cloud.RU –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ AK/SK
            # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–æ–±—É–µ–º —Å –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
            headers = {
                "Content-Type": "application/json",
                "Accept": "application/json"
            }
            
            # –ü–æ–ø—ã—Ç–∫–∞ —Å –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ Cloud.RU —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ SDK –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
            start_time = time.time()
            response = self.session.get(test_url, headers=headers, timeout=10)
            response_time = time.time() - start_time
            
            result["status_code"] = response.status_code
            result["response_time"] = round(response_time, 3)
            result["details"]["url"] = test_url
            
            if response.status_code == 200:
                result["success"] = True
                try:
                    result["details"]["response"] = response.json()
                    print("‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
                    print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                    print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                except:
                    result["details"]["response"] = response.text[:500]
                    print("‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç)")
            elif response.status_code == 401:
                result["error"] = "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)"
                print("‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è")
                print("   –î–ª—è –ø—Ä—è–º—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–∞ –ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ SDK")
            else:
                result["error"] = f"–°—Ç–∞—Ç—É—Å {response.status_code}"
                print(f"‚ö†Ô∏è  –°—Ç–∞—Ç—É—Å: {response.status_code}")
                print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}")
                
        except Exception as e:
            result["error"] = str(e)
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        return result
    
    def test_model_inference(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ (chat completion)."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏")
        print("="*60)
        
        result = {
            "test": "model_inference",
            "success": False,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not EVOLUTION_SDK_AVAILABLE or not self.key_id or not self.secret:
            result["error"] = "SDK –∏–ª–∏ –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: —Ç—Ä–µ–±—É–µ—Ç—Å—è SDK –∏ IAM –∫–ª—é—á–∏")
            return result
        
        try:
            client = EvolutionOpenAI(
                base_url=self.endpoint_url,
                api_key=self.key_id,
                api_secret=self.secret
            )
            
            model_name = self.inference_name or "default"
            test_message = "–°–∫–∞–∂–∏ '–ü—Ä–∏–≤–µ—Ç' –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º"
            
            print(f"   –ú–æ–¥–µ–ª—å: {model_name}")
            print(f"   –ó–∞–ø—Ä–æ—Å: {test_message}")
            
            start_time = time.time()
            response = client.chat.completions.create(
                model=model_name,
                messages=[{"role": "user", "content": test_message}],
                max_tokens=50,
                temperature=0.7
            )
            response_time = time.time() - start_time
            
            result["success"] = True
            result["response_time"] = round(response_time, 3)
            result["details"]["model"] = response.model if hasattr(response, 'model') else model_name
            result["details"]["request"] = test_message
            
            if hasattr(response, 'choices') and response.choices:
                content = response.choices[0].message.content
                result["details"]["response"] = content
                print("‚úÖ –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–µ–Ω")
                print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                print(f"   –û—Ç–≤–µ—Ç: {content}")
            else:
                result["error"] = "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏"
                print("‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç")
                
        except Exception as e:
            result["error"] = str(e)
            result["details"]["exception_type"] = type(e).__name__
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            result["details"]["traceback"] = traceback.format_exc()
        
        return result
    
    def run_all_tests(self) -> Dict[str, Any]:
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã."""
        print("\n" + "="*60)
        print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö CLOUD.RU ML INFERENCE")
        print("="*60)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        config_ok = self.check_config()
        
        if not config_ok and not self.endpoint_url:
            print("\n‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
            return self.results
        
        # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        self.results["tests"]["endpoint_availability"] = self.test_endpoint_availability()
        self.results["tests"]["sdk_connection"] = self.test_sdk_connection()
        self.results["tests"]["direct_http"] = self.test_direct_http_request()
        self.results["tests"]["model_inference"] = self.test_model_inference()
        
        # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        print("\n" + "="*60)
        print("üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê")
        print("="*60)
        
        total = len(self.results["tests"])
        passed = sum(1 for t in self.results["tests"].values() if t.get("success", False))
        failed = total - passed
        
        print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {total}")
        print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {passed}")
        print(f"‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {failed}")
        
        for test_name, test_result in self.results["tests"].items():
            status = "‚úÖ" if test_result.get("success") else "‚ùå"
            print(f"  {status} {test_name}: {test_result.get('error', 'OK')}")
        
        self.results["summary"] = {
            "total": total,
            "passed": passed,
            "failed": failed
        }
        
        return self.results
    
    def save_results(self, output_file: Optional[str] = None):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –≤ JSON —Ñ–∞–π–ª."""
        if not output_file:
            timestamp = time.strftime("%Y%m%d_%H%M%S")
            output_file = f"inference_test_results_{timestamp}.json"
        
        output_path = Path(output_file)
        with open(output_path, "w", encoding="utf-8") as f:
            json.dump(self.results, f, indent=2, ensure_ascii=False)
        
        print(f"\nüíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {output_path}")


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env (–µ—Å–ª–∏ –µ—Å—Ç—å)
    try:
        from dotenv import load_dotenv
        load_dotenv()
    except ImportError:
        pass  # python-dotenv –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
    
    tester = InferenceTester()
    results = tester.run_all_tests()
    tester.save_results()
    
    # –ö–æ–¥ –≤—ã—Ö–æ–¥–∞
    if results.get("summary", {}).get("failed", 0) > 0:
        sys.exit(1)
    else:
        sys.exit(0)


if __name__ == "__main__":
    main()


```

```python
#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Cloud.RU ML Inference.

–¢–µ—Å—Ç–∏—Ä—É–µ—Ç:
1. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π)
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai —Å IAM –∫–ª—é—á–∞–º–∏
3. –ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
4. –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏
"""

import os
import sys
import json
import time
from typing import Dict, Any, Optional
from pathlib import Path

import requests
from requests.adapters import HTTPAdapter
from urllib3.util.retry import Retry

# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ SDK (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
try:
    from evolution_openai import EvolutionOpenAI
    EVOLUTION_SDK_AVAILABLE = True
except ImportError:
    EVOLUTION_SDK_AVAILABLE = False
    print("‚ö†Ô∏è  evolution_openai SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")


class InferenceTester:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ML Inference."""
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è."""
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        self.endpoint_url = os.getenv("CLOUD_RU_INFERENCE_URL", "").rstrip("/")
        self.key_id = os.getenv("CLOUD_RU_IAM_KEY_ID", "")
        self.secret = os.getenv("CLOUD_RU_IAM_SECRET", "")
        self.inference_name = os.getenv("CLOUD_RU_INFERENCE_NAME", "")
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–∏ —Å retry
        self.session = requests.Session()
        retry_strategy = Retry(
            total=3,
            backoff_factor=1,
            status_forcelist=[429, 500, 502, 503, 504],
        )
        adapter = HTTPAdapter(max_retries=retry_strategy)
        self.session.mount("http://", adapter)
        self.session.mount("https://", adapter)
        
        # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
        self.results = {
            "timestamp": time.strftime("%Y-%m-%d %H:%M:%S"),
            "tests": {}
        }
    
    def check_config(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤."""
        print("\n" + "="*60)
        print("üîç –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò")
        print("="*60)
        
        missing = []
        
        if not self.endpoint_url:
            missing.append("CLOUD_RU_INFERENCE_URL")
            print("‚ùå CLOUD_RU_INFERENCE_URL –Ω–µ –∑–∞–¥–∞–Ω")
        else:
            print(f"‚úÖ CLOUD_RU_INFERENCE_URL: {self.endpoint_url}")
        
        if not self.key_id:
            missing.append("CLOUD_RU_IAM_KEY_ID")
            print("‚ö†Ô∏è  CLOUD_RU_IAM_KEY_ID –Ω–µ –∑–∞–¥–∞–Ω (–±—É–¥–µ—Ç —Ç–µ—Å—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        else:
            masked_key = f"{self.key_id[:4]}...{self.key_id[-4:]}" if len(self.key_id) > 8 else "***"
            print(f"‚úÖ CLOUD_RU_IAM_KEY_ID: {masked_key}")
        
        if not self.secret:
            missing.append("CLOUD_RU_IAM_SECRET")
            if self.key_id:
                print("‚ùå CLOUD_RU_IAM_SECRET –Ω–µ –∑–∞–¥–∞–Ω (–Ω—É–∂–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        else:
            print(f"‚úÖ CLOUD_RU_IAM_SECRET: {'*' * 20}")
        
        if not self.inference_name:
            print("‚ö†Ô∏è  CLOUD_RU_INFERENCE_NAME –Ω–µ –∑–∞–¥–∞–Ω (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∏–∑ URL)")
        else:
            print(f"‚úÖ CLOUD_RU_INFERENCE_NAME: {self.inference_name}")
        
        if missing and self.key_id:
            print(f"\n‚ö†Ô∏è  –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {', '.join(missing)}")
            print("   –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ã")
        
        return len(missing) == 0 or not self.key_id
    
    def test_endpoint_availability(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)")
        print("="*60)
        
        result = {
            "test": "endpoint_availability",
            "success": False,
            "status_code": None,
            "response_time": None,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        try:
            # –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π GET –∑–∞–ø—Ä–æ—Å –∫ –∫–æ—Ä–Ω—é –∏–ª–∏ /health
            test_urls = [
                f"{self.endpoint_url}/health",
                f"{self.endpoint_url}/",
                self.endpoint_url
            ]
            
            for url in test_urls:
                try:
                    start_time = time.time()
                    response = self.session.get(url, timeout=10)
                    response_time = time.time() - start_time
                    
                    result["status_code"] = response.status_code
                    result["response_time"] = round(response_time, 3)
                    result["details"]["url"] = url
                    result["details"]["headers"] = dict(response.headers)
                    
                    if response.status_code == 200:
                        result["success"] = True
                        print(f"‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: {url}")
                        print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                        print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                        try:
                            result["details"]["response"] = response.json()
                            print(f"   –û—Ç–≤–µ—Ç: {json.dumps(response.json(), indent=2, ensure_ascii=False)[:200]}...")
                        except:
                            result["details"]["response"] = response.text[:500]
                            print(f"   –û—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç): {response.text[:200]}...")
                        break
                    elif response.status_code == 401:
                        result["success"] = False
                        result["error"] = "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)"
                        print(f"‚ö†Ô∏è  Endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é: {url}")
                        print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                        break
                    elif response.status_code == 404:
                        continue  # –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π URL
                    else:
                        result["error"] = f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å: {response.status_code}"
                        print(f"‚ö†Ô∏è  –°—Ç–∞—Ç—É—Å {response.status_code}: {url}")
                        break
                        
                except requests.exceptions.RequestException as e:
                    if url == test_urls[-1]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–π URL
                        raise
                    continue
                    
        except Exception as e:
            result["error"] = str(e)
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        return result
    
    def test_sdk_connection(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK evolution_openai")
        print("="*60)
        
        result = {
            "test": "sdk_connection",
            "success": False,
            "error": None,
            "details": {}
        }
        
        if not EVOLUTION_SDK_AVAILABLE:
            result["error"] = "SDK evolution_openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")
            return result
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not self.key_id or not self.secret:
            result["error"] = "IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç IAM –∫–ª—é—á–µ–π –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏")
            return result
        
        try:
            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
            # –î–ª—è SDK –Ω—É–∂–µ–Ω URL —Å /v1 –≤ –∫–æ–Ω—Ü–µ
            base_url = self.endpoint_url
            if not base_url.endswith("/v1"):
                base_url = f"{base_url}/v1"
            
            client = EvolutionOpenAI(
                base_url=base_url,
                api_key=self.key_id,
                api_secret=self.secret
            )
            
            # –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
            try:
                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
                models = client.models.list()
                result["success"] = True
                result["details"]["models"] = [m.id for m in models.data] if hasattr(models, 'data') else []
                print("‚úÖ SDK –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ")
                print(f"   –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: {len(result['details']['models'])}")
                if result["details"]["models"]:
                    print(f"   –ú–æ–¥–µ–ª–∏: {', '.join(result['details']['models'][:5])}")
            except Exception as e:
                # –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ—Å—Ç–æ–π chat completion
                print(f"‚ö†Ô∏è  –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ü—Ä–æ–±—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å...")
                
                # –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                test_response = client.chat.completions.create(
                    model=self.inference_name or "default",
                    messages=[{"role": "user", "content": "–ü—Ä–∏–≤–µ—Ç"}],
                    max_tokens=10
                )
                
                result["success"] = True
                result["details"]["test_response"] = {
                    "model": test_response.model if hasattr(test_response, 'model') else None,
                    "content": test_response.choices[0].message.content if hasattr(test_response, 'choices') else None
                }
                print("‚úÖ SDK —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
                print(f"   –û—Ç–≤–µ—Ç: {result['details']['test_response']['content']}")
                
        except Exception as e:
            result["error"] = str(e)
            result["details"]["exception_type"] = type(e).__name__
            print(f"‚ùå –û—à–∏–±–∫–∞ SDK: {e}")
            import traceback
            result["details"]["traceback"] = traceback.format_exc()
        
        return result
    
    def test_direct_http_request(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 3: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)")
        print("="*60)
        
        result = {
            "test": "direct_http",
            "success": False,
            "status_code": None,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not self.key_id or not self.secret:
            result["error"] = "IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç IAM –∫–ª—é—á–µ–π")
            return result
        
        try:
            # –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ /v1/models –∏–ª–∏ /health
            test_url = f"{self.endpoint_url}/v1/models"
            
            # Cloud.RU –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ AK/SK
            # –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–æ–±—É–µ–º —Å –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
            headers = {
                "Content-Type": "application/json",
                "Accept": "application/json"
            }
            
            # –ü–æ–ø—ã—Ç–∫–∞ —Å –±–∞–∑–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ Cloud.RU —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–ø–∏—Å—å –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ SDK –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
            start_time = time.time()
            response = self.session.get(test_url, headers=headers, timeout=10)
            response_time = time.time() - start_time
            
            result["status_code"] = response.status_code
            result["response_time"] = round(response_time, 3)
            result["details"]["url"] = test_url
            
            if response.status_code == 200:
                result["success"] = True
                try:
                    result["details"]["response"] = response.json()
                    print("‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω")
                    print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
                    print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                except:
                    result["details"]["response"] = response.text[:500]
                    print("‚úÖ HTTP –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç)")
            elif response.status_code == 401:
                result["error"] = "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)"
                print("‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è")
                print("   –î–ª—è –ø—Ä—è–º—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–∞ –ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ SDK")
            else:
                result["error"] = f"–°—Ç–∞—Ç—É—Å {response.status_code}"
                print(f"‚ö†Ô∏è  –°—Ç–∞—Ç—É—Å: {response.status_code}")
                print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}")
                
        except Exception as e:
            result["error"] = str(e)
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        
        return result
    
    def test_model_inference(self) -> Dict[str, Any]:
        """–¢–µ—Å—Ç 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ (chat completion)."""
        print("\n" + "="*60)
        print("üß™ –¢–ï–°–¢ 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏")
        print("="*60)
        
        result = {
            "test": "model_inference",
            "success": False,
            "error": None,
            "details": {}
        }
        
        if not self.endpoint_url:
            result["error"] = "Endpoint URL –Ω–µ –∑–∞–¥–∞–Ω"
            print("‚ùå –ü—Ä–æ–ø—É—â–µ–Ω: –Ω–µ—Ç endpoint URL")
            return result
        
        if not EVOLUTION_SDK_AVAILABLE or not self.key_id or not self.secret:
            result["error"] = "SDK –∏–ª–∏ –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
            print("‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω: —Ç—Ä–µ–±—É–µ—Ç—Å—è SDK –∏ IAM –∫–ª—é—á–∏")
            return result
        
        try:
            # –î–ª—è SDK –Ω—É–∂–µ–Ω URL —Å /v1 –≤ –∫–æ–Ω—Ü–µ
            base_url = self.endpoint_url
            if not base_url.endswith("/v1"):
                base_url = f"{base_url}/v1"
            
            client = EvolutionOpenAI(
                base_url=base_url,
                api_key=self.key_id,
                api_secret=self.secret
            )
            
            model_name = self.inference_name or "default"
            test_message = "–°–∫–∞–∂–∏ '–ü—Ä–∏–≤–µ—Ç' –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º"
            
            print(f"   –ú–æ–¥–µ–ª—å: {model_name}")
            print(f"   –ó–∞–ø—Ä–æ—Å: {test_message}")
            
            start_time = time.time()
            response = client.chat.completions.create(
                model=model_name,
                messages=[{"role": "user", "content": test_message}],
                max_tokens=50,
                temperature=0.7
            )
            response_time = time.time() - start_time
            
            result["success"] = True
            result["response_time"] = round(response_time, 3)
            result["details"]["model"] = response.model if hasattr(response, 'model') else model_name
            result["details"]["request"] = test_message
            
            if hasattr(response, 'choices') and response.choices:
                content = response.choices[0].message.content
                result["details"]["response"] = content
                print("‚úÖ –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–µ–Ω")
                print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                print(f"   –û—Ç–≤–µ—Ç: {content}")
            else:
                result["error"] = "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏"
                print("‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç")
                
        except Exception as e:
            result["error"] = str(e)
            result["details"]["exception_type"] = type(e).__name__
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            import traceback
            result["details"]["traceback"] = traceback.format_exc()
        
        return result
    
    def run_all_tests(self) -> Dict[str, Any]:
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã."""
        print("\n" + "="*60)
        print("üöÄ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö CLOUD.RU ML INFERENCE")
        print("="*60)
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        config_ok = self.check_config()
        
        if not config_ok and not self.endpoint_url:
            print("\n‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
            return self.results
        
        # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        self.results["tests"]["endpoint_availability"] = self.test_endpoint_availability()
        self.results["tests"]["sdk_connection"] = self.test_sdk_connection()
        self.results["tests"]["direct_http"] = self.test_direct_http_request()
        self.results["tests"]["model_inference"] = self.test_model_inference()
        
        # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        print("\n" + "="*60)
        print("üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê")
        print("="*60)
        
        total = len(self.results["tests"])
        passed = sum(1 for t in self.results["tests"].values() if t.get("success", False))
        failed = total - passed
        
        print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {total}")
        print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {passed}")
        print(f"‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {failed}")
        
        for test_name, test_result in self.results["tests"].items():
            status = "‚úÖ" if test_result.get("success") else "‚ùå"
            print(f"  {status} {test_name}: {test_result.get('error', 'OK')}")
        
        self.results["summary"] = {
            "total": total,
            "passed": passed,
            "failed": failed
        }
        
        return self.results
    
    def save_results(self, output_file: Optional[str] = None):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –≤ JSON —Ñ–∞–π–ª."""
        if not output_file:
            timestamp = time.strftime("%Y%m%d_%H%M%S")
            output_file = f"inference_test_results_{timestamp}.json"
        
        output_path = Path(output_file)
        with open(output_path, "w", encoding="utf-8") as f:
            json.dump(self.results, f, indent=2, ensure_ascii=False)
        
        print(f"\nüíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {output_path}")


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env (–µ—Å–ª–∏ –µ—Å—Ç—å)
    try:
        from dotenv import load_dotenv
        load_dotenv()
    except ImportError:
        pass  # python-dotenv –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
    
    tester = InferenceTester()
    results = tester.run_all_tests()
    tester.save_results()
    
    # –ö–æ–¥ –≤—ã—Ö–æ–¥–∞
    if results.get("summary", {}).get("failed", 0) > 0:
        sys.exit(1)
    else:
        sys.exit(0)


if __name__ == "__main__":
    main()


```

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:


–ü—Ä–æ–≤–µ—Ä—è—é –Ω–∞–ª–∏—á–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:


–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å —Ñ–ª–∞–≥–æ–º `--user` –∏ –∑–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç:


–°–æ–∑–¥–∞—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:


–ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint –Ω–∞–ø—Ä—è–º—É—é, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—é —Å–∫—Ä–∏–ø—Ç:


–ü—Ä–æ–≤–µ—Ä—è—é –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç endpoint –∏ —Å–æ–∑–¥–∞—é —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –±–µ–∑ SDK:


```python
#!/usr/bin/env python3
"""
–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Cloud.RU ML Inference.
–†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ SDK, —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint.
"""

import os
import sys
import json
import time
import requests
from pathlib import Path

# –ó–∞–≥—Ä—É–∑–∫–∞ .env
try:
    from dotenv import load_dotenv
    load_dotenv()
except ImportError:
    pass

def test_endpoint_basic():
    """–ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint."""
    endpoint_url = os.getenv("CLOUD_RU_INFERENCE_URL", "").rstrip("/")
    inference_name = os.getenv("CLOUD_RU_INFERENCE_NAME", "")
    
    print("="*60)
    print("üß™ –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö CLOUD.RU ML INFERENCE")
    print("="*60)
    print(f"\nüìç Endpoint: {endpoint_url}")
    print(f"üìç –ú–æ–¥–µ–ª—å: {inference_name}")
    print()
    
    if not endpoint_url:
        print("‚ùå CLOUD_RU_INFERENCE_URL –Ω–µ –∑–∞–¥–∞–Ω –≤ .env")
        return False
    
    results = {}
    
    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑–æ–≤–æ–≥–æ URL
    print("="*60)
    print("–¢–ï–°–¢ 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint")
    print("="*60)
    
    test_urls = [
        f"{endpoint_url}/health",
        f"{endpoint_url}/",
        endpoint_url,
        f"{endpoint_url}/v1/models"
    ]
    
    for url in test_urls:
        try:
            print(f"\nüîç –ü—Ä–æ–≤–µ—Ä–∫–∞: {url}")
            start_time = time.time()
            response = requests.get(url, timeout=10, allow_redirects=True)
            response_time = time.time() - start_time
            
            print(f"   –°—Ç–∞—Ç—É—Å: {response.status_code}")
            print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
            
            if response.status_code == 200:
                print(f"   ‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω!")
                try:
                    data = response.json()
                    print(f"   –û—Ç–≤–µ—Ç (JSON): {json.dumps(data, indent=2, ensure_ascii=False)[:300]}")
                except:
                    print(f"   –û—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç): {response.text[:200]}")
                results[url] = {"status": "success", "code": response.status_code, "time": response_time}
                break
            elif response.status_code == 401:
                print(f"   ‚ö†Ô∏è  –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (401)")
                print(f"   –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω—É–∂–Ω—ã IAM –∫–ª—é—á–∏")
                results[url] = {"status": "auth_required", "code": response.status_code, "time": response_time}
                break
            elif response.status_code == 404:
                print(f"   ‚ö†Ô∏è  –ü—É—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω (404)")
                results[url] = {"status": "not_found", "code": response.status_code}
            else:
                print(f"   ‚ö†Ô∏è  –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å: {response.status_code}")
                print(f"   –û—Ç–≤–µ—Ç: {response.text[:200]}")
                results[url] = {"status": "error", "code": response.status_code}
                
        except requests.exceptions.Timeout:
            print(f"   ‚ùå –¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è")
            results[url] = {"status": "timeout"}
        except requests.exceptions.ConnectionError as e:
            print(f"   ‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: {e}")
            results[url] = {"status": "connection_error", "error": str(e)}
        except Exception as e:
            print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
            results[url] = {"status": "error", "error": str(e)}
    
    # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å IAM –∫–ª—é—á–∞–º–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    print("\n" + "="*60)
    print("–¢–ï–°–¢ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å IAM –∫–ª—é—á–∞–º–∏")
    print("="*60)
    
    key_id = os.getenv("CLOUD_RU_IAM_KEY_ID", "")
    secret = os.getenv("CLOUD_RU_IAM_SECRET", "")
    
    if not key_id or not secret:
        print("‚ö†Ô∏è  IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã –≤ .env")
        print("   –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω—ã:")
        print("   - CLOUD_RU_IAM_KEY_ID")
        print("   - CLOUD_RU_IAM_SECRET")
        print("\n   –ü–æ–ª—É—á–∏—Ç—å: Cloud.RU ‚Üí IAM ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –ö–ª—é—á–∏")
    else:
        print(f"‚úÖ IAM Key ID: {key_id[:4]}...{key_id[-4:] if len(key_id) > 8 else '***'}")
        print(f"‚úÖ IAM Secret: {'*' * 20}")
        
        # –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SDK
        try:
            from evolution_openai import EvolutionOpenAI
            
            base_url = f"{endpoint_url}/v1"
            print(f"\nüîç –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SDK: {base_url}")
            
            client = EvolutionOpenAI(
                base_url=base_url,
                api_key=key_id,
                api_secret=secret
            )
            
            # –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
            try:
                print("   –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π...")
                models = client.models.list()
                print(f"   ‚úÖ SDK –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!")
                if hasattr(models, 'data') and models.data:
                    print(f"   –î–æ—Å—Ç—É–ø–Ω–æ –º–æ–¥–µ–ª–µ–π: {len(models.data)}")
                    for model in models.data[:3]:
                        print(f"   - {model.id}")
                return True
            except Exception as e:
                print(f"   ‚ö†Ô∏è  –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                print("   –ü—Ä–æ–±—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏...")
            
            # –¢–µ—Å—Ç –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–∏
            if inference_name:
                try:
                    print(f"\nüîç –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏: {inference_name}")
                    start_time = time.time()
                    response = client.chat.completions.create(
                        model=inference_name,
                        messages=[
                            {"role": "system", "content": "–í—ã –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç."},
                            {"role": "user", "content": "–°–∫–∞–∂–∏ '–ü—Ä–∏–≤–µ—Ç' –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º"}
                        ],
                        max_tokens=50,
                        temperature=0.5
                    )
                    response_time = time.time() - start_time
                    
                    if hasattr(response, 'choices') and response.choices:
                        content = response.choices[0].message.content
                        print(f"   ‚úÖ –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏ —É—Å–ø–µ—à–µ–Ω!")
                        print(f"   –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response_time:.3f}s")
                        print(f"   –û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏: {content}")
                        return True
                    else:
                        print(f"   ‚ö†Ô∏è  –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏")
                except Exception as e:
                    print(f"   ‚ùå –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–∏: {e}")
                    import traceback
                    print(f"   –î–µ—Ç–∞–ª–∏: {traceback.format_exc()[:500]}")
            
        except ImportError:
            print("\n‚ùå SDK evolution_openai –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install evolution-openai")
            print("   –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: pip install --break-system-packages evolution-openai")
        except Exception as e:
            print(f"\n‚ùå –û—à–∏–±–∫–∞ SDK: {e}")
            import traceback
            print(f"   –î–µ—Ç–∞–ª–∏: {traceback.format_exc()[:500]}")
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    output_file = f"inference_test_simple_{int(time.time())}.json"
    with open(output_file, "w", encoding="utf-8") as f:
        json.dump({
            "timestamp": time.strftime("%Y-%m-%d %H:%M:%S"),
            "endpoint": endpoint_url,
            "model": inference_name,
            "results": results
        }, f, indent=2, ensure_ascii=False)
    
    print(f"\nüíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: {output_file}")
    
    # –ò—Ç–æ–≥
    print("\n" + "="*60)
    print("üìä –ò–¢–û–ì")
    print("="*60)
    
    has_success = any(r.get("status") == "success" for r in results.values())
    has_auth_required = any(r.get("status") == "auth_required" for r in results.values())
    
    if has_success:
        print("‚úÖ Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!")
    elif has_auth_required:
        print("‚ö†Ô∏è  Endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é")
        print("   –ù—É–∂–Ω—ã IAM –∫–ª—é—á–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")
    else:
        print("‚ùå Endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º")
    
    return has_success or has_auth_required

if __name__ == "__main__":
    success = test_endpoint_basic()
    sys.exit(0 if success else 1)

```

Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404, —á—Ç–æ –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø—É—Ç–∏. –°–æ–∑–¥–∞—é –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:


```markdown
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Cloud.RU ML Inference

## üìã –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- **Endpoint URL**: `https://5bf2f0a2-cdc8-4831-be41-5b2f9d6a7b55.modelrun.inference.cloud.ru`
- **–ú–æ–¥–µ–ª—å**: `model-run-msguj-among`
- **–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞**: 2025-11-25

## üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç **404 Not Found**:

- `/health` ‚Üí 404
- `/` ‚Üí 404  
- `/v1/models` ‚Üí 404

**–í—ã–≤–æ–¥**: Endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏. –°—Ç–∞—Ç—É—Å 404 –≤–º–µ—Å—Ç–æ 401 –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ:
1. Endpoint —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. –ü—É—Ç–∏ API –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö
3. –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ Cloud.RU)

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å IAM –∫–ª—é—á–∞–º–∏

‚ö†Ô∏è **IAM –∫–ª—é—á–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã –≤ `.env` —Ñ–∞–π–ª–µ**

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–Ω—ã:
- `CLOUD_RU_IAM_KEY_ID` - Access Key ID –∏–∑ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- `CLOUD_RU_IAM_SECRET` - Secret Key

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. –ü–æ–ª—É—á–∏—Ç—å IAM –∫–ª—é—á–∏

1. –ó–∞–π–¥–∏—Ç–µ –≤ **Cloud.RU ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º (IAM) ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"–ö–ª—é—á–∏"**
4. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –∫–ª—é—á (Access Key)"**
5. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **HMAC / AccessKey** (–Ω–µ JWT)
6. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ä–∞–∑—É** `key_id` –∏ `secret` - –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ secret –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∂—É—Ç!

### 2. –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á–∏ –≤ `.env`

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```env
CLOUD_RU_IAM_KEY_ID=–≤–∞—à_key_id_–∑–¥–µ—Å—å
CLOUD_RU_IAM_SECRET=–≤–∞—à_secret_–∑–¥–µ—Å—å
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
pip install --break-system-packages evolution-openai python-dotenv

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
python3 test_inference.py
```

–ò–ª–∏ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç:

```bash
python3 test_inference_simple.py
```

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∫–∏

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å IAM –∫–ª—é—á–∏, –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Python:

```python
from evolution_openai import EvolutionOpenAI

client = EvolutionOpenAI(
    key_id="–≤–∞—à_key_id",
    secret="–≤–∞—à_secret",
    base_url="https://5bf2f0a2-cdc8-4831-be41-5b2f9d6a7b55.modelrun.inference.cloud.ru/v1"
)

response = client.chat.completions.create(
    model="model-run-msguj-among",
    messages=[
        {"role": "system", "content": "–í—ã –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç."},
        {"role": "user", "content": "–ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?"}
    ],
    max_tokens=5000,
    temperature=0.5
)

print(response.choices[0].message.content)
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –≤ git!
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å **–∑–∞–ø—É—â–µ–Ω** –≤ Cloud.RU (—Å—Ç–∞—Ç—É—Å "–ó–∞–ø—É—â–µ–Ω")
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–∑–æ–≤ Inference
4. **–§–æ—Ä–º–∞—Ç URL**: –î–ª—è SDK –Ω—É–∂–µ–Ω URL —Å `/v1` –≤ –∫–æ–Ω—Ü–µ: `...cloud.ru/v1`

## üìä –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ Endpoint URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω
2. ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∑–∞–¥–∞–Ω–æ
3. ‚è≥ **–ù—É–∂–Ω—ã IAM –∫–ª—é—á–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
4. ‚è≥ –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–µ–π - –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å –≤—ã–∑–æ–≤–æ–º –º–æ–¥–µ–ª–∏

## üìû –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –≤ Cloud.RU ‚Üí ML Inference ‚Üí Model RUN
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ Inference
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –∫–ª—é—á–µ–π (–Ω–µ –ø—É—Ç–∞–π—Ç–µ —Å ID –º–æ–¥–µ–ª–∏!)
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ JSON —Ñ–∞–π–ª–∞—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```

–ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞:

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. –û–±–Ω–æ–≤–ª–µ–Ω `.env` —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   - `CLOUD_RU_INFERENCE_URL` = `https://5bf2f0a2-cdc8-4831-be41-5b2f9d6a7b55.modelrun.inference.cloud.ru`
   - `CLOUD_RU_INFERENCE_NAME` = `model-run-msguj-among`

2. –û–±–Ω–æ–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `test_inference.py`:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `/v1` –≤ URL –¥–ª—è SDK
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

3. –°–æ–∑–¥–∞–Ω —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç `test_inference_simple.py`:
   - –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ SDK
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å endpoint

4. –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
   - –í—Å–µ –ø—É—Ç–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 404 (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (TLS —Ä–∞–±–æ—Ç–∞–µ—Ç)
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 404
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî endpoint –∑–∞—â–∏—â–µ–Ω –∏ —Ç—Ä–µ–±—É–µ—Ç IAM –∫–ª—é—á–∏

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ IAM –∫–ª—é—á–∏ –≤ `.env`:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ:
CLOUD_RU_IAM_KEY_ID=–≤–∞—à_key_id_–∑–¥–µ—Å—å
CLOUD_RU_IAM_SECRET=–≤–∞—à_secret_–∑–¥–µ—Å—å
```

–ì–¥–µ –≤–∑—è—Ç—å –∫–ª—é—á–∏:
1. Cloud.RU ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º (IAM) ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
2. –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç ‚Üí –ö–ª—é—á–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á (HMAC/AccessKey)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `key_id` –∏ `secret` —Å—Ä–∞–∑—É (–ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ secret –Ω–µ –ø–æ–∫–∞–∂—É—Ç)

## –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –≤ `.env`:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install --break-system-packages evolution-openai python-dotenv

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
python3 test_inference.py

# –ò–ª–∏ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π
python3 test_inference_simple.py
```

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `test_inference.py` ‚Äî –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å SDK
- `test_inference_simple.py` ‚Äî —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –±–µ–∑ SDK
- `INFERENCE_TEST_RESULT.md` ‚Äî –æ—Ç—á–µ—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- `.env` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é. –î–æ–±–∞–≤—å—Ç–µ IAM –∫–ª—é—á–∏ –≤ `.env` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç.

```shellscript
# –û—Ç–∫—Ä–æ–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ:
CLOUD_RU_IAM_KEY_ID=–≤–∞—à_key_id_–∑–¥–µ—Å—å
CLOUD_RU_IAM_SECRET=–≤–∞—à_secret_–∑–¥–µ—Å—å
```

```shellscript
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
pip install --break-system-packages evolution-openai python-dotenv

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
python3 test_inference.py

# –ò–ª–∏ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π
python3 test_inference_simple.py
```

