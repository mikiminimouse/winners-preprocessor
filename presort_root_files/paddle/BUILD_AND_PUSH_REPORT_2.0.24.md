# Отчет о сборке и push образа PaddleOCR-VL Service версии 2.0.24

## Сводка

Образ `docling-granite-258m.cr.cloud.ru/paddleocr-vl-service:2.0.24` успешно собран и загружен в Artifact Registry.

## Изменения в версии 2.0.24

1. **Исправление проблемы с визуализацией**:
   - Добавлена функция `preprocess_image_for_visualization()` в `server.py` для применения тех же преобразований к изображению, что и модель PaddleOCR-VL
   - Обновлена функция `process_with_paddleocr()` для возврата препроцессированного изображения
   - Обновлена функция `generate_layout_visualization()` для работы с препроцессированным изображением
   - Обновлена логика в `gradio_app.py` для использования препроцессированного изображения при визуализации

2. **Улучшение логики определения режима**:
   - Исправлена логика в `start_enhanced.sh` для корректной работы с различными значениями переменной PORT
   - Поддержка значений: "7860" (ui), "8081" (server), "dual" (оба сервиса)

3. **Документация**:
   - Добавлен файл `VISUALIZATION_ALIGNMENT_FIX.md` с описанием проблемы и решения

## Теги образа

- `docling-granite-258m.cr.cloud.ru/paddleocr-vl-service:2.0.24` - конкретная версия
- `docling-granite-258m.cr.cloud.ru/paddleocr-vl-service:latest` - последняя версия

## Рекомендации по использованию

Для использования образа в Cloud.ru ML Inference:

1. **Для запуска только Web UI (порт 7860)**:
   - Установите переменную окружения: `PORT=7860`

2. **Для запуска только FastAPI (порт 8081)**:
   - Установите переменную окружения: `PORT=8081`

3. **Для запуска обоих сервисов одновременно**:
   - Установите переменную окружения: `PORT=dual` (или не устанавливайте PORT вообще)

4. **Для отключения проверки источников моделей** (рекомендуется):
   - Установите переменную окружения: `DISABLE_MODEL_SOURCE_CHECK=True`

## Health Check

Скрипт `health_check.sh` поддерживает все три режима работы:
- Для `MODE=server` проверяет только FastAPI сервис на порту 8081
- Для `MODE=ui` проверяет только Gradio UI на порту 7860
- Для `MODE=dual` проверяет оба сервиса на обоих портах

EOF && echo "Отчет создан: BUILD_AND_PUSH_REPORT_2.0.24.md"
