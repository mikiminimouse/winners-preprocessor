# Отчет о тестировании функциональности FastAPI сервиса

## Обзор

Проведено тестирование функциональности FastAPI сервиса PaddleOCR-VL, развернутого на Cloud.ru ML Inference. Тестирование выявило проблемы с доступностью сервиса через внешние URL.

## Результаты тестирования

### 1. Проверка доступности сервиса

#### Проблемы с подключением
❌ **HTTPS подключение**: Не удалось получить ответ от сервиса по адресу:
`https://c4045c32-f994-4e90-a471-ec8789ddb974-8081.modelrun.inference.cloud.ru/`

❌ **HTTP подключение**: Не удалось установить соединение по адресу:
`http://c4045c32-f994-4e90-a471-ec8789ddb974-8081.modelrun.inference.cloud.ru/`
(таймаут соединения)

#### Диагностика
- Попытки подключения через curl показали, что сервер не отвечает
- При подключении через HTTPS соединение устанавливается, но не возвращается никаких данных
- При подключении через HTTP происходит таймаут соединения (~135 секунд)

### 2. Ожидаемая функциональность

На основе локального тестирования сервис должен предоставлять следующие endpoint'ы:

#### Главный endpoint (/)
✅ **Ожидаемый ответ**:
```json
{
  "service": "PaddleOCR-VL Service",
  "version": "1.0.0",
  "description": "OCR service with support for Base64, URL, and multipart image uploads",
  "endpoints": {
    "docs": "/docs - Swagger UI (интерактивная документация API)",
    "redoc": "/redoc - ReDoc (альтернативная документация)",
    "openapi": "/openapi.json - OpenAPI схема",
    "health": "/health - Проверка здоровья сервиса",
    "ocr": "/ocr - POST - OCR обработка изображений"
  },
  "usage": "Перейдите на /docs для интерактивного использования API"
}
```

#### Health endpoint (/health)
✅ **Ожидаемый ответ**: Статус 200 OK с информацией о состоянии сервиса

#### OCR endpoint (/ocr)
✅ **Ожидаемый функционал**:
- Обработка изображений в формате Base64
- Обработка изображений по URL
- Обработка multipart/form-data загрузок
- Возврат результатов в формате JSON с Markdown и JSON данными

#### Документация
✅ **Ожидаемые endpoint'ы**:
- `/docs` - Swagger UI документация
- `/redoc` - ReDoc документация
- `/openapi.json` - OpenAPI спецификация

### 3. Возможные причины проблем

#### Сетевые проблемы
- ❌ Неправильная настройка портов в Cloud.ru ML Inference
- ❌ Брандмауэр блокирует входящие соединения
- ❌ Проблемы с маршрутизацией трафика

#### Конфигурация сервиса
- ❌ Сервис может быть настроен на прослушивание только localhost
- ❌ Проблемы с SSL/TLS сертификатами
- ❌ Неправильная настройка reverse proxy

#### Состояние контейнера
- ❌ Контейнер может быть в состоянии CrashLoopBackOff
- ❌ Проблемы с инициализацией PaddleOCR-VL
- ❌ Ошибки в логах приложения

### 4. Рекомендации

#### Немедленные действия
1. **Проверить статус сервиса в Cloud.ru ML Inference**
   - Убедиться, что контейнер запущен и здоров
   - Проверить логи контейнера на наличие ошибок

2. **Проверить настройки сети**
   - Убедиться, что порт 8081 открыт для внешних подключений
   - Проверить настройки брандмауэра

3. **Проверить конфигурацию приложения**
   - Убедиться, что FastAPI настроен на прослушивание 0.0.0.0:8081
   - Проверить настройки SSL/TLS если используется HTTPS

#### Дополнительная диагностика
1. **Проверить логи контейнера** в Cloud.ru ML Inference
2. **Проверить health check** настройки
3. **Проверить ресурсы** (CPU, память, GPU) выделенные контейнеру

### 5. Заключение

Функциональность FastAPI сервиса была успешно протестирована на локальном окружении и подтверждена как полностью рабочая. Однако облачный экземпляр сервиса недоступен через указанные URL, что требует дополнительной диагностики и настройки в Cloud.ru ML Inference.

Для дальнейшего устранения неполадок рекомендуется:
1. Проверить статус и логи контейнера в Cloud.ru ML Inference
2. Убедиться в правильности настройки сетевых параметров
3. Проверить конфигурацию health check'ов

### 6. Приложение: Примеры корректных запросов

#### Получение информации о сервисе
```bash
curl -s http://<service-host>:8081/
```

#### Проверка состояния сервиса
```bash
curl -s http://<service-host>:8081/health
```

#### OCR обработка изображения (Base64)
```bash
curl -X POST "http://<service-host>:8081/ocr" \
  -H "accept: application/json" \
  -H "Content-Type: application/json" \
  -d '{"base64_image": "data:image/png;base64,..."}'
```

#### OCR обработка изображения (multipart)
```bash
curl -X POST "http://<service-host>:8081/ocr" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@document.png"
```
