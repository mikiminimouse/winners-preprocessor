# План рефакторинга компонентов Preprocessing и реализации WebUI

## Обзор
Комплексный рефакторинг компонентов preprocessing для согласования документации с реализацией, с последующей реализацией полнофункционального веб-интерфейса Gradio для мониторинга и управления операциями препроцессинга.

## Фаза 1: Исправление несоответствий между документацией и реализацией

### 1.1 Согласование конфигурации
- Приведение файла `.env` в соответствие с требованиями документации
- Исправление конфигураций путей для соответствия документированному потоку данных
- Стандартизация настроек подключения к MongoDB во всех компонентах
- Обязательное использование VPN при работе с удаленной MongoDB и при загрузке файлов с zakupki.gov.ru

### 1.2 Согласование интерфейсов компонентов
- Обеспечение соответствия компонентов sync_db и downloader документированным API
- Исправление проблем с относительными импортами в модулях enhanced_service
- Стандартизация обработки ошибок и логирования во всех компонентах

### 1.3 Обновление обработчиков CLI
- Обновление load_handlers.py для использования правильных интерфейсов сервисов
- Исправление проверок подключения к MongoDB в utils_handlers.py
- Обеспечение работоспособности всех функций CLI с текущими реализациями компонентов

## Фаза 2: Реализация WebUI

### 2.1 Фреймворк панели управления Gradio
- Создание основной структуры приложения Gradio
- Реализация панели управления конфигурацией
- Добавление информационной панели с метриками в реальном времени

### 2.2 Компоненты визуализации данных
- Реализация диаграмм для статистики синхронизации/загрузки
- Добавление представлений временных линий для истории обработки
- Создание панелей аналитики с детализацией

### 2.3 Интерфейс управления
- Создание форм для настройки параметров синхронизации
- Добавление элементов управления для настроек загрузчика
- Реализация интерфейса управления планировщиком

## Фаза 3: Тестирование и валидация

### 3.1 Интеграционное тестирование компонентов
- Проверка работоспособности всех компонентов с обновленными конфигурациями
- Тестирование функциональности CLI с новыми реализациями
- Валидация потока данных в соответствии с документацией

### 3.2 Тестирование WebUI
- Тестирование всех компонентов панели управления
- Проверка обновлений метрик в реальном времени
- Валидация функциональности интерфейса управления

### 3.3 Сквозное тестирование пайплайна
- Тестирование полного пайплайна препроцессинга
- Проверка интеграции с final_preprocessing/docprep
- Валидация всех документированных рабочих процессов

## Дополнительные требования

### Обязательное использование VPN
- Все операции с удаленной MongoDB должны выполняться только через VPN
- Все загрузки файлов с zakupki.gov.ru должны выполняться только через VPN
- Реализация проверок наличия активного VPN-соединения перед выполнением операций
- Интеграция с route-up-zakupki.sh для автоматической настройки VPN

### Расширенная статистика и аналитика
- Подробная статистика по статусам обработанных записей
- Метрики по количеству синхронизированных/загруженных записей
- Анализ эффективности обработки по дням и периодам
- Отчеты о ошибках и исключениях с детализацией причин

### Управление потоками данных
- Поддержка многопоточной загрузки файлов (до 15 потоков)
- Проверка целостности загруженных файлов
- Обнаружение и обработка пустых или поврежденных units
- Полная статистика по каждому этапу обработки

### Интеграция с docprep
- Обеспечение совместимости формата данных с final_preprocessing/docprep
- Поддержка потока данных в директории Data/YYYY-MM-DD/Input
- Корректная передача метаданных для последующей обработки
