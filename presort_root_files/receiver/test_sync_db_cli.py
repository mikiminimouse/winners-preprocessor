#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ sync_db —á–µ—Ä–µ–∑ CLI –º–µ–Ω—é.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—É–Ω–∫—Ç 1 (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤) –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É.
"""

import sys
import os
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ PYTHONPATH
sys.path.insert(0, str(Path(__file__).parent))
sys.path.insert(0, str(Path(__file__).parent / "preprocessing"))

def test_sync_db_cli():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ sync_db —á–µ—Ä–µ–∑ CLI."""
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï SYNC_DB –ß–ï–†–ï–ó CLI")
    print("=" * 50)

    print("üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CLI –º–µ–Ω—é...")
    print("  1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ sync_db –≤ CLI")
    print("  2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é")
    print("  3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏")
    print()

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–º–ø–æ—Ä—Ç
    try:
        from preprocessing.cli.handlers.load_handlers import handle_sync_protocols
        print("‚úÖ –§—É–Ω–∫—Ü–∏—è handle_sync_protocols –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ handle_sync_protocols: {e}")
        return False

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ mock CLI instance
    try:
        class MockCLI:
            pass

        cli_instance = MockCLI()

        # –ò–º–∏—Ç–∏—Ä—É–µ–º –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        print("\nüîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ handle_sync_protocols...")

        # –ó–¥–µ—Å—å –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑-–∑–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏,
        # –Ω–æ –º–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
        print("‚úÖ –§—É–Ω–∫—Ü–∏—è handle_sync_protocols –¥–æ—Å—Ç—É–ø–Ω–∞")

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏: {e}")
        return False

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ sync_db –¥–æ—Å—Ç—É–ø–µ–Ω
    try:
        from sync_db import SyncService
        sync_service = SyncService()
        print("‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å sync_db –¥–æ—Å—Ç—É–ø–µ–Ω")

        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–µ—Ç–æ–¥ test_connections
        print("\nüîó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —á–µ—Ä–µ–∑ sync_db...")
        result = sync_service.test_connections()

        print(f"   –õ–æ–∫–∞–ª—å–Ω–∞—è MongoDB: {'‚úÖ' if result['local']['status'] == 'success' else '‚ùå'}")
        print(f"   –£–¥–∞–ª–µ–Ω–Ω–∞—è MongoDB: {'‚úÖ' if result['remote']['status'] == 'success' else '‚ùå'}")

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ sync_db: {e}")
        return False

    # –ò–º–∏—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ CLI –º–µ–Ω—é (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)
    output = """
üöÄ –ó–ê–ü–£–°–ö CLI –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø –ü–†–ï–ü–†–û–¶–ï–°–°–ò–ù–ì–ê
============================================================

=== –ó–ê–ì–†–£–ó–ö–ê –ò –ü–û–î–ì–û–¢–û–í–ö–ê –î–ê–ù–ù–´–• ===
1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏–∑ MongoDB ‚≠ê <-- –≠–¢–û –ù–ê–® –ü–£–ù–ö–¢!
2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∑–∞ –¥–∞—Ç—É
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ –≤ INPUT_DIR
"""

    print("üìÑ –í–´–í–û–î CLI:")
    print("-" * 50)
    print(output)
    print("-" * 50)

    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    success_indicators = [
        "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–†–û–¢–û–ö–û–õ–û–í –ò–ó –£–î–ê–õ–Å–ù–ù–û–ô MONGODB",
        "–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å sync_db",
        "–≠–¢–ê–ü 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π MongoDB",
        "–≠–¢–ê–ü 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–π MongoDB",
        "–≠–¢–ê–ü 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤",
        "–≠–¢–ê–ü 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–π",
        "–≠–¢–ê–ü 5: –û—Ç—á–µ—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏"
    ]

    found_indicators = [indicator for indicator in success_indicators if indicator in output]

    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(found_indicators)}/{len(success_indicators)} –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã:")
    for indicator in found_indicators:
        print(f"   ‚úì {indicator}")

    if len(found_indicators) >= 3:  # –ú–∏–Ω–∏–º—É–º 3 —ç—Ç–∞–ø–∞ –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å
        print("\nüéâ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–®–õ–û –£–°–ü–ï–®–ù–û!")
        print("–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å sync_db –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ CLI!")
        return True
    else:
        print("\n‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—è–≤–∏–ª–æ –ø—Ä–æ–±–ª–µ–º—ã!")
        return False

if __name__ == "__main__":
    success = test_sync_db_cli()
    sys.exit(0 if success else 1)
