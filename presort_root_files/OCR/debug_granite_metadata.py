#!/usr/bin/env python3
"""–û—Ç–ª–∞–¥–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Granite"""
import openai

GRANITE_API = "https://8cb66180-db3a-4963-8068-51f87e716259.modelrun.inference.cloud.ru/v1"
GRANITE_TOKEN = "ZDRhOWQ3OTAtZjU4MC00MzA2LThhNTgtMDU1NGFlMjE4OWRl.85a830f9340966e0ad1fd1642884c7c8"

granite = openai.OpenAI(api_key=GRANITE_TOKEN, base_url=GRANITE_API)

# –ü—Ä–∏–º–µ—Ä —Ç–µ–∫—Å—Ç–∞
text = """
–ü–†–û–¢–û–ö–û–õ ‚Ññ 1348-1

–∑–∞—Å–µ–¥–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –∑–∞–∫—É–ø–æ—á–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏ –§–ì–£–ü ¬´–ì–£–°–°¬ª –ø–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—é, –æ—Ü–µ–Ω–∫–µ –∏
—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∑–∞—è–≤–æ–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–∫—É–ø–∫–∏ —Å–ø–æ—Å–æ–±–æ–º –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
(–≤ —Ñ–æ—Ä–º–µ –ü–î–û) –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ –Ω–∞ –ø—Ä–∞–≤–æ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É
—â–∏—Ç–æ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞:
—à–∏—Ñ—Ä –æ–±—ä–µ–∫—Ç–∞ 613/71-–û–ü–¨/–ë–ò (2-1-1, 2-1-2).

–≥. –ú–æ—Å–∫–≤–∞ ¬´27¬ª –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞

–ó–∞–∫–∞–∑—á–∏–∫/–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∑–∞–∫—É–ø–∫–∏:

–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–Ω–∏—Ç–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ ¬´–ì–ª–∞–≤–Ω–æ–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞¬ª.

–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: –§–ì–£–ü ¬´–ì–£–°–°¬ª.

–û–†–ì–ù 1022302390461, –ò–ù–ù 2315078029, –ö–ò–ü 997450001.

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–∫—É–ø–∫–∏: –ò–∑–≤–µ—â–µ–Ω–∏–µ –æ –∑–∞–∫—É–ø–∫–µ –∏ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ
–∑–∞–∫—É–ø–∫–µ —Ä–∞–∑–º–µ—â–µ–Ω—ã –ó–∞–∫–∞–∑—á–∏–∫–æ–º 07.11.2025 –≤ –ï–ò–° ‚Ññ 32515380587.

–ü—Ä–µ–¥–º–µ—Ç –∑–∞–∫—É–ø–∫–∏: –ü–æ—Å—Ç–∞–≤–∫–∞ —â–∏—Ç–æ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞: —à–∏—Ñ—Ä
–æ–±—ä–µ–∫—Ç–∞ 613/71-–û–ü–¨/–ë–ò (2-1-1, 2-1-2).

–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: –û–û–û ¬´–û–ù–ò–ö–°¬ª
–¶–µ–Ω–∞ –¥–æ–≥–æ–≤–æ—Ä–∞: 8000000 (–≤–æ—Å–µ–º—å –º–∏–ª–ª–∏–æ–Ω–æ–≤) —Ä—É–±–ª–µ–π 00 –∫–æ–ø–µ–µ–∫, –≤ —Ç–æ–º —á–∏—Å–ª–µ –ù–î–° (20%).
"""

prompt = f"""–ò–∑–≤–ª–µ–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∑–∞–∫—É–ø–∫–∏ –≤ JSON.

–¢–µ–∫—Å—Ç:
{text}

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:
{{
  "–Ω–æ–º–µ—Ä_–ø—Ä–æ—Ü–µ–¥—É—Ä—ã": "32515380587",
  "–¥–∞—Ç–∞_–ø—Ä–æ—Ç–æ–∫–æ–ª–∞": "27.11.2025",
  "–ø–æ–±–µ–¥–∏—Ç–µ–ª—å": "–û–û–û –û–ù–ò–ö–°",
  "–ò–ù–ù": "2315078029",
  "–ö–ü–ü": "997450001",
  "—Ü–µ–Ω–∞_–ø–æ–±–µ–¥–∏—Ç–µ–ª—è": "8000000",
  "–≤–∞–ª—é—Ç–∞": "RUB",
  "–ø—Ä–µ–¥–º–µ—Ç_–∑–∞–∫—É–ø–∫–∏": "–ü–æ—Å—Ç–∞–≤–∫–∞ —â–∏—Ç–æ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è",
  "–∑–∞–∫–∞–∑—á–∏–∫": "–§–ì–£–ü –ì–£–°–°"
}}

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:"""

print("üîç –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –∫ Granite...\n")
print(f"–ü—Ä–æ–º–ø—Ç ({len(prompt)} —Å–∏–º–≤–æ–ª–æ–≤):\n{prompt[:500]}...\n")

try:
    resp = granite.chat.completions.create(
        model="granite-docling",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=2000,
        temperature=0.0
    )
    
    raw = resp.choices[0].message.content
    print("üì• RAW –æ—Ç–≤–µ—Ç Granite:\n")
    print(raw)
    print("\n" + "="*70)
    
    # –ü–∞—Ä—Å–∏–Ω–≥
    import json, re
    text_clean = raw.strip()
    if '```' in text_clean:
        parts = text_clean.split('```')
        for part in parts:
            if '{' in part:
                text_clean = part
                break
    if text_clean.startswith('json'):
        text_clean = text_clean[4:]
    text_clean = text_clean.strip()
    
    match = re.search(r'\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}', text_clean, re.DOTALL)
    if match:
        parsed = json.loads(match.group(0))
        print("\n‚úÖ –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π JSON:\n")
        print(json.dumps(parsed, indent=2, ensure_ascii=False))
    else:
        print("\n‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω JSON –≤ –æ—Ç–≤–µ—Ç–µ")
        
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

