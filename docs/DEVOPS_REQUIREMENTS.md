# Запрос к DevOps: Данные для работы MCP HTTP Server

## Обзор

Для корректной работы `mcp_http_server.py` и получения протоколов закупок по дате из MongoDB необходимо предоставить следующие данные.

## ✅ Что уже есть в проекте

- ✅ Код MCP сервера (`mcp_http_server.py`)
- ✅ Документация по настройке (`MCP_ENV_CONFIG.md`, `MCP_QUICK_START.md`)
- ✅ Шаблон `.env.example` с описанием переменных
- ✅ Структура проекта для обработки документов

## ❌ Что нужно от DevOps

### 1. Данные для подключения к MongoDB

#### 1.1. Адреса хостов MongoDB (mongoServer)
**Что нужно:** Список хостов и портов MongoDB кластера  
**Формат:** `host1:port1,host2:port2,host3:port3`  
**Пример:** `mongo-shard1.example.com:27017,mongo-shard2.example.com:27017,mongo-shard3.example.com:27017`

**Вопросы для DevOps:**
- Какие хосты входят в шардированный кластер?
- На каких портах работают MongoDB инстансы?
- Есть ли балансировщик нагрузки (если да, его адрес)?

#### 1.2. Учетные данные для чтения (readAllUser, readAllPassword)
**Что нужно:** Пользователь MongoDB с правами только на чтение  
**Требования:**
- Пользователь должен иметь доступ к базе `protocols223`
- Пользователь должен иметь доступ к коллекции `purchaseProtocol`
- Права: только чтение (read-only)

**Вопросы для DevOps:**
- Есть ли уже пользователь с правами чтения?
- Если нет, нужно создать пользователя с правами:
  ```javascript
  db.createUser({
    user: "readonly_user",
    pwd: "secure_password",
    roles: [{ role: "read", db: "protocols223" }]
  })
  ```
- Какой authSource используется? (по умолчанию `admin`)

#### 1.3. SSL сертификат (sslCertPath)
**Что нужно:** SSL/TLS сертификат для безопасного подключения к MongoDB  
**Формат:** PEM файл (Certificate Authority certificate)

**Вопросы для DevOps:**
- Где находится CA сертификат MongoDB?
- Нужно ли скачать сертификат или он уже есть в системе?
- Какой путь к сертификату в продакшене?
- Нужны ли дополнительные сертификаты (client certificate)?

**Действия DevOps:**
1. Предоставить CA сертификат MongoDB (файл `.pem`)
2. Указать путь, где будет храниться сертификат
3. Убедиться, что сертификат актуален и не истек

### 2. Информация о структуре базы данных

#### 2.1. Подтверждение структуры
**Что нужно:** Подтверждение, что структура БД соответствует ожидаемой

**Текущие предположения в коде:**
- База данных: `protocols223`
- Коллекция: `purchaseProtocol`
- Поле для фильтрации по дате: `loadDate` (тип: datetime)
- Структура документа:
  ```json
  {
    "purchaseInfo": {
      "purchaseNoticeNumber": "string"
    },
    "attachments": {
      "document": [
        {
          "url": "string",
          "fileName": "string"
        }
      ]
    },
    "loadDate": "datetime"
  }
  ```

**Вопросы для DevOps:**
- Подтвердите название базы данных и коллекции
- Подтвердите структуру документов
- Есть ли индексы на поле `loadDate`? (для производительности)
- Какие еще поля могут быть полезны?

### 3. Сетевая доступность

#### 3.1. Доступность MongoDB из контейнера/сервера
**Что нужно:** Подтверждение сетевой доступности

**Вопросы для DevOps:**
- Будет ли MCP сервер работать в Docker контейнере?
- Если да, нужно ли настроить Docker network?
- Есть ли firewall правила, которые нужно открыть?
- Нужны ли VPN или SSH туннели для доступа?

#### 3.2. Порт для MCP сервера
**Что нужно:** Порт для запуска MCP HTTP Server

**Текущая настройка:** Порт `8000`  
**Вопросы для DevOps:**
- Можно ли использовать порт 8000?
- Нужен ли балансировщик нагрузки перед MCP сервером?
- Нужны ли SSL/TLS сертификаты для самого MCP сервера?

### 4. Мониторинг и логирование

#### 4.1. Логирование
**Вопросы для DevOps:**
- Куда отправлять логи MCP сервера?
- Нужна ли интеграция с системой мониторинга (Prometheus, Grafana)?
- Какие метрики нужно отслеживать?

#### 4.2. Алерты
**Вопросы для DevOps:**
- Нужны ли алерты на ошибки подключения к MongoDB?
- Нужны ли алерты на превышение лимита протоколов?

### 5. Безопасность

#### 5.1. Хранение секретов
**Вопросы для DevOps:**
- Как хранить секреты в продакшене? (Docker secrets, Kubernetes secrets, Vault)
- Нужна ли ротация паролей?
- Как часто нужно обновлять SSL сертификаты?

#### 5.2. Аутентификация MCP сервера
**Вопросы для DevOps:**
- Нужна ли аутентификация для доступа к MCP серверу?
- Если да, какой метод? (API key, OAuth, JWT)

## Минимальный набор данных для старта

Для начала работы достаточно получить:

1. ✅ **mongoServer** - адреса хостов MongoDB
2. ✅ **readAllUser** - имя пользователя для чтения
3. ✅ **readAllPassword** - пароль пользователя
4. ✅ **sslCertPath** - путь к SSL сертификату (или сам сертификат)

## Формат предоставления данных

Предпочтительный формат для получения данных от DevOps:

```bash
# Вариант 1: Через защищенный канал (1Password, Vault, etc.)
# DevOps предоставляет ссылку на секреты

# Вариант 2: Через зашифрованный файл
# DevOps отправляет зашифрованный .env файл

# Вариант 3: Через переменные окружения в CI/CD
# DevOps настраивает переменные в системе деплоя
```

## Чеклист для DevOps

- [ ] Предоставлены адреса хостов MongoDB (mongoServer)
- [ ] Создан/предоставлен пользователь с правами чтения (readAllUser, readAllPassword)
- [ ] Предоставлен SSL сертификат MongoDB (sslCertPath)
- [ ] Подтверждена структура базы данных (protocols223.purchaseProtocol)
- [ ] Проверена сетевая доступность MongoDB из окружения MCP сервера
- [ ] Настроены firewall правила (если необходимо)
- [ ] Определен порт для MCP сервера
- [ ] Настроено логирование и мониторинг
- [ ] Настроено хранение секретов в продакшене

## Контакты и вопросы

Если у DevOps есть вопросы по требованиям, можно обратиться к:
- Документации: `MCP_ENV_CONFIG.md`
- Быстрому старту: `MCP_QUICK_START.md`
- Коду: `mcp_http_server.py` (строки 102-109, 113-120)

## Пример запроса к DevOps (краткая версия)

```
Привет!

Нам нужны данные для подключения к MongoDB для работы MCP сервера:

1. Адреса хостов MongoDB (формат: host1:port1,host2:port2)
2. Пользователь с правами чтения к базе protocols223
3. Пароль для этого пользователя
4. SSL сертификат MongoDB (CA certificate)

Подробности в файле DEVOPS_REQUIREMENTS.md

Спасибо!
```

